
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Debugger - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="        Debugger          Tests, logging (e.g. info, warn, debug), traditional output (e.g. puts), raising exceptions will assist you with finding ...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/debugging/debugger.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jumpstart Lab Curriculum</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Debugger</h1>
    
  </header>
  
  <p>Tests, logging (e.g. <code>info</code>, <code>warn</code>, <code>debug</code>), traditional output (e.g. <code>puts</code>), raising exceptions will assist you with finding most issues. However, there are situations when you are unsure about the state of several variables within a context or the state of a complex object within a given interaction. This is when it is useful to employ an interactive debugger.</p>

<p>Ruby&#8217;s <code>ruby-debug</code> is a powerful tool that allows for you to stop the execution of the application at a particular moment and to investigate and interact within that context.</p>

<ul>
<li>Output the state and value of objects, variables all available within that scope.</li>
<li>Move step-by-step through the code to ensure that your mental model of the execution maps to the actual execution.</li>
<li>Change the state of objects to quickly test the effects within the system</li>
</ul>

<h2>Ruby-Debug</h2>

<h3>Installation</h3>

<p>The following examples demonstrate how you can provide ruby debugging within your rails project by specifying the <code>ruby-debug</code> gem into your Gemfile.</p>

<p>Note that the debugger relies on native extensions, so you need to have the Ruby headers and compilation tools setup on your system.</p>

<h4>Ruby 1.8.7</h4>

<p>Assuming you&#8217;re using Bundler, add the dependency to your development gems in the <code>Gemfile</code>:</p>

<p>1<br>
2<br>
3<br>
group :development do<br>
  gem &#39;ruby-debug&#39;<br>
end<br>
</p>

<h4>Ruby 1.9.X</h4>

<p>Assuming you&#8217;re using Bundler, add the dependency to your development gems in the <code>Gemfile</code>:</p>

<p>1<br>
2<br>
3<br>
group :development do<br>
  gem &#39;ruby-debug19&#39;<br>
end<br>
</p>

<p>If you left off the <code>19</code> you would instead get the package for use with 1.8.7 and it is incompatible with 1.9.</p>

<h3>Booting</h3>

<p>When you start your Rails server or console you have to explicitly enable the debugger. For the server:</p>

<p>1<br>
rails server &#8211;debug<br>
</p>

<p>And for the console:</p>

<p>1<br>
rails console &#8211;debug<br>
</p>

<p>Now the debugger is loaded, and any <em>breakpoint</em> in your code will trigger it.  Auto-reloading is supported as normal.</p>

<h3>Interrupting Execution</h3>

<p>Wherever you want to inspect execution add a call to <code>debugger</code> like this:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
def create<br>
  @article = Article.new(params[:article])<br>
  debugger<br>
  if @article.save<br>
    #&#8230;<br>
</p>

<p>If the debugger is <em>not</em> loaded when execution hits the <code>debugger</code> line, there will be a warning in the output log. </p>

<p>If it is properly loaded, execution will pause and drop you into the debugger interface. If you&#8217;re in the middle of a request this console will appear in the window/process where your server is normally outputting its logging information:</p>

<p>1<br>
2<br>
3<br>
4<br>
[Timestamp] INFO  WEBrick::HTTPServer#start: pid=78725 port=3000<br>
/path/to/your/app/controllers/articles_controller.rb:19<br>
if @article.save<br>
(rdb:2)<br>
</p>

<p>Which can be read like this:</p>

<ul>
<li>Line 1: Normal server startup line</li>
<li>Line 2: The line of code containing the call to <code>debugger</code></li>
<li>Line 3: The next line of code pending execution</li>
<li>Line 4: The debugger prompt</li>
</ul>

<p>Now you have incredible power available to you with a few simple commands.</p>

<h3>Basic Usage</h3>

<h4><code>continue</code></h4>

<p>Say you figure out the issue and you&#8217;re ready to finish the request. Just issue the <code>continue</code> instruction and execution will keep running from wherever it paused.</p>

<h4><code>quit</code></h4>

<p>Rarely you want to exit the application all together. Quit will halt execution without finishing the request.</p>

<h4><code>list</code></h4>

<p>The <code>list</code> instructions shows the context of the current code, five lines before and four lines after the current execution point.</p>

<h4><code>next</code></h4>

<p>The <code>next</code> instruction will run the following instruction in the current context and move the marker to the next line in that context. Given this controller code:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
def create<br>
  @article = Article.new(params[:article])<br>
  debugger<br>
  if @article.save<br>
    redirect_to article_path(@article), :notice =&gt; &quot;Your article was created.&quot;<br>
  # &#8230;<br>
</p>

<p>See how <code>next</code> moves the execution marker:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
/path/to/your/app/controllers/articles_controller.rb:19<br>
if @article.save<br>
(rdb:2) next<br>
/path/to/your/app/controllers/articles_controller.rb:20<br>
redirect_to article_path(@article), :notice =&gt; &quot;Your article was created.&quot;<br>
(rdb:2) <br>
</p>

<p>It advances from the <code>if @article.save</code> to the <code>redirect_to</code>.</p>

<h4><code>step</code></h4>

<p>The <code>step</code> command, on the other hand, will move the execution marker to the next instruction to be executed even in a called method. Using the same controller code as before, see how <code>step</code> has a different effect:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
/path/to/your/app/controllers/articles_controller.rb:19<br>
if @article.save<br>
(rdb:2) step<br>
/Users/you/.rvm/gems/ruby-1.9.2-p290@jsmerchant/gems/activerecord-3.0.9/lib/active_record/transactions.rb:239<br>
rollback_active_record_state! do<br>
(rdb:2) <br>
</p>

<p>Execution has now paused inside the implementation of <code>.save</code> within <code>ActiveRecord</code>. This can be useful if you really want to dig through Rails internals, but for most purposes I find <code>step</code> impractical.</p>

<h4><code>eval</code> Ruby Code</h4>

<p>You can use the <code>eval</code> instruction to run arbitrary ruby or display the value of a variable. For instance, to see the value of <code>@product</code>:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
/path/to/your/app/controllers/articles_controller.rb:19<br>
if @product.save<br>
(rdb:8) eval @article<br>
#&lt;Article id: nil, title: nil, body: nil, created_at: nil, updated_at: nil, author_name: &quot;Stan&quot;, editor_id: nil&gt; <br>
(rdb:8) <br>
</p>

<h4>Watching Variables with <code>display</code></h4>

<p>Typically when running the debugger you&#8217;re interested in how a variable changes over a series of instructions. First, let&#8217;s move the debugger call up one line in our action:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
def create<br>
  debugger<br>
  @article = Article.new(params[:article])<br>
  if @article.save<br>
    #&#8230;<br>
</p>

<p>I run that code then use the <code>display</code> command like this:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
8<br>
9<br>
10<br>
11<br>
12<br>
13<br>
/path/to/your/app/controllers/articles_controller.rb:18<br>
@article = Article.new(params[:article])    <br>
(rdb:2) display @article<br>
1: @article = <br>
(rdb:2) next<br>
1: @article = #&lt;Article id: nil, title: &#39;Hello&#39;, body: &#39;World&#39;&gt; <br>
/path/to/your/app/controllers/articles_controller.rb:19<br>
if @article.save<br>
(rdb:2) next<br>
1: @product = #&lt;Article id: 22, title: &#39;Hello&#39;, body: &#39;World&#39;&gt;<br>
/path/to/your/app/controllers/articles_controller.rb:22<br>
redirect_to article_path(@article), :notice =&gt; &quot;Your article was created.&quot;<br>
(rdb:2) <br>
</p>

<ul>
<li>In line 3 I tell the debugger to <code>display @article</code>. </li>
<li>It will then show a line like #4 for each prompt. You can see <code>@article</code> starts as <code>nil</code> (a blank because the debugger calls <code>.to_s</code> on <code>nil</code> which gives you an empty string). </li>
<li>Then after I call <code>next</code> and a value is assigned to <code>@article</code>, the value appears on line 6. </li>
<li>Notice that the display persists for later instructions like line 10. </li>
</ul>

<p>In fact, when you <code>display</code> a variable it will show up for all further debugger calls in that process. So if your server stays running, you&#8217;ll see variables displayed from a previous request&#8217;s debugging. Want to stop displaying a variable? Call <code>undisplay</code> with the number displayed next to the variable. So in this case, I&#8217;d see the <code>1:</code> next to <code>@article</code> and call <code>undisplay 1</code>.</p>

<h4>Dropping into IRB</h4>

<p>Not satisfied with those options? Call the <code>irb</code> method and the debugger will drop you into a normal IRB console. Use all your normal Ruby functions and tricks, then <code>exit</code> to get back to the debugger. You can continue to invoke other instructions and any data you created/changed in the IRB session is persisted in the debugging session.</p>

<h3>Shortcuts</h3>

<p>Almost all of the commands (e.g. <code>continue</code>,<code>next</code>,<code>step</code>) can be executed by using the first letter of the command. Allowing you to <code>continue</code> by entering the letter <code>c</code>.</p>

<p>All the commands that you have executed are in a command buffer that you can interact with by using the arrow keys. The <code>up-arrow</code> will move you back in history by one command. The <code>down-arrow</code> will move you forward in history.</p>

<p>The last command that you executed will be executed again by pressing the <code>return</code> key. This is extremely useful if you want to continually <code>step</code> through the code and want to save yourself the requirement of typing <code>s</code> or accessing the previous commands in the history.</p>

<h3>Rails: <code>request</code></h3>

<p>There are times when you are debugging the <code>request</code> within Rails. Perhaps you have a client, caching service, or routing service that sets or configures a number of http request environment variables. You may set a <em>breakpoint</em> within your application and then start the <code>irb</code> to interact with the <code>request</code> object only to be met with the following error message:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
/path/to/your/app/controllers/articles_controller.rb:18<br>
@article = Article.new(params[:article])<br>
(rdb:2) irb<br>
ruby-1.9.2-p180 :001 &gt; request.env<br>
RuntimeError: can&#39;t add a new key into hash during iteration<br>
    from /Users/you/.rvm/gems/ruby-1.9.2-p180@development/gems/rack-1.1.2/lib/rack/request.rb:201:in `[]=&#39;<br>
    # &#8230;<br>
</p>

<p>The following is caused because the <code>env</code> method is frozen and the interactive session is attempting to perform an operation on it which it will not allow. The way around this is  to <code>dup</code> the <code>env</code> and you will be allowed to inspect the request and the request environment variables.</p>

<p>1<br>
2<br>
3<br>
ruby-1.9.2-p180 :009 &gt; request.env.dup<br>
 =&gt; {&quot;GATEWAY_INTERFACE&quot;=&gt;&quot;CGI/1.1&quot;, &quot;PATH_INFO&quot;=&gt;&quot;/&quot;, &quot;QUERY_STRING&quot;=&gt;&quot;&quot;, &quot;REMOTE_ADDR&quot;=&gt;&quot;127.0.0.1&quot;, &quot;REMOTE_HOST&quot;=&gt;&quot;localhost&quot;, &quot;REQUEST_METHOD&quot;=&gt;&quot;GET&quot;, &quot;REQUEST_URI&quot;=&gt;&quot;http://localhost:3000/&quot;, &quot;SCRIPT_NAME&quot;=&gt;&quot;&quot;, &quot;SERVER_NAME&quot;=&gt;&quot;localhost&quot;, &quot;SERVER_PORT&quot;=&gt;&quot;3000&quot;, &quot;SERVER_PROTOCOL&quot;=&gt;&quot;HTTP/1.1&quot;<br>
    # &#8230;<br>
</p>

<h2>IDE Support</h2>

<p>If using the debugger is rare, then using the debugger in an IDE must be the white elephant of Ruby development. But let&#8217;s checkout how Rubymine tries to make using the debugger easier.</p>

<h3>RubyMine Setup</h3>

<p>Load your project normally in RubyMine. When you start the server, look for the &quot;Debug&quot; icon just to the right of the normal green play button. It has a green bug with a light blue arrow. </p>

<p>Click that and you&#8217;ll be prompted to install <code>ruby-debug-base19x</code> into the system gems and accept it. Try to run again and you&#8217;ll be prompted to install <code>ruby-debug-ide</code>. Once they&#8217;re both installed you&#8217;re ready to go.</p>

<h3>Setting Breakpoints</h3>

<p>The first thing you want to do is <em>remove</em> any explicit calls to <code>debugger</code>. If execution hits one of those calls while using the IDE debugger, you&#8217;ll get an error like this:</p>

<p>1<br>
undefined method `run_init_script&#39; for Debugger:Module<br>
</p>

<p>Once those are removed, you can set a breakpoint in RubyMine by left-clicking in the grey gutter to the left of the instruction. A red dot should appear.</p>

<p>Cause the code to run and RubyMine will snatch focus to show you the debugging tab.</p>

<h3>Usage</h3>

<p>The concepts are the same as the normal debugger.</p>

<ul>
<li>To execute one instruction at a time, like <code>next</code>, click the <code>Step Over</code> button that&#8217;s two small circles connected by an arrow</li>
<li>To drop into any called methods like <code>step</code>, click the <code>Step Into</code> button</li>
<li>To <code>continue</code> execution, click the green play button on the left menu</li>
<li>To monitor the value of a variable like <code>display</code>, click the [+] in the <em>Watches</em> pane and enter the name of the variable</li>
</ul>

<p>Overall, I&#8217;d say that the RubyMine debugger does some things well but overall feels like a complex solution on top of a complex tool on top of a simple language. It wouldn&#8217;t be the first tool I deploy to assess a problem.<br>
</p>

<h2>Exercises</h2>

<p>[TODO: JSBlogger Setup]</p>

<ol>
<li>Start the server <em>without</em> <code>--debug</code>, then call <code>debugger</code> in the code, and observe the output</li>
<li>Start the server <em>with</em> <code>--debug</code> and add a breakpoint to a controller method. Trigger that breakpoint and experiment with each of these commands:

<ul>
<li><code>eval</code></li>
<li><code>list</code></li>
<li><code>next</code></li>
<li><code>step</code></li>
<li><code>continue</code></li>
</ul></li>
<li>If you have RubyMine available, set a breakpoint through the GUI, trigger it, then experiment with:

<ul>
<li>variable watches</li>
<li>step over </li>
<li>step into</li>
<li>continue</li>
</ul></li>
<li>Try to view/manipulate the frozen <code>request</code> object, then call <code>dup</code> and explore the data</li>
<li><code>debugger</code> is just a method. Try combining it with a conditional branch to only execute on a certain pathway through your code (like a <code>nil</code> input, for example).</li>
</ol>

<h2>References</h2>

<ul>
<li>Rails guide on debugging and the debugger: <a href="http://guides.rubyonrails.org/debugging_rails_applications.html">http://guides.rubyonrails.org/debugging_rails_applications.html</a></li>
<li>Extensive details about <code>ruby-debug</code> are available here: <a href="http://bashdb.sourceforge.net/ruby-debug.html">http://bashdb.sourceforge.net/ruby-debug.html</a></li>
<li>RubyMine&#8217;s info on the debugger: <a href="http://www.jetbrains.com/ruby/features/ruby_debugger.html">http://www.jetbrains.com/ruby/features/ruby_debugger.html</a></li>
</ul>

  
    <footer>
      
      
        <div class="sharing">
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Jumpstart Lab -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


  

  

  

</body>
</html>
