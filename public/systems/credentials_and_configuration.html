
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Credentials And Configuration - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="        Credentials and Configuration          As your application matures, you may find that API credentials and configuration details change as m...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/systems/credentials_and_configuration.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   class="no-sidebar" >
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Credentials and Configuration</h1>
    
  </header>
  
  <p>As your application matures, you may find that API credentials and configuration details change as much or more than your application code. If you tie these details too closely to your source code then you&#8217;ll be forced to redeploy for even simple configuration changes.</p>

<p>You may also want to share access to your source code among many developers without disclosing private credential details. For the reasons you should abstract credentials and configuration details.</p>

<h2>Centralizing Configuration and Credential Information</h2>

<p>Using a high-level <code>Config</code> abstraction will let you encapsulate where and how this information is stored. </p>

<h3>Environment Variables</h3>

<p>ENV variables are a great option for storing configuration data because they are secure yet easy to access.</p>

<p>This is <a href="http://devcenter.heroku.com/articles/config-vars">Heroku&#8217;s preferred method</a> for storing configuration data.</p>

<p>You can set ENV variables on your local machine by running a command like this:</p>

<p>1<br>
export SECRET_KEY=shazbot<br>
</p>

<p>That command is typically run in your <code>.bash_profile</code> so the value persists between reboots. You can<br>
also set different values for ENV variables on a per-command basis, like so:</p>

<p>1<br>
SECRET_KEY=shazbot bin/utility_script<br>
</p>

<p>You can access ENV values directly from ruby using the ENV global object, which is a Hash of all ENV values. </p>

<p>But doing this is not future-proof: as your app becomes more complex you may want to switch to a more fine-grained solution. Relying on ENV as your configuration abstraction does not afford enough flexibility.</p>

<h3>Creating <code>Config</code></h3>

<p>Here&#8217;s an approach that will keep things simple but will allow you future flexibility. Create a file named <code>config.rb</code> in<br>
<code>app/lib</code>:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
module Config<br>
  extend self<br>
<br>
  def [](key)<br>
    ENV[key]<br>
  end<br>
end<br>
</p>

<p>This Config module encapsulates configuration details stored in ENV variables. Later you can add other sources of data like this:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
8<br>
9<br>
10<br>
11<br>
12<br>
13<br>
14<br>
15<br>
module Config<br>
  extend self<br>
<br>
  def [](key)<br>
    if respond_to?(key)<br>
      self.send(key)<br>
    else<br>
      ENV[key]<br>
    end<br>
  end<br>
<br>
 def banned_domains<br>
   YAML.load(Rails.root.join(&quot;app/lib/banned_domains.yml&quot;)<br>
 end<br>
end<br>
</p>

<p>Now when you run <code>Config[:banned_domains]</code> you&#8217;ll get the array defined in <code>banned_domains.yml</code>.</p>

<h3>Other Ideas</h3>

<p>Your Config object could query a secure URL for a chunk of JSON containing all of the necessary configuration/credential information needed for a new deployment. </p>

<p>In this case, you might only use ENV variables to store authentication details for that URL. Here&#8217;s what your <code>Config</code> module might look like:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
8<br>
9<br>
10<br>
11<br>
12<br>
13<br>
14<br>
15<br>
16<br>
17<br>
18<br>
19<br>
20<br>
21<br>
22<br>
# app/lib/app_config.rb<br>
require &quot;open-uri&quot;<br>
require &quot;json&quot;<br>
<br>
class AppConfig<br>
  def initialize(url)<br>
    @data = {}<br>
    # skipping error handling details here for clarity<br>
    open(url) do |f|<br>
      data = JSON.parse(f.read)<br>
    end<br>
  end<br>
<br>
  def [](key)<br>
    @data[key]<br>
  end<br>
end<br>
<br>
# config/initializers/load_config_data.rb<br>
<br>
require &quot;app_config&quot;<br>
Config = AppConfig.new(ENV[&quot;CONFIG_URL&quot;])<br>
</p>

<p>Where the <code>CONFIG_URL</code> looks like <code>&quot;https://USERNAME:PASSWORD@secure.example.com/config.json&quot;</code></p>

<h2>On Heroku</h2>

<p>To display current <a href="http://devcenter.heroku.com/articles/config-vars">Heroku config variables</a>, run:</p>

<p>1<br>
2<br>
3<br>
4<br>
5<br>
6<br>
7<br>
$ heroku config<br>
BUNDLE_WITHOUT                =&gt; development:test<br>
DATABASE_URL                  =&gt; postgres://USERNAME:<a href="mailto:PASSWORD@example.com">PASSWORD@example.com</a>/dbname<br>
GEM_PATH                      =&gt; vendor/bundle/ruby/1.9.1<br>
PATH                          =&gt; vendor/bundle/ruby/1.9.1/bin:/usr/local/bin:/usr/bin:/bin<br>
RACK_ENV                      =&gt; production<br>
RAILS_ENV                     =&gt; production<br>
</p>

<p>All Heroku apps start out with a few basic settings like these.</p>

<h3>Changing Heroku Settings</h3>

<p>To add or change a setting, use this command line instruction:</p>

<p>1<br>
heroku config:add VARIABLE_NAME=VARIABLE_VALUE<br>
 </p>

<p>If you create a separate Heroku staging app you may want to create a separate staging environment to prevent your staging app from affecting production data. The change would look like this:</p>

<p>1<br>
heroku config:add RAILS_ENV=staging<br>
</p>

<h3>Security Considerations</h3>

<p>Currently anyone who can push to your Heroku app can fetch and set ENV values. If you would like to share deployment responsibilities but still protect sensitive credentials you would need to implement your own security controls (perhaps through the Config object).</p>

<h2>References</h2>

<ul>
<li>ENV Variables on Heroku Dev Center: <a href="http://devcenter.heroku.com/articles/config-vars">http://devcenter.heroku.com/articles/config-vars</a></li>
</ul>

  
</article>

</div>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Jumpstart Lab -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
</body>
</html>
