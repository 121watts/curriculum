
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JSAttend - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="            JSAttend          In this project you&#8217;ll work with the attendee data for a conference supplied in a CSV file. This data comes fro...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/level_1/jsattend.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jumpstart Lab Curriculum</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    
    <h1 class="entry-title">JSAttend</h1>
    
  </header>
  
  <p>In this project you&#8217;ll work with the attendee data for a conference supplied in a CSV file. This data comes from an actual conference, though identifying information has been masked. </p>

<p>The techniques practiced in this lab include:</p>

<ul>
<li>Basic file input and output</li>
<li>Working with CSV (Comma Separated Value) files using the CSV library</li>
<li>String manipulation techniques</li>
<li>Basic looping and branching instructions</li>
<li>Accessing a web-based API</li>
</ul>

<p>You&#8217;ll need a few data files that I&#8217;ll distribute in the chat.</p>

<h2>Bootstrap</h2>

<p>If you haven&#8217;t already setup Ruby, visit &quot;<a href="http://jumpstartlab.com/resources/general/environment/":http://jumpstartlab.com/resources/general/environment/">http://jumpstartlab.com/resources/general/environment/&quot;:http://jumpstartlab.com/resources/general/environment/</a> for instructions.</p>

<h3>Dependencies</h3>

<p>We&#8217;ll use just one external gem during the main sections of the tutorial. Install it with the following command and your terminal:</p>

<ul>
<li>[OS X]: <code>gem install sunlight</code></li>
<li>[Win]: <code>gem install sunlight</code></li>
</ul>

<h3>Starting the Project</h3>

<p>If you&#8217;re using RubyMine, do the following to setup the new project:</p>

<ul>
<li>Click &quot;Create a New Project&quot;

<ul>
<li>Project name: JSAttend</li>
<li>Project type: Empty Project</li>
<li>Click OK</li>
</ul></li>
<li>Right click on the project folder (in the left pane) and select NEW -&gt; RUBY CLASS

<ul>
<li>Enter the class name: JSAttend</li>
</ul></li>
</ul>

<h3>Initial Skeleton</h3>

<p>Start with this code framework:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Dependencies</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;csv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Class Definition</span>
</span><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;JSAttend Initialized.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Script</span>
</span><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Running the Program</h3>

<h4>From Inside RubyMine</h4>

<p>In RubyMine, click the RUN menu at the top, then EDIT CONFIGURATIONS</p>

<ul>
<li>Click the [+] icon

<ul>
<li>Click RUBY</li>
<li>Set the NAME to JSAttend</li>
</ul></li>
<li>Click the [&#8230;] next to RUBY SCRIPT and select your <code>js_attend.rb</code> file</li>
<li>Click the [&#8230;] next to WORKING DIRECTORY and select the folder where your <code>js_attend.rb</code> file is stored</li>
<li>Leave everything else alone and click OK</li>
<li>Click the RUN menu then RUN or Command-F8 to execute the program</li>
</ul>

<h4>From the Terminal</h4>

<p>If you prefer to run the program from the terminal:</p>

<ul>
<li>Switch to the project directory</li>
<li>Run it with <code>ruby jsattend.rb</code></li>
</ul>

<h4>Expected Output</h4>

<p>Your output should look something like&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>

<h2>Iteration 0: Basics of a CSV File</h2>

<p>CSV files are great for storing and transporting large data sets. They&#8217;re most commonly created from spreadsheets, but since a CSV is really just a plain text file, they&#8217;re pretty easy to interact with from ANY program. </p>

<h3>Accessing the Data File</h3>

<p>The first thing to do is open the file. We can do that by adding in the <code>CSV</code> line to our <code>intialize</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Dependencies</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;csv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Class Definition</span>
</span><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;JSAttend Initialized.&quot;</span>
</span><span class='line'>    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;event_attendees.csv&quot;</span>
</span><span class='line'>    <span class="vi">@file</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Script</span>
</span><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run the program and you should get an error that starts like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">No</span> <span class="n">such</span> <span class="n">file</span> <span class="ow">or</span> <span class="n">directory</span> <span class="o">-</span> <span class="n">event_attendees</span><span class="o">.</span><span class="n">csv</span> <span class="p">(</span><span class="no">Errno</span><span class="o">::</span><span class="no">ENOENT</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Setup <code>event_attendees.csv</code></h3>

<p>Download the file <a href="event_attendees.csv">/assets/jsattend/event_attendees.csv</a> and store it into the <em>same directory as your <code>jsattend.rb</code></em>. Then re-run your program and you should see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now that our file is getting loaded properly we have a name for that variable - <code>@file</code>. We can now talk to that object named <code>@file</code> and ask it questions or tell it to do things. </p>

<h3>Reading Data from the File</h3>

<p>Now that we can open the file, let&#8217;s read out some data.</p>

<h4>Understanding the File Data</h4>

<p>The first question to ask is &quot;how do we read the individual lines of the file?&quot; The CSV object implements the <code>Enumerable</code> interface which means that, among other things, you can use the <code>each</code> method to go through the collection one-by-one.</p>

<p>Here, we can access one line at a time with this loop:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>  <span class="c1"># Do Something</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>But what is that <code>line</code> object? Is it a String? An Array? Check it out by writing this method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">line</span><span class="o">.</span><span class="n">inspect</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>With the method inside the class, we need to call it from our script. At the bottom of your project file add the line <code>jsa.print_names</code> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">jsa</span><span class="o">.</span><span class="n">print_names</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then <em>run the program</em> using RubyMine or the terminal. You&#8217;ll see that the <code>line</code> object looks like an Array.</p>

<h4>Default Reading</h4>

<p>We can access individual fields within that array by their position. </p>

<p>If you look at the data file, you&#8217;ll see that the first name is in the third column. Since an array is zero-indexed, the third column is position <code>2</code>. So we can print the first names like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">line</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test it, see that it&#8217;s working, then modify this method to print both the first <em>and</em> last names for each line.</p>

<h4>Looking for Headers</h4>

<p>Using number to access the array isn&#8217;t very clear. When you look at the code, which position is the first name and which is the last name? It&#8217;s impossible to know without looking at the data file.</p>

<p>The data file begins with a row of headers labeling each column. The CSV library can read these headers and use them to organize the data.</p>

<p>Look in your <code>initialize</code> method, and add the extra <code>:headers</code> parameter to the <code>@file</code> line like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">{</span><span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your existing <code>print_names</code> method and it should still work the same.</p>

<p>Then, try calling <code>inspect</code> on the line object again:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="nb">inspect</span>
</span><span class='line'>      <span class="c1">#puts line[2] + &quot; &quot; + line[3]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Note that the <code>#</code> comments out the line so it won&#8217;t be executed.</p>

<p>When you look at the output, you&#8217;ll see that <code>line</code> now looks like a Hash. It has keys like <code>&quot;HomePhone&quot;</code> and <code>&quot;City&quot;</code>. Now, <em>use the keys instead of array positions</em> to print out the first and last names.</p>

<h4>Converting to Symbols</h4>

<p>It&#8217;s annoying that the weird header name formatting, with its inconsistent capitalization, is now polluting our program. The CSV library provides a way to help standardize the headers, triggered by adding another option to the loading:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">{</span><span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:header_converters</span> <span class="o">=&gt;</span> <span class="ss">:symbol</span><span class="p">})</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now, in your <code>print_names</code> method, use <code>.inspect</code> to look at the structure of the <code>line</code> object. Update your <code>puts</code> instruction to use the newly standardized column names.</p>

<h2>Iteration 1: Cleaning Up the Phone Numbers</h2>

<p>Open the CSV file in a spreadsheet program like Excel or OpenOffice. Look at the phone number column &#8211; see how they&#8217;re &quot;dirty&quot;?  Some have parentheses, some have hyphens, some periods. It&#8217;s a mess; let&#8217;s clean it up.</p>

<h3>Step 0 - Print What&#8217;s There</h3>

<p>Create a method named <code>print_numbers</code> that does the same thing as your existing <code>print_names</code> method, but print the phone number from <code>line[:homephone]</code>. </p>

<p>At the bottom of your program change the <code>jsa.print_names</code> line to <code>jsa.print_numbers</code>. Run your program and you should see the existing phone numbers scroll by.</p>

<h3>Step 1 - Removing Periods</h3>

<p>When you&#8217;re cleaning up data, the process goes something like this:</p>

<ul>
<li>Copy the original data</li>
<li>Remove the junk</li>
<li>Output the newly cleaned data</li>
</ul>

<p>Simple, right?  Let&#8217;s first remove the periods that some people put in their phone numbers. Change the body of your <code>print_numbers</code> method to match this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>  <span class="n">original</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span>
</span><span class='line'>  <span class="n">clean</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">clean</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your program and you should see the numbers scroll by again. There&#8217;s still plenty of junk in there (parentheses, hyphens, etc), but <em>there are no periods</em>!</p>

<h3>Step 2 - Removing Parentheses, Hyphens, and Spaces</h3>

<p>Now we need to remove the other junk characters. Try working with the <code>delete</code> and <code>delete!</code> methods to clean up all right parentheses, left parentheses, hyphens, and blank spaces. RUN your program and you should see better data coming out like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">6143300000</span>
</span><span class='line'><span class="mi">6176861000</span>
</span><span class='line'><span class="mi">503278000</span>
</span><span class='line'><span class="mi">7047989000</span>
</span><span class='line'><span class="mi">7579713000</span>
</span><span class='line'><span class="mi">9522007000</span>
</span><span class='line'><span class="mi">8146673000</span>
</span><span class='line'><span class="mi">19194755000</span>
</span><span class='line'><span class="mi">8045434000</span>
</span><span class='line'><span class="mi">8282844000</span>
</span><span class='line'><span class="n">bl000</span>
</span><span class='line'><span class="mi">6512603000</span>
</span></code></pre></td></tr></table></div></figure>

<p>Not perfect, but getting better.</p>

<h3>Step 3 - Checking Length</h3>

<p>We&#8217;ve removed extraneous characters, but there are still some problems. Some of the numbers are &quot;long&quot; because they have a leading 1 on the front. A few of them are too short. A few others are just garbage &#8211; like a misplaced email address or just some letter/number junk. Let&#8217;s fix these problems by looking at the number&#8217;s length.</p>

<p>The ideal length for our numbers is 10 total digits. We could write what&#8217;s called &quot;pseudocode&quot; like this:</p>

<ul>
<li>If the number is 10 digits long

<ul>
<li>It&#8217;s good</li>
</ul></li>
<li>If it&#8217;s 11 digits long

<ul>
<li>Is the first number a 1?</li>
<li>If so, cut it off the leading 1</li>
<li>If not, it&#8217;s junk</li>
<li>If not, this number is junk.</li>
</ul></li>
<li>Otherwise

<ul>
<li>If so, it&#8217;s junk.</li>
</ul></li>
</ul>

<p>Now we can translate that into real code using the <code>if</code>, <code>elsif</code>, <code>else</code>, and <code>!</code>(not) instructions like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">10</span>
</span><span class='line'>  <span class="c1"># Do Nothing</span>
</span><span class='line'><span class="k">elsif</span> <span class="n">number</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">11</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span>
</span><span class='line'>  <span class="k">else</span>
</span><span class='line'>    <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;0000000000&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>  <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;0000000000&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Insert that into your <code>print_numbers</code> method. RUN the resulting code and you should see nicely formatted numbers like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">3363171000</span>
</span><span class='line'><span class="mi">3363171000</span>
</span><span class='line'><span class="mi">2024818000</span>
</span><span class='line'><span class="mi">5034758000</span>
</span><span class='line'><span class="mi">8054481000</span>
</span><span class='line'><span class="mi">8145711000</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Step 4 - Refactoring</h3>

<p><em>Refactoring</em> is the an important part of programming &#8211; it means taking working code and reorganizing it to make more sense, be more maintainable, and be more flexible for the future.</p>

<h4>Splitting a Method</h4>

<p>We&#8217;ve created a <code>print_numbers</code> method that prints out good-looking phone numbers, but we&#8217;re lying a little bit. It&#8217;s not just <em>printing</em> numbers; it&#8217;s <em>cleaning</em> them then <em>printing</em> them. If we&#8217;re doing two things they should be split up into two methods.</p>

<p>Create a method named <code>clean_number</code> that looks like this&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_number</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># Insert your &quot;cleaning&quot; code here</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">number</span>  <span class="c1"># Send the variable &#39;number&#39; back to the method that called this method</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Note the comments that start with a <code>#</code> symbol. When you put a <code>#</code> the Ruby interpreter ignores everything after it on that line. So if we put a <code>#</code> then we can follow it with notes explaining what&#8217;s going on with that code. Comments are just for your information.</p>

<p>See where we have the <code>original</code> variable next to the name of the method?  That&#8217;s called a <em>parameter</em>. A parameter is some input that you need to put into an instruction so it can do what it&#8217;s supposed to do. Without the parameter the instruction doesn&#8217;t makes sense.</p>

<p>In order to perform <code>&quot;clean_number&quot;</code>, we need to give it the number to clean. Cut and paste your cleaning code from the old <code>print_numbers</code> method and put it into <code>clean_number</code>. After removing that code from <code>print_number</code> make it look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_numbers</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">number</span> <span class="o">=</span> <span class="n">clean_number</span><span class="p">(</span><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">number</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test your refactored code and make sure it still works properly.</p>

<p>If you&#8217;re generating errors, check that the variables in your <code>clean_number</code> method make sense. You&#8217;re starting with the incoming number named <code>original</code> and should end with the cleaned number named <code>number</code>.</p>

<h2>Iteration 2: Cleaning up the Zip Codes</h2>

<p>When we got this data the zipcode data was a little surprising. </p>

<h3>Step 0: Print out What&#8217;s There &amp; Diagnosis</h3>

<p>Why were so many of the zipcodes entered incorrectly?  Look at a few example addresses and zipcodes&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">1</span> <span class="no">Old</span> <span class="no">Ferry</span> <span class="no">Road</span><span class="p">,</span> <span class="no">Box</span> <span class="c1"># 6348 Bristol RI  2809</span>
</span><span class='line'><span class="mi">90</span> <span class="no">University</span> <span class="no">Heights</span> <span class="p">,</span> <span class="mi">401</span><span class="n">h1</span>   <span class="no">Burlington</span>  <span class="no">VT</span>  <span class="mi">5405</span>
</span><span class='line'><span class="mi">123</span> <span class="no">Garfield</span> <span class="no">Ave</span>  <span class="no">Blackwood</span>   <span class="no">NJ</span>  <span class="mi">8012</span>
</span><span class='line'><span class="mi">239</span> <span class="n">S</span> <span class="no">Prospect</span> <span class="no">St</span>  <span class="no">Burlington</span>  <span class="no">VT</span>  <span class="mi">5401</span>
</span><span class='line'><span class="mi">50</span> <span class="no">Ledgewood</span> <span class="no">Dr</span>   <span class="no">York</span>    <span class="no">ME</span>  <span class="mi">3909</span>
</span></code></pre></td></tr></table></div></figure>

<p>See the pattern?  Most of the short zipcodes are in the Northeast, where many zipcodes start with a <code>0</code>. The ticket database must have stored the zipcode as an integer, which trimmed off the leading zero. Now that we know the problem, we can fix it.</p>

<p>Let&#8217;s write a method to print out the current zipcodes from the CSV. We&#8217;ll call it <code>print_zipcodes</code> and model it after our <code>print_numbers</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_zipcodes</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">zipcode</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:zipcode</span><span class="o">]</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">zipcode</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run that and you should see the list of uncleaned zipcodes scroll by.</p>

<h3>Step 1: Zero-Padding Existing Zipcodes</h3>

<p>Let&#8217;s write a little pseudo-code:</p>

<ul>
<li>If the zipcode is less than 5 digits, add zeros on to the front until it becomes five digits</li>
<li>If the zipcode is exactly 5 digits, assume it&#8217;s ok</li>
</ul>

<h4>Beginning the Implementation</h4>

<p>Turning that into code we should create a <code>clean_zipcode</code> method. Model it after the structure of your <code>clean_number</code> method. Name the parameter <code>original</code> like we did in <code>clean_number</code>. Assuming you have that structure we can start to map out the method&#8217;s code&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_zipcode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">original</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span class='line'>      <span class="c1"># Add zeros on the front</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># Do nothing</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#return the result</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then, to use it:</p>

<ul>
<li>In your <code>print_zipcodes</code> method change <code>zipcode = line[:zipcode]</code> to <code>zipcode = clean_zipcode(line[:zipcode])</code></li>
<li>Change the instruction at the very bottom of the script from <code>jsa.print_numbers</code> to <code>jsa.print_zipcodes</code></li>
<li>Run the program and see if it fixes the short zipcodes</li>
</ul>

<h4>Dealing with <code>nil</code></h4>

<p>Uh-oh. Did you get an error? The program got through a bunch of the zipcodes then spat this out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="s1">&#39;clean_zipcode&#39;</span><span class="p">:</span> <span class="n">undefined</span> <span class="nb">method</span> <span class="sb">`length&#39; for nil:NilClass (NoMethodError)</span>
</span></code></pre></td></tr></table></div></figure>

<p>In this case, CSV is giving us a <code>nil</code> if the CSV file doesn&#8217;t have any information in the zipcode cell.</p>

<p>Dealing with <code>nil</code> values in your code can be a huge pain in the neck. The situation we have now is very typical: you write code that works great for most of the cases, then it hits one <code>nil</code> and blows up. Most frequently these problems are generated by trying to call methods or access attributes of <code>nil</code>. The solution, then, is to check if the zipcode is <code>nil</code> before doing other things to it.</p>

<p>Here&#8217;s one approach to protect against nil:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_zipcode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">original</span><span class="o">.</span><span class="n">nil?</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>  <span class="c1"># If it is nil, it&#39;s junk  </span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span class='line'>      <span class="c1"># Add zeros on the front</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="c1"># Do Nothing</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">#return the result</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Adding the Zeros</h4>

<p>The zipcodes that are missing their leading zeros are mostly four digits long, so just adding one zero to the front would probably fix it. But 00601, for instance, is a valid zipcode. In our data there are a few of these two-leading-zero zipcodes. </p>

<p>There are several ways you can do this:</p>

<ul>
<li>Using a <code>while</code> or <code>until</code> loop</li>
<li>Calculating the number of missing zeros and adding them to the front</li>
<li>Adding a fixed number of zeros to the front and trimming the result</li>
<li>Using a method from the String API for buffering strings to a certain length</li>
</ul>

<p>See if you can make each of the four work!</p>

<h3>Step 2: Test &amp; Refactor</h3>

<p>The Ruby community has a saying &quot;Keep it DRY&quot; where DRY = Don&#8217;t Repeat Yourself. Whenever you do the same thing twice you introduce the possibility for mistakes down the road. Try to cut any repetition down inside your code. </p>

<p>If you implemented more than one of the solutions for adding the zeros, which one best communicates the purpose? That&#8217;s the one you should use.</p>

<h4>Magic Numbers</h4>

<p>Lastly, the invalid zipcode is a &quot;Magic Number&quot; inside the logic of your program. It&#8217;s likely that, during the lifetime of the program, this marker will change. And that shouldn&#8217;t really mean changing the logic of our program.</p>

<p>To improve the situation we should introduce a <em>constant</em>. A constant is a special variable that we don&#8217;t change, think of it as a way to give a name to a piece of data throughout our program. In Ruby, a constant starts with a capital letter and is usually written in all caps like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">INVALID_ZIPCODE</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<p>We normally define constants near the top of the class like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="no">INVALID_ZIPCODE</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>
</span><span class='line'>  <span class="c1">#...everything else...</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then use the <code>INVALID_ZIPCODE</code> constant instead of the string <code>&quot;00000&quot;</code> in your <code>clean_zipcode</code>.</p>

<p>RUN it and make sure there are no errors and the data looks good, then we&#8217;re ready for the next iteration!</p>

<h2>Iteration 3: Outputting Cleaned Data</h2>

<p>We&#8217;ve done good work cleaning the zipcodes and phone numbers. Let&#8217;s now output the clean data to a new file.</p>

<h3>Step 0: Print Out What&#8217;s There</h3>

<p>Let&#8217;s create a method that&#8217;ll handle writing out the file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">output_data</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;event_attendees_clean.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">line</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then change the line at the bottom of your program from <code>jsa.print_zipcodes</code> to <code>jsa.output_data</code>. Run the program, check that no errors were generated, then look in your project folder and you should see a file &quot;event<em>attendees</em>clean.csv&quot;. </p>

<p>Open that file (with Excel, Numbers, OpenOffice, or a text editor) and see that it looks like the original &#8211; almost. It&#8217;s missing the headers.</p>

<h3>Step 1: Headers</h3>

<p>How do we get the headers for the CSV? There are a few options, but the easiest is to ask one of the CSV line objects. Each line has a method <code>headers</code> that will return an array of the headers. So our method could look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">output_data</span>
</span><span class='line'>    <span class="n">output</span> <span class="o">=</span> <span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;event_attendees_clean.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="c1"># if this is the first line</span>
</span><span class='line'>      <span class="c1">#   output the headers</span>
</span><span class='line'>      <span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">line</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>How do we figure out if it&#8217;s the first line? The CSV object, stored in <code>@file</code>, has a <code>lineno</code> method that tells you what line it&#8217;s on. Write an <code>if</code> condition that checks if <code>@file.lineno</code> is equal to zero. If it is, output the headers with <code>output &lt;&lt; line.headers</code>.</p>

<h3>Step 2: In-Place Phone Number and Zipcode Cleaning</h3>

<p>The <code>line</code> object we&#8217;ve been working with is loaded into memory using the data in the original file. Since it&#8217;s in memory, we can make changes to <code>line</code> itself without affecting the original file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span> <span class="o">=</span> <span class="n">clean_number</span><span class="p">(</span><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Outputting the Clean Phone Number</h4>

<p>Reading this line would start on the right side and sound like &quot;Take the value of <code>line[:homephone]</code>, put it into the <code>clean_number</code> method, then take the return value that the method gives you back and store it into <code>line[:homephone]</code>.&quot;  Looking at your <code>output_data</code> method, add this line right before <code>output &lt;&lt; line</code>. Try running the code and verify that the phone numbers are cleaned up in the output file.</p>

<h4>Outputting the Clean Zipcode</h4>

<p>Next, add a similar instruction that sends <code>line[:zipcode]</code> into the <code>clean_zipcode</code> method and stores it back into <code>line[:zipcode]</code> before sending the <code>line</code> out to the output file. RUN these new instructions and check out the <code>event_attendees_clean.csv</code> file &#8211; does all the data look cleaned up?  It should!</p>

<h3>Step 3: Refactoring</h3>

<p>Now that we&#8217;ve created a second file we have a little problem. Our program is going to keep accessing the &quot;dirty&quot; data file because that&#8217;s what&#8217;s specified in our <code>initialize</code> method. But we want the flexibility to open either the dirty or clean data files, or really any new files too. What should we do?  We need to <em>parameterize</em> our filename.</p>

<ol>
<li>Look at the <code>initialize</code> method. See how it has the <code>filename</code> in the method body? Remove that line and make <code>filename</code> a parameter to <code>initialize</code>.</li>
<li>Go to the script at the bottom of the file and change the line <code>jsa = JSAttend.new</code> to read <code>jsa = JSAttend.new(&quot;event_attendees.csv&quot;)</code>.</li>
<li>Go to the working folder and delete the file &quot;event<em>attendees</em>clean.csv&quot;</li>
<li>Run the program and see if the &quot;event<em>attendees</em>clean.csv&quot; is correctly regenerated</li>
</ol>

<h4>Setting the Output Filename</h4>

<p>Let&#8217;s also parameterize the filename inside <code>output_data</code>:</p>

<ol>
<li>Add a parameter <code>filename</code> to the <code>output_data</code> method</li>
<li>Change the actual filename in the <code>CSV.open</code> method call to the variable <code>filename</code></li>
<li>In the script, change <code>jsa.output_data</code> to <code>jsa.output_data(&quot;event_attendees_clean.csv&quot;)</code></li>
<li>Delete the cleaned CSV file and run everything again to make sure it&#8217;s working properly.</li>
</ol>

<h2>Iteration 4: Congressional Lookup</h2>

<p>This conference was about a political issue, and we wanted the participants to interact with their congresspeople. Since we already have their zipcodes we can take advantage of an API from the Sunlight Foundation to lookup the appropriate congresspeople.</p>

<h3>Step 0: Framework</h3>

<p>We&#8217;ll need an additional library to help us connect to and read the data from the API. Add this line below the existing <code>require</code> lines at the beginning of your program file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sunlight&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then create a method that looks like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">rep_lookup</span>
</span><span class='line'>    <span class="mi">20</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">line</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">representative</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span>
</span><span class='line'>      <span class="c1"># API Lookup Goes Here</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:last_name</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">line</span><span class="o">[</span><span class="ss">:zipcode</span><span class="o">]</span><span class="si">}</span><span class="s2">, </span><span class="si">#{</span><span class="n">representative</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>This is a little different than the other methods we&#8217;ve started with. The first part that will stand out is this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">20</span><span class="o">.</span><span class="n">times</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">line</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span></code></pre></td></tr></table></div></figure>

<p>The CSV library reads one line at a time. Now that we&#8217;re accessing a public API, it&#8217;s unkind to generate the traffic of looking up thousands and thousands of attendees each time we run the program &#8211; not to mention that&#8217;ll take a long time. </p>

<p>CSV doesn&#8217;t give us a way to just grab a certain number of lines from the file, so here we&#8217;ve used the <code>times</code> method on the integer <code>20</code>, creating a loop that will run twenty times. Each time through the loop it&#8217;ll pull one line from the CSV file using the <code>readline</code> method, storing it into <code>line</code>.</p>

<p>Run this code and you should see output like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'><span class="no">Nguyen</span><span class="p">,</span> <span class="no">Allison</span><span class="p">,</span> <span class="mi">20010</span><span class="p">,</span> <span class="n">unknown</span>
</span><span class='line'><span class="no">Hankins</span><span class="p">,</span> <span class="no">SArah</span><span class="p">,</span> <span class="mi">20009</span><span class="p">,</span> <span class="n">unknown</span>
</span><span class='line'><span class="no">Xx</span><span class="p">,</span> <span class="no">Sarah</span><span class="p">,</span> <span class="mi">33703</span><span class="p">,</span> <span class="n">unknown</span>
</span><span class='line'><span class="no">Cope</span><span class="p">,</span> <span class="no">Jennifer</span><span class="p">,</span> <span class="mi">37216</span><span class="p">,</span> <span class="n">unknown</span>
</span></code></pre></td></tr></table></div></figure>

<h3>Step 1: Experimenting with the Sunlight API</h3>

<p>Most APIs work by requesting a very complicated web address. In the case of the Sunlight API, the API we&#8217;ll be accessing can be found here:</p>

<p><a href="http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&zip=22182">http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&amp;zip=22182</a></p>

<p>Take a close look at that address. Here&#8217;s how it breaks down:</p>

<ul>
<li><code>http://</code> : Use the HTTP protocol</li>
<li><code>services.sunlightlabs.com</code> : The server address on the internet </li>
<li><code>/api/</code> : The &#8216;folder&#8217;, used to namespace the API from the rest of their website</li>
<li><code>legislators.</code> : The object name</li>
<li><code>allForZip.</code> : The method called on that object</li>
<li><code>xml</code> : The return format expected</li>
<li><code>?</code> : Parameters to the method

<ul>
<li><code>apikey=e179a6973728c4dd3fb1204283aaccb5</code> : A registered API Key to authenticate our requests</li>
<li><code>&amp;</code> : The parameter separator</li>
<li><code>zip=22182</code> : The zipcode we want to lookup</li>
</ul></li>
</ul>

<p>We&#8217;re accessing the <code>legislators.allForZip</code> method of their API, we send in an <code>apikey</code> which is the string that identifies JumpstartLab as the accessor of the API, then at the very end we have a <code>zip</code>. Try modifying the address with your own zipcode and load the page.</p>

<p>If you&#8217;re familiar with writing HTML then this XML document probably makes some sense to you. You can see there is a <code>response</code> object that has a list of <code>legislators</code>. That list contains five <code>legislator</code> objects which each contain a ton of data about a legislator. Cool!</p>

<h3>Step 2: Dealing with XML and JSON</h3>

<p>What we want for this API lookup is a comma separated list of the first initial and the last name like this: F.Wolf, G.Connolly, J.Webb. We could retrieve the raw XML for each attendee and find the names in there, but there&#8217;s an easier way.</p>

<h4>Loading the Sunlight Gem</h4>

<p>Luigi Montanez, a developer at Sunlight Labs, created the <code>sunlight</code> gem. We call this a wrapper library because its job is to hide complexity from us. We can interact with it as a regular Ruby object, then the library takes care of fetching and parsing data from the server.</p>

<p>Up at the very top of your program is the <em>Dependencies</em> section. There, add a <code>require</code> to load the <code>sunlight</code> gem:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;sunlight&#39;</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Set the API Key</h4>

<p>Just like the request we examined in the browser, all our requests to the Sunlight API need to be signed with our API key.</p>

<p>Just below your <code>INVALID_EMAIL</code> and <code>INVALID_PHONE_NUMBER</code> constants, set the API key within the library like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Sunlight</span><span class="o">::</span><span class="no">Base</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;e179a6973728c4dd3fb1204283aaccb5&quot;</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Accessing the API</h4>

<p>Now what can we actually DO with the <code>Sunlight</code> library?  Check out the readme on the project homepage: &quot;<a href="http://github.com/sunlightlabs/ruby-sunlightapi":http://github.com/sunlightlabs/ruby-sunlightapi">http://github.com/sunlightlabs/ruby-sunlightapi&quot;:http://github.com/sunlightlabs/ruby-sunlightapi</a></p>

<p>We&#8217;re interested in the <code>Legislator</code> object. Looking at the examples in the ReadMe you&#8217;ll see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">congresspeople</span> <span class="o">=</span> <span class="no">Sunlight</span><span class="o">::</span><span class="no">Legislator</span><span class="o">.</span><span class="n">all_for</span><span class="p">(</span><span class="ss">:address</span> <span class="o">=&gt;</span> <span class="s2">&quot;123 Fifth Ave New York, NY 10003&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>That&#8217;s how to fetch information for a specific address, but our task is to find them via zipcode. Look back at the URL we used to view the XML. See how it has <code>legislators.allForZip</code>?  The wrapper library should have a similar method. If you dig into the project&#8217;s source code, open the <code>lib</code> folder, open the <code>sunlight</code> folder, then <code>legislator.rb</code>. Search the page for <code>zipcode</code> and find a method that starts like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">all_in_zipcode</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure> 

<p>Perfect!  It takes in a zipcode and returns a list of legislators. </p>

<h4>Fetching Legislators</h4>

<p>Let&#8217;s try it within the loop of our <code>rep_lookup</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">legislators</span> <span class="o">=</span> <span class="no">Sunlight</span><span class="o">::</span><span class="no">Legislator</span><span class="o">.</span><span class="n">all_in_zipcode</span><span class="p">(</span><span class="n">zipcode</span><span class="p">)</span>
</span><span class='line'><span class="nb">puts</span> <span class="n">legislators</span>
</span></code></pre></td></tr></table></div></figure> 

<p>Run your program and check out the results. </p>

<h4>Accessing Legislator Attributes</h4>

<p>Did it work? You&#8217;re probably seeing lines like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#&lt;Sunlight::Legislator:0x102525280&gt;</span>
</span></code></pre></td></tr></table></div></figure> 

<p>That&#8217;s ruby&#8217;s way of printing out a <code>Legislator</code> object. Not very informative, but it shows us that legislators are being found which is good!  </p>

<p>Next we should access the name of the legislator within that object &#8211; but how do we know what it&#8217;s called?  Return to the <code>legislator.rb</code> source code and, near the top of the page, you&#8217;ll see this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="kp">attr_accessor</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:firstname</span><span class="p">,</span> <span class="ss">:middlename</span><span class="p">,</span> <span class="ss">:lastname</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:name_suffix</span><span class="p">,</span> <span class="ss">:nickname</span><span class="p">,</span><span class="ss">:party</span><span class="p">,</span> <span class="ss">:state</span><span class="p">,</span> <span class="ss">:district</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:gender</span><span class="p">,</span> <span class="ss">:phone</span><span class="p">,</span> <span class="ss">:fax</span><span class="p">,</span> <span class="ss">:website</span><span class="p">,</span> <span class="ss">:webform</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:congress_office</span><span class="p">,</span> <span class="ss">:bioguide_id</span><span class="p">,</span> <span class="ss">:votesmart_id</span><span class="p">,</span> <span class="ss">:fec_id</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:govtrack_id</span><span class="p">,</span> <span class="ss">:crp_id</span><span class="p">,</span> <span class="ss">:event_id</span><span class="p">,</span> <span class="ss">:congresspedia_url</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:youtube_url</span><span class="p">,</span> <span class="ss">:twitter_id</span><span class="p">,</span> <span class="ss">:fuzzy_score</span><span class="p">,</span> <span class="ss">:in_office</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:senate_class</span><span class="p">,</span> <span class="ss">:birthdate</span>
</span></code></pre></td></tr></table></div></figure> 

<p>This is a list of all the attributes (<code>attr_accessor</code> means &quot;attribute accessor&quot;) that a <code>Legislator</code> has, all the information it knows. If we want their URL we ask for <code>.website</code>, or fax number with <code>.fax</code>. Here we&#8217;re interested in their first and last name. </p>

<p>We&#8217;ll need to loop through <code>each</code> of the legislators &#8211; <em>replace</em> the <code>puts legislators</code> line with this code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">legislators</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">leg</span><span class="o">|</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">leg</span><span class="o">.</span><span class="n">firstname</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run your program and check out the results. More impressive, right?</p>

<h3>Step 3: Pulling Names and Formatting the Output</h3>

<p>You can see that it&#8217;s finding one or more representatives and spewing their first names out. But we want just the first initial and last name. We need to query each legislator object and fetch the first initial and last name. We should gather these results into an array so they can be printed all at once.</p>

<h4>Using <code>.collect</code></h4>

<p>Ruby collections, like our <code>legislators</code> object, have a method named <code>.collect</code>. It accepts a block parameter, runs that block once for each element in the collection, then returns an array of the results.</p>

<p>For example, you could do this in IRB:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='irb'><span class='line'><span class="go">&gt; [1,2,3].collect do |i|</span>
</span><span class='line'><span class="go">&gt;   i*10</span>
</span><span class='line'><span class="go">&gt; end</span>
</span><span class='line'><span class="go"># =&gt; [10, 20, 30] </span>
</span></code></pre></td></tr></table></div></figure>

<p>Collect goes through the list, runs the block, and returns the collected results.</p>

<h4><code>.collect</code> on <code>legislators</code></h4>

<p>We can use that approach with our <code>legislators</code> collection:</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">names</span> <span class="o">=</span> <span class="n">legislators</span><span class="o">.</span><span class="n">collect</span> <span class="k">do</span> <span class="o">|</span><span class="n">leg</span><span class="o">|</span>
</span><span class='line'>  <span class="n">first<em>name</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">first</em>name</span>
</span><span class='line'>  <span class="n">first<em>initial</span> <span class="o">=</span> <span class="n">first</em>name</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</span><span class='line'>  <span class="n">last<em>name</span> <span class="o">=</span> <span class="n">leg</span><span class="o">.</span><span class="n">last</em>name</span>
</span><span class='line'>  <span class="n">first<em>initial</span> <span class="o">+</span> <span class="s2">&quot;. &quot;</span> <span class="o">+</span> <span class="n">last</em>name</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">That</span> <span class="n">last</span> <span class="n">line</span> <span class="n">looks</span> <span class="n">a</span> <span class="n">little</span> <span class="n">funny</span> <span class="n">because</span> <span class="n">it</span> <span class="n">isn</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">being</span> <span class="n">stored</span> <span class="n">anywhere</span><span class="o">.</span> <span class="no">The</span> <span class="n">last</span> <span class="n">line</span> <span class="n">of</span> <span class="n">a</span> <span class="n">block</span> <span class="n">is</span> <span class="n">going</span> <span class="n">to</span> <span class="n">create</span> <span class="n">the</span> <span class="s2">&quot;return value&quot;</span> <span class="k">for</span> <span class="n">the</span> <span class="n">whole</span> <span class="n">block</span><span class="p">,</span> <span class="n">so</span> <span class="k">in</span> <span class="n">this</span> <span class="k">case</span> <span class="n">it</span> <span class="n">will</span> <span class="n">build</span> <span class="n">the</span> <span class="n">string</span> <span class="n">that</span> <span class="nb">gets</span> <span class="n">gathered</span> <span class="n">by</span> <span class="sb"><code>.collect</code></span><span class="o">.</span> <span class="no">Our</span> <span class="sb"><code>names</code></span> <span class="n">array</span> <span class="n">will</span> <span class="n">now</span> <span class="n">hold</span> <span class="n">the</span> <span class="n">formatted</span> <span class="n">strings</span> <span class="k">for</span> <span class="n">each</span> <span class="n">legislator</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Printing the Results</span>
</span><span class='line'>
</span><span class='line'><span class="no">Change</span> <span class="n">the</span> <span class="n">final</span> <span class="sb"><code>puts</code></span> <span class="n">line</span> <span class="k">in</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">so</span> <span class="n">it</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
puts &quot;#{line[:last<em>name]}, #{line[:first</em>name]}, #{line[:zipcode]}, #{names.join(&quot;, &quot;)}&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="n">significant</span> <span class="n">change</span> <span class="n">being</span> <span class="n">the</span> <span class="n">last</span> <span class="n">part</span> <span class="n">that</span> <span class="n">says</span> <span class="sb"><code>names.join(&amp;quot;, &amp;quot;)</code></span><span class="o">.</span> <span class="no">Calling</span> <span class="n">the</span> <span class="sb"><code>.join</code></span> <span class="nb">method</span> <span class="n">means</span> <span class="s2">&quot;take each thing in the list <code>names</code> and <code>join</code> them together with a comma and space between each one.&quot;</span>  <span class="no">Run</span> <span class="n">your</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
Nguyen, Allison, 20010, E.Norton
Hankins, SArah, 20009, E.Norton
Xx, Sarah, 33703, M.Martinez, B.Nelson, C.Young
Cope, Jennifer, 37216, J.Cooper, B.Corker, L.Alexander
Zimmerman, Douglas, 50309, T.Harkin, C.Grassley, L.Boswell</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Extra Challenges</span>
</span><span class='line'>
</span><span class='line'><span class="mi">1</span><span class="o">.</span> <span class="no">Output</span> <span class="n">the</span> <span class="n">party</span> <span class="k">in</span> <span class="n">parens</span> <span class="n">like</span> <span class="sb"><code>&amp;quot;E.Norton (D)&amp;quot;</code></span>
</span><span class='line'><span class="mi">2</span><span class="o">.</span> <span class="no">Prefix</span> <span class="n">the</span> <span class="nb">name</span> <span class="n">with</span> <span class="n">their</span> <span class="n">title</span> <span class="sb"><code>&amp;quot;Sen&amp;quot;</code></span><span class="p">,</span> <span class="sb"><code>&amp;quot;Rep&amp;quot;</code></span><span class="p">,</span> <span class="ow">or</span> <span class="sb"><code>&amp;quot;Del&amp;quot;</code></span>
</span><span class='line'>
</span><span class='line'><span class="c1">## Iteration 5: Form Letters</span>
</span><span class='line'>
</span><span class='line'><span class="no">Every</span> <span class="n">organization</span> <span class="n">has</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">form</span> <span class="n">letters</span> <span class="ow">and</span> <span class="n">somehow</span> <span class="n">it</span> <span class="n">seems</span> <span class="n">to</span> <span class="n">always</span> <span class="n">be</span> <span class="n">a</span> <span class="n">pain</span> <span class="k">in</span> <span class="n">the</span> <span class="n">neck</span><span class="o">.</span> <span class="no">Here</span><span class="s1">&#39;s one way we could do it with Ruby and HTML.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">### Step 0: Framework &amp; Goals</span>
</span><span class='line'>
</span><span class='line'><span class="s1">First, download the HTML form letter here: <a href="form_letter.html">/assets/jsattend/form_letter.html</a></span>
</span><span class='line'>
</span><span class='line'><span class="s1">Open that HTML file in your editor and check out the structure. You&#39;</span><span class="n">ll</span> <span class="n">see</span> <span class="n">markers</span> <span class="n">like</span> <span class="sb"><code>#first_name</code></span> <span class="n">which</span> <span class="n">we</span> <span class="n">can</span> <span class="n">use</span> <span class="n">to</span> <span class="n">fill</span> <span class="k">in</span> <span class="n">the</span> <span class="n">attendee</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">details</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Adding the Method</span>
</span><span class='line'>
</span><span class='line'><span class="no">Next</span><span class="p">,</span> <span class="n">add</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">to</span> <span class="n">your</span> <span class="sb"><code>JSAttend</code></span> <span class="k">class</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def create<em>form</em>letters
    letter = File.open(&quot;form_letter.html&quot;, &quot;r&quot;).read
    20.times do
      line = @file.readline</p>

<pre><code>  # Do your string substitutions here
end  
</code></pre>

<p>end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sb"><code>File.open</code></span> <span class="n">tells</span> <span class="no">Ruby</span> <span class="n">to</span> <span class="n">look</span> <span class="k">for</span> <span class="n">a</span> <span class="n">file</span> <span class="n">named</span> <span class="sb"><code>form_letter.html</code></span> <span class="ow">and</span> <span class="n">the</span> <span class="sb"><code>&amp;quot;r&amp;quot;</code></span> <span class="n">tells</span> <span class="n">it</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">it</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span><span class="o">.</span> <span class="no">The</span> <span class="sb"><code>.read</code></span> <span class="nb">method</span> <span class="n">says</span> <span class="s2">&quot;load the whole file as a string&quot;</span> <span class="ow">and</span> <span class="n">we</span> <span class="n">save</span> <span class="n">it</span> <span class="n">into</span> <span class="sb"><code>letter</code></span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Step 1: Customizing the Text</span>
</span><span class='line'>
</span><span class='line'><span class="no">Use</span> <span class="n">the</span> <span class="sb"><code>gsub</code></span> <span class="nb">method</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">markers</span> <span class="k">in</span> <span class="n">the</span> <span class="n">text</span> <span class="ow">and</span> <span class="n">replace</span> <span class="n">them</span> <span class="n">with</span> <span class="n">the</span> <span class="n">data</span> <span class="n">from</span> <span class="sb"><code>line</code></span><span class="o">.</span> <span class="sb"><code>gsub</code></span> <span class="n">takes</span> <span class="n">two</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">the</span> <span class="n">first</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="n">to</span> <span class="n">search</span> <span class="k">for</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">second</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="n">to</span> <span class="n">replace</span> <span class="n">it</span> <span class="n">with</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>ruby
custom<em>letter = letter.gsub(&quot;#firstname&quot;,firstname)
custom</em>letter = custom_letter.gsub(&quot;#lastname&quot;,lastname)</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Continue</span> <span class="n">writing</span> <span class="sb"><code>gsub</code></span> <span class="n">lines</span> <span class="n">like</span> <span class="n">the</span> <span class="n">last</span> <span class="n">one</span> <span class="k">for</span> <span class="n">your</span> <span class="n">other</span> <span class="n">variables</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Step 2: Writing out the File</span>
</span><span class='line'>
</span><span class='line'><span class="no">Now</span> <span class="n">that</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">creating</span> <span class="n">the</span> <span class="n">customized</span> <span class="n">text</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">output</span> <span class="n">it</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Creating an <code>output</code> Directory</span>
</span><span class='line'>
</span><span class='line'><span class="no">To</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">output</span> <span class="n">files</span> <span class="n">separate</span> <span class="n">from</span> <span class="n">your</span> <span class="n">program</span><span class="p">,</span> <span class="n">create</span> <span class="n">a</span> <span class="n">directory</span> <span class="n">named</span> <span class="sb"><code>output</code></span> <span class="n">inside</span> <span class="n">your</span> <span class="n">project</span> <span class="n">directory</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Writing the Files</span>
</span><span class='line'>
</span><span class='line'><span class="no">You</span> <span class="n">can</span> <span class="n">create</span> <span class="n">a</span> <span class="n">filename</span><span class="p">,</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">file</span><span class="p">,</span> <span class="ow">and</span> <span class="n">write</span> <span class="n">the</span> <span class="sb"><code>custom_letter</code></span> <span class="n">to</span> <span class="n">that</span> <span class="n">file</span> <span class="n">with</span> <span class="n">these</span> <span class="n">instructions</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
filename = &quot;output/thanks<em>#{lastname}</em>#{firstname}.html&quot;
output = File.new(filename, &quot;w&quot;)
output.write(custom_letter)</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Check the Results</span>
</span><span class='line'>
</span><span class='line'><span class="no">Run</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">from</span> <span class="n">your</span> <span class="n">script</span> <span class="ow">and</span> <span class="n">examine</span> <span class="n">the</span> <span class="n">output</span><span class="o">.</span> <span class="no">Are</span> <span class="n">all</span> <span class="n">the</span> <span class="n">markers</span> <span class="n">replaced</span> <span class="n">correctly?</span>
</span><span class='line'>
</span><span class='line'><span class="c1">## Iteration 6: Time Targeting</span>
</span><span class='line'>
</span><span class='line'><span class="no">The</span> <span class="n">boss</span> <span class="n">is</span> <span class="n">already</span> <span class="n">thinking</span> <span class="n">about</span> <span class="n">the</span> <span class="k">next</span> <span class="n">conference</span><span class="p">:</span> <span class="s2">&quot;Next year I want to make better use of our Google and Facebook advertising. Find out which hours of the day the most people registered so we can run more ads during those hours.&quot;</span>  <span class="no">Interesting</span><span class="o">!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Step 0: Framework</span>
</span><span class='line'>
</span><span class='line'><span class="no">We</span><span class="s1">&#39;ll create a list of 24 slots, one for each hour of the day. Each slot will start with a count of zero. We&#39;</span><span class="n">ll</span> <span class="n">go</span> <span class="n">through</span> <span class="n">the</span> <span class="n">registrant</span> <span class="n">list</span> <span class="ow">and</span><span class="p">,</span> <span class="k">for</span> <span class="n">each</span> <span class="n">one</span><span class="p">,</span> <span class="n">increase</span> <span class="n">the</span> <span class="n">hour</span> <span class="n">that</span> <span class="n">they</span> <span class="n">registered</span> <span class="n">by</span> <span class="n">one</span><span class="o">.</span> <span class="no">Then</span> <span class="n">we</span><span class="err">&#39;</span><span class="n">ll</span> <span class="nb">print</span> <span class="n">out</span> <span class="n">the</span> <span class="n">list</span> <span class="n">of</span> <span class="n">hours</span> <span class="n">with</span> <span class="n">their</span> <span class="n">total</span> <span class="n">registration</span> <span class="n">counts</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def time<em>stats
    hours = Array.new(24){0}
    @file.each do |line|
      # Do the counting here
    end
    hours.each</em>with_index{|counter,hour| puts &quot;#{hour}\t#{counter}&quot;}<br>
  end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### A First Run</span>
</span><span class='line'>
</span><span class='line'><span class="no">Change</span> <span class="n">the</span> <span class="n">instruction</span> <span class="k">in</span> <span class="n">your</span> <span class="n">script</span> <span class="n">to</span> <span class="sb"><code>jsa.rank_times</code></span> <span class="ow">and</span> <span class="n">run</span> <span class="n">it</span><span class="o">.</span> <span class="no">You</span> <span class="n">should</span> <span class="n">see</span> <span class="n">a</span> <span class="n">column</span> <span class="n">of</span> <span class="n">hours</span> <span class="p">(</span><span class="mi">0</span> <span class="n">to</span> <span class="mi">23</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">column</span> <span class="n">of</span> <span class="n">totals</span> <span class="p">(</span><span class="n">all</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">The</span> <span class="n">only</span> <span class="n">thing</span> <span class="kp">new</span> <span class="n">here</span> <span class="n">is</span> <span class="n">the</span> <span class="nb">method</span> <span class="sb"><code>each_with_index</code></span><span class="o">.</span> <span class="no">It</span> <span class="n">works</span> <span class="n">just</span> <span class="n">like</span> <span class="sb"><code>each</code></span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">includes</span> <span class="n">an</span> <span class="sb"><code>index</code></span> <span class="n">value</span> <span class="n">which</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">current</span> <span class="n">element</span><span class="s1">&#39;s position in the list. So for the first item in the list, the <code>index</code> is <code>0</code>, for the second it is <code>1</code> and so on. </span>
</span><span class='line'>
</span><span class='line'><span class="s1">### Step 1: Find the Hour &amp; Update the Counter</span>
</span><span class='line'>
</span><span class='line'><span class="s1">If you look at the spreadsheet you&#39;</span><span class="n">ll</span> <span class="n">see</span> <span class="n">that</span> <span class="n">the</span> <span class="sb"><code>regdate</code></span> <span class="n">field</span> <span class="n">data</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span> <span class="sb"><code>11/12/08 10:47</code></span><span class="o">.</span> <span class="no">We</span> <span class="n">need</span> <span class="n">a</span> <span class="n">way</span> <span class="n">to</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">just</span> <span class="n">the</span> <span class="n">hour</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Understanding <code>.split</code></span>
</span><span class='line'>
</span><span class='line'><span class="no">We</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">use</span> <span class="n">the</span> <span class="nb">method</span> <span class="sb"><code>.split</code></span> <span class="n">to</span> <span class="n">help</span> <span class="n">us</span> <span class="n">out</span><span class="o">.</span> <span class="sb"><code>split</code></span> <span class="n">takes</span> <span class="n">one</span> <span class="n">parameter</span> <span class="n">which</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="nb">split</span> <span class="n">on</span><span class="o">.</span> <span class="no">So</span> <span class="k">if</span> <span class="n">my</span> <span class="n">string</span> <span class="n">were</span> <span class="sb"><code>&amp;quot;hello jumpstart lab&amp;quot;</code></span> <span class="ow">and</span> <span class="n">I</span> <span class="n">called</span> <span class="sb"><code>.split(&amp;quot; &amp;quot;)</code></span> <span class="n">on</span> <span class="n">it</span><span class="p">,</span> <span class="no">Ruby</span> <span class="n">would</span> <span class="nb">split</span> <span class="n">it</span> <span class="n">up</span> <span class="n">each</span> <span class="n">time</span> <span class="n">it</span> <span class="n">finds</span> <span class="n">a</span> <span class="n">space</span> <span class="ow">and</span> <span class="n">give</span> <span class="n">me</span> <span class="n">back</span> <span class="n">a</span> <span class="n">list</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span> <span class="sb"><code>[&amp;quot;hello&amp;quot;,&amp;quot;jumpstart&amp;quot;,&amp;quot;lab&amp;quot;]</code></span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Once</span> <span class="n">you</span> <span class="n">have</span> <span class="n">that</span> <span class="n">array</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">individual</span> <span class="n">parts</span> <span class="n">by</span> <span class="n">position</span><span class="o">.</span> <span class="no">If</span> <span class="n">I</span> <span class="n">wanted</span> <span class="n">the</span> <span class="n">first</span> <span class="n">chunk</span> <span class="n">I</span> <span class="n">would</span> <span class="n">ask</span> <span class="k">for</span> <span class="sb"><code>[0]</code></span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">second</span> <span class="n">would</span> <span class="n">be</span> <span class="sb"><code>[1]</code></span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">third</span> <span class="sb"><code>[2]</code></span><span class="o">.</span> <span class="no">Check</span> <span class="n">out</span> <span class="n">this</span> <span class="n">example</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
my<em>string = &quot;hello and welcome to jumpstart lab&quot;
parts = my</em>string.split(&quot; &quot;)
puts parts[0] # This would print out &quot;hello&quot;
puts parts[3] # This would print out &quot;to&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Parsing the Regdate</span>
</span><span class='line'>
</span><span class='line'><span class="no">Go</span> <span class="n">into</span> <span class="n">an</span> <span class="no">IRB</span> <span class="n">terminal</span> <span class="ow">and</span> <span class="n">enter</span> <span class="sb"><code>timestamp = &amp;quot;11/12/08 10:47&amp;quot;</code></span><span class="o">.</span> <span class="no">Then</span> <span class="n">experiment</span> <span class="n">with</span> <span class="n">using</span> <span class="sb"><code>split</code></span><span class="o">.</span> <span class="no">How</span> <span class="n">can</span> <span class="n">you</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">just</span> <span class="n">the</span> <span class="sb"><code>10</code></span><span class="p">?</span>  <span class="no">HINT</span><span class="p">:</span> <span class="no">You</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">need</span> <span class="n">to</span> <span class="n">use</span> <span class="sb"><code>split</code></span> <span class="n">twice</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Incrementing the Counter</span>
</span><span class='line'>
</span><span class='line'><span class="no">Once</span> <span class="n">you</span> <span class="n">figure</span> <span class="n">it</span> <span class="n">out</span><span class="p">,</span> <span class="n">write</span> <span class="n">code</span> <span class="k">in</span> <span class="n">your</span> <span class="sb"><code>rank_times</code></span> <span class="nb">method</span> <span class="n">that</span> <span class="n">pulls</span> <span class="n">out</span> <span class="n">the</span> <span class="n">hour</span> <span class="ow">and</span> <span class="n">stores</span> <span class="n">it</span> <span class="n">into</span> <span class="n">the</span> <span class="n">variable</span> <span class="sb"><code>hour</code></span><span class="o">.</span> <span class="no">Once</span> <span class="n">you</span> <span class="n">know</span> <span class="n">the</span> <span class="sb"><code>hour</code></span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">update</span> <span class="n">the</span> <span class="n">counter</span> <span class="n">by</span> <span class="n">doing</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
hours[hour] = hours[hour] + 1</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Checking Results</span>
</span><span class='line'>
</span><span class='line'><span class="no">Once</span> <span class="n">you</span> <span class="n">think</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">got</span> <span class="n">it</span><span class="p">,</span> <span class="n">run</span> <span class="n">the</span> <span class="nb">method</span><span class="o">.</span> <span class="no">My</span> <span class="n">first</span> <span class="n">few</span> <span class="n">lines</span> <span class="n">look</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
0   276
1   68
2   41
3   9</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">### Step 2: Requirements Always Change</span>
</span><span class='line'>
</span><span class='line'><span class="no">The</span> <span class="n">big</span> <span class="n">boss</span> <span class="nb">gets</span> <span class="n">excited</span> <span class="n">about</span> <span class="n">the</span> <span class="n">results</span> <span class="n">from</span> <span class="n">your</span> <span class="n">hourly</span> <span class="n">tabulations</span><span class="o">.</span> <span class="no">It</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">there</span> <span class="n">are</span> <span class="n">some</span> <span class="n">hours</span> <span class="n">that</span> <span class="n">are</span> <span class="n">clearly</span> <span class="n">more</span> <span class="n">important</span> <span class="n">than</span> <span class="n">others</span><span class="o">.</span> <span class="no">But</span> <span class="n">now</span><span class="p">,</span> <span class="n">tantalized</span><span class="p">,</span> <span class="n">she</span> <span class="n">wants</span> <span class="n">to</span> <span class="n">know</span> <span class="s2">&quot;What days of the week did most people register?&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Given</span> <span class="n">that</span> <span class="n">you</span><span class="s1">&#39;re pretty much a genius programmer at this point, I&#39;</span><span class="n">ll</span> <span class="n">just</span> <span class="n">give</span> <span class="n">you</span> <span class="n">some</span> <span class="n">tips</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="o"><em></span> <span class="no">Create</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">named</span> <span class="sb"><code>day_stats</code></span>
</span><span class='line'><span class="o"></em></span> <span class="no">Create</span> <span class="n">an</span> <span class="n">array</span> <span class="n">list</span><span class="p">,</span> <span class="n">just</span> <span class="n">like</span> <span class="n">you</span> <span class="n">did</span> <span class="k">for</span> <span class="sb"><code>hours</code></span> <span class="n">but</span> <span class="n">call</span> <span class="n">it</span> <span class="sb"><code>days</code></span> <span class="ow">and</span> <span class="n">make</span> <span class="n">the</span> <span class="n">size</span> <span class="sb"><code>7</code></span>
</span><span class='line'><span class="o"><em></span> <span class="no">Turn</span> <span class="n">a</span> <span class="n">string</span> <span class="n">like</span> <span class="sb"><code>11/12/08</code></span> <span class="n">into</span> <span class="n">a</span> <span class="no">Ruby</span> <span class="no">Date</span> <span class="n">with</span> <span class="n">this</span> <span class="n">instruction</span><span class="p">:</span>
</span><span class='line'>  <span class="o"></em></span> <span class="sb"><code>date = Date.strptime(&amp;quot;11/12/08&amp;quot;, &amp;quot;%m/%d/%Y&amp;quot;)</code></span>
</span><span class='line'><span class="o"><em></span> <span class="no">Once</span> <span class="n">you</span> <span class="n">have</span> <span class="n">a</span> <span class="sb"><code>date</code></span> <span class="n">object</span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">get</span> <span class="n">the</span> <span class="n">numeric</span> <span class="n">day</span> <span class="n">of</span> <span class="n">the</span> <span class="n">week</span> <span class="n">by</span> <span class="n">calling</span> <span class="n">the</span> <span class="sb"><code>.wday</code></span> <span class="nb">method</span><span class="o">.</span> <span class="no">Note</span> <span class="n">that</span> <span class="no">Sunday</span> <span class="n">is</span> <span class="sb"><code>0</code></span> <span class="ow">and</span> <span class="no">Saturday</span> <span class="n">is</span> <span class="sb"><code>6</code></span>
</span><span class='line'><span class="o"></em></span> <span class="no">Which</span> <span class="n">two</span> <span class="n">days</span> <span class="n">have</span> <span class="n">dominantly</span> <span class="n">more</span> <span class="n">registrations</span> <span class="n">than</span> <span class="n">the</span> <span class="n">others?</span>
</span><span class='line'>
</span><span class='line'><span class="c1">## Iteration 7: State Stats</span>
</span><span class='line'>
</span><span class='line'><span class="no">So</span> <span class="n">you</span> <span class="n">cleaned</span> <span class="n">up</span> <span class="n">the</span> <span class="n">data</span><span class="p">,</span> <span class="n">output</span> <span class="n">the</span> <span class="n">file</span><span class="p">,</span> <span class="ow">and</span> <span class="n">sent</span> <span class="n">it</span> <span class="n">to</span> <span class="n">your</span> <span class="n">team</span><span class="o">.</span> <span class="s2">&quot;Hey, that data looks great,&quot;</span> <span class="n">they</span> <span class="n">say</span><span class="p">,</span> <span class="s2">&quot;it makes me wonder about our stats. Can you tell us more about our attendees?&quot;</span>  <span class="no">Of</span> <span class="n">course</span> <span class="n">you</span> <span class="n">can</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Step 0: Goals &amp; Framework</span>
</span><span class='line'>
</span><span class='line'><span class="no">Let</span><span class="s1">&#39;s start with state-based information. How many attendees are from each state?  Let&#39;</span><span class="n">s</span> <span class="n">output</span> <span class="n">a</span> <span class="n">list</span> <span class="k">in</span> <span class="n">the</span> <span class="nb">format</span> <span class="s2">&quot;State: Attendee&quot;</span> <span class="n">count</span><span class="p">,</span> <span class="n">like</span> <span class="s2">&quot;MD: 26&quot;</span><span class="o">.</span> <span class="no">We</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">put</span> <span class="n">it</span> <span class="n">together</span> <span class="k">in</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">called</span> <span class="sb"><code>state_stats</code></span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def state<em>stats
    state</em>data = {}
    @file.each do |line|</p>

<pre><code>end  
</code></pre>

<p>end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">In</span> <span class="n">the</span> <span class="n">second</span> <span class="n">line</span> <span class="n">there</span> <span class="n">we</span><span class="s1">&#39;ve created a <em>Hash</em> named <code>state_stats</code>.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">### Step 1: Counting with a Hash</span>
</span><span class='line'>
</span><span class='line'><span class="s1">In this case, we&#39;</span><span class="n">ll</span> <span class="n">use</span> <span class="n">our</span> <span class="no">Hash</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">track</span> <span class="n">of</span> <span class="n">how</span> <span class="n">many</span> <span class="n">attendees</span> <span class="n">are</span> <span class="n">from</span> <span class="n">each</span> <span class="n">state</span><span class="o">.</span> <span class="no">Imagine</span> <span class="k">if</span> <span class="n">we</span> <span class="n">were</span> <span class="n">sorting</span> <span class="n">out</span> <span class="n">paper</span> <span class="n">attendee</span> <span class="n">registrations</span> <span class="n">by</span> <span class="n">hand</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="no">For</span> <span class="n">each</span> <span class="n">attendee</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o"><em></span> <span class="no">Figure</span> <span class="n">out</span> <span class="n">which</span> <span class="n">state</span> <span class="n">they</span><span class="s1">&#39;re from</span>
</span><span class='line'><span class="s1"></em> If a bucket does not exist for that state, create the bucket then put the paper in there</span>
</span><span class='line'><span class="s1">* If a bucket exists for that state, put the paper in there</span>
</span><span class='line'><span class="s1">* At the end, the number of papers in each bucket shows how many attendees are from that state</span>
</span><span class='line'>
</span><span class='line'><span class="s1">#### Building the Counter</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Inside the <code>@file.each</code> loop, let&#39;</span><span class="n">s</span> <span class="n">add</span> <span class="n">instructions</span> <span class="n">to</span> <span class="n">implement</span> <span class="n">this</span> <span class="n">logic</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def state<em>stats
    state</em>data = {}
    @file.each do |line|
      state = line[:state]  # Find the State
      if state<em>data[state].nil? # Does the state&#8217;s bucket exist in state</em>data?
        state<em>data[state] = 1 # If that bucket was nil then start it with this one person
      else
        state</em>data[state] = state_data[:state] + 1  # If the bucket exists, add one
      end
    end
  end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Running the Method</span>
</span><span class='line'>
</span><span class='line'><span class="no">Change</span> <span class="n">your</span> <span class="n">script</span> <span class="n">to</span> <span class="n">call</span> <span class="n">the</span> <span class="nb">method</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
jsa = JSAttend.new(&quot;event<em>attendees</em>clean.csv&quot;)
jsa.state_stats</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Run</span> <span class="n">that</span> <span class="n">program</span><span class="o">.</span> <span class="no">Did</span> <span class="n">it</span> <span class="n">work?</span>  <span class="no">If</span> <span class="n">it</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">error</span><span class="p">,</span> <span class="n">get</span> <span class="n">it</span> <span class="n">fixed</span><span class="o">.</span> <span class="no">If</span> <span class="n">there</span> <span class="n">was</span> <span class="n">no</span> <span class="n">error</span><span class="p">,</span> <span class="n">though</span><span class="p">,</span> <span class="n">you</span> <span class="n">probably</span> <span class="n">have</span> <span class="n">no</span> <span class="n">idea</span> <span class="k">if</span> <span class="n">it</span> <span class="n">worked</span><span class="o">.</span> <span class="no">We</span> <span class="n">didn</span><span class="s1">&#39;t print out anything. Let&#39;</span><span class="n">s</span> <span class="n">add</span> <span class="n">that</span> <span class="k">in</span> <span class="n">now</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Printing a Hash</span>
</span><span class='line'>
</span><span class='line'><span class="no">We</span><span class="s1">&#39;re collecting all the state stats in a <em>hash</em>. A hash is made up of &quot;key-value pairs&quot; -- the &quot;key&quot; is the address that helps us find what we&#39;</span><span class="n">re</span> <span class="n">looking</span> <span class="k">for</span><span class="o">.</span> <span class="no">The</span> <span class="s2">&quot;value&quot;</span> <span class="n">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">that</span> <span class="n">the</span> <span class="n">address</span> <span class="n">is</span> <span class="n">pointing</span> <span class="n">to</span><span class="o">.</span> <span class="no">Each</span> <span class="n">key</span> <span class="n">points</span> <span class="n">to</span> <span class="n">one</span> <span class="n">value</span><span class="o">.</span> <span class="no">When</span> <span class="n">we</span> <span class="n">have</span> <span class="n">a</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">these</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">we</span> <span class="n">frequently</span> <span class="n">want</span> <span class="n">to</span> <span class="n">walk</span> <span class="n">through</span> <span class="n">the</span> <span class="n">list</span> <span class="ow">and</span> <span class="k">do</span> <span class="n">something</span> <span class="n">to</span> <span class="n">each</span> <span class="n">pair</span><span class="o">.</span> <span class="no">This</span> <span class="n">state</span> <span class="n">data</span> <span class="n">is</span> <span class="n">a</span> <span class="n">perfect</span> <span class="n">example</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">What</span> <span class="n">we</span> <span class="n">really</span> <span class="n">want</span> <span class="n">is</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">out</span> <span class="n">lines</span> <span class="n">like</span> <span class="s2">&quot;CA: 206&quot;</span><span class="o">.</span> <span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="n">the</span> <span class="n">state</span> <span class="n">abbreviation</span><span class="p">,</span> <span class="n">is</span> <span class="n">the</span> <span class="n">key</span> <span class="n">of</span> <span class="n">the</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">pair</span> <span class="k">while</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">attendees</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="n">is</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pair</span><span class="o">.</span> <span class="no">Ruby</span> <span class="n">has</span> <span class="n">a</span> <span class="n">really</span> <span class="n">great</span> <span class="n">way</span> <span class="n">of</span> <span class="n">walking</span> <span class="n">through</span> <span class="n">collections</span> <span class="n">like</span> <span class="n">this</span> <span class="n">using</span> <span class="n">the</span> <span class="sb"><code>each</code></span> <span class="nb">method</span><span class="p">,</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state_data.each do |key,value|
  puts key
  puts value
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="sb"><code>each</code></span> <span class="nb">method</span> <span class="n">means</span> <span class="s2">&quot;take each pair in this hash and <code>do</code> what&#39;s inside this <code>do</code>/<code>end</code> block of code. Right after the <code>do</code> is a part that trips up a lot of people. </span>
</span><span class='line'>
</span><span class='line'><span class="s2">We need to give the data names. <code>|key,value|</code> basically translates to &quot;</span><span class="k">for</span> <span class="n">each</span> <span class="n">pair</span><span class="p">,</span> <span class="n">call</span> <span class="n">the</span> <span class="n">first</span> <span class="n">thing</span> <span class="sb"><code>key</code></span> <span class="ow">and</span> <span class="n">the</span> <span class="n">second</span> <span class="n">thing</span> <span class="sb"><code>value</code></span><span class="s2">&quot;. There&#39;s nothing magical about these particular names, they can be whatever makes sense to you. In this case, actually, we can be more explicit with our naming. Go ahead and add the following code before the <code>end</code> statement of your <code>state_stats</code> method:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state_data.each do |state, counter|
  puts state
  puts counter
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Slightly Improved Output</span>
</span><span class='line'>
</span><span class='line'><span class="no">Run</span> <span class="n">this</span> <span class="n">code</span> <span class="n">to</span> <span class="n">see</span> <span class="n">what</span> <span class="n">you</span> <span class="n">get</span><span class="o">.</span> <span class="no">Mine</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
ND
11
AL
26
VA
382
NY
503</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">### Step 2: Cleaning up the Output</span>
</span><span class='line'>
</span><span class='line'><span class="no">Getting</span> <span class="n">there</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">quite</span> <span class="n">right</span><span class="o">.</span> <span class="no">We</span> <span class="n">want</span> <span class="n">it</span> <span class="n">to</span> <span class="n">look</span> <span class="n">like</span> <span class="sb"><code>ND: 11</code></span><span class="p">,</span> <span class="ow">not</span> <span class="n">have</span> <span class="sb"><code>ND</code></span> <span class="ow">and</span> <span class="sb"><code>11</code></span> <span class="n">on</span> <span class="n">different</span> <span class="n">lines</span><span class="o">.</span> <span class="no">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="sb"><code>each</code></span> <span class="kp">loop</span> <span class="n">where</span> <span class="n">we</span> <span class="n">have</span> <span class="n">the</span> <span class="n">lines</span> <span class="sb"><code>puts state</code></span> <span class="ow">and</span> <span class="sb"><code>puts counter</code></span><span class="o">.</span> <span class="no">Take</span> <span class="n">out</span> <span class="n">those</span> <span class="n">two</span> <span class="ow">and</span> <span class="n">replace</span> <span class="n">them</span> <span class="n">with</span> <span class="n">this</span> <span class="n">interpolated</span> <span class="n">string</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
puts &quot;#{state}: #{counter}&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">line</span> <span class="n">could</span> <span class="n">be</span> <span class="n">read</span> <span class="n">as</span> <span class="s2">&quot;printout whatever is in the variable named <code>state</code>, then a colon, then a space, then whatever is in the variable named <code>counter</code>.&quot;</span>  <span class="no">Once</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">put</span> <span class="k">in</span> <span class="n">this</span> <span class="n">improved</span> <span class="sb"><code>puts</code></span> <span class="n">line</span><span class="p">,</span> <span class="no">RUN</span> <span class="n">your</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
ND: 11
AL: 26
VA: 382</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Looking</span> <span class="n">good!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Step 3: Sorting</span>
</span><span class='line'>
</span><span class='line'><span class="n">A</span> <span class="nb">hash</span> <span class="n">is</span> <span class="n">just</span> <span class="n">a</span> <span class="n">group</span> <span class="n">of</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">pairs</span><span class="o">.</span> <span class="no">They</span> <span class="n">don</span><span class="s1">&#39;t have an inherit order -- and this really frustrates a lot of people. You probably noticed that your output came out in some arbitrary order. It&#39;</span><span class="n">s</span> <span class="ow">not</span> <span class="n">alphabetical</span> <span class="n">by</span> <span class="n">state</span><span class="p">,</span> <span class="n">it</span><span class="s1">&#39;s not by region, it&#39;</span><span class="n">s</span> <span class="ow">not</span> <span class="n">by</span> <span class="n">ascending</span> <span class="ow">or</span> <span class="n">descending</span> <span class="n">totals</span><span class="o">.</span> <span class="no">These</span> <span class="n">would</span> <span class="n">all</span> <span class="n">be</span> <span class="n">reasonable</span> <span class="n">ways</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">the</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">but</span> <span class="n">we</span> <span class="n">haven</span><span class="s1">&#39;t told Ruby which to use.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">#### Using <code>sort_by</code></span>
</span><span class='line'>
</span><span class='line'><span class="s1">Thankfully hash has a method named <code>sort_by</code>. Using <code>sort_by</code> we can get the hash sorted by any criteria we wish. It uses a similar syntax to <code>each</code> that we used above. Here&#39;</span><span class="n">s</span> <span class="n">how</span> <span class="n">you</span> <span class="n">could</span> <span class="n">sort</span> <span class="n">this</span> <span class="nb">hash</span> <span class="n">alphabetically</span> <span class="n">by</span> <span class="n">the</span> <span class="n">state</span> <span class="nb">name</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state<em>data = state</em>data.sort_by{|state, counter| state unless state.nil?}</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Reading</span> <span class="n">this</span> <span class="n">would</span> <span class="n">sound</span> <span class="n">like</span> <span class="s2">&quot;take the <code>state_data</code> hash and sort it by looking at each pair, name the key <code>state</code> and name the value <code>counter</code>, then compare the <code>state</code> of each pair and ignore the value of <code>counter</code>. </span>
</span><span class='line'>
</span><span class='line'><span class="s2">This will result in an ascending alphabetical sort, and save those results back into the name <code>state_data</code>. Try it in your code by sorting the data before printing it like this:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state<em>data = state</em>data.sort<em>by{|state, counter| state unless state.nil?}
state</em>data.each do |state, counter|
  puts &quot;#{state}: #{counter}&quot;
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Run</span> <span class="n">your</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
AK: 2
AL: 26
AR: 3</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Sorting by Registration Count</span>
</span><span class='line'>
</span><span class='line'><span class="no">Now</span><span class="p">,</span> <span class="n">try</span> <span class="n">modifying</span> <span class="n">the</span> <span class="sb"><code>sort_by</code></span> <span class="n">instruction</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">by</span> <span class="sb"><code>counter</code></span> <span class="n">instead</span> <span class="n">of</span> <span class="n">state</span><span class="o">.</span> <span class="no">See</span> <span class="n">how</span> <span class="n">that</span> <span class="n">affects</span> <span class="n">your</span> <span class="n">output</span><span class="o">.</span> <span class="no">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">try</span> <span class="n">reversing</span> <span class="n">the</span> <span class="n">list</span> <span class="n">by</span> <span class="n">putting</span> <span class="sb"><code>.reverse</code></span> <span class="n">on</span> <span class="n">the</span> <span class="k">end</span> <span class="n">of</span> <span class="n">the</span> <span class="sb"><code>sort_by</code></span> <span class="nb">method</span> <span class="p">(</span><span class="n">right</span> <span class="n">after</span> <span class="n">the</span> <span class="sb"><code>}</code></span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">### Step 4: Alphabetical Order with Numbered Rank</span>
</span><span class='line'>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">really</span> <span class="n">a</span> <span class="n">little</span> <span class="n">bit</span> <span class="n">advanced</span> <span class="k">for</span> <span class="n">this</span> <span class="n">point</span> <span class="n">of</span> <span class="n">your</span> <span class="n">development</span><span class="p">,</span> <span class="n">but</span> <span class="n">here</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">how</span> <span class="n">you</span> <span class="n">could</span> <span class="n">implement</span> <span class="n">an</span> <span class="n">alphabetical</span> <span class="n">state</span> <span class="n">list</span> <span class="n">combined</span> <span class="n">with</span> <span class="n">an</span> <span class="n">attendance</span><span class="o">-</span><span class="n">count</span> <span class="n">ranking</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>ruby
    ranks = state<em>data.sort</em>by{|state, counter| counter}.collect{|state, counter| state}.reverse
    state<em>data = state</em>data.sort_by{|state, counter| state}</p>

<pre><code>state_data.each do |state, counter|
  puts &quot;#{state}:\t#{counter}\t(#{ranks.index(state) + 1})&quot; 
end
</code></pre>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="n">most</span> <span class="n">significant</span> <span class="n">change</span> <span class="n">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">line</span><span class="o">.</span> <span class="no">The</span> <span class="sb"><code>state_data.sort_by{|state, counter| counter}</code></span> <span class="n">is</span> <span class="n">just</span> <span class="n">the</span> <span class="n">same</span> <span class="n">as</span> <span class="n">the</span> <span class="n">sorting</span> <span class="n">by</span> <span class="n">the</span> <span class="sb"><code>counter</code></span> <span class="n">that</span> <span class="n">you</span> <span class="n">did</span> <span class="n">before</span><span class="o">.</span> <span class="no">Once</span> <span class="n">I</span> <span class="n">have</span> <span class="n">that</span> <span class="n">ordered</span> <span class="n">list</span><span class="p">,</span> <span class="n">I</span> <span class="n">don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">care</span> <span class="n">any</span> <span class="n">more</span> <span class="n">about</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">counts</span> <span class="n">anymore</span><span class="p">,</span> <span class="n">I</span> <span class="n">only</span> <span class="n">care</span> <span class="n">about</span> <span class="n">the</span> <span class="n">order</span><span class="o">.</span> <span class="n">I</span> <span class="k">then</span> <span class="n">use</span> <span class="n">the</span> <span class="sb"><code>collect</code></span> <span class="nb">method</span> <span class="n">to</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">the</span> <span class="n">state</span> <span class="n">names</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">basically</span> <span class="s2">&quot;for each pair in the hash, name the key of the pair <code>state</code> and the value of the pair <code>counter</code>, then give me just the <code>state</code>.&quot;</span>  <span class="no">The</span> <span class="n">results</span> <span class="n">of</span> <span class="n">this</span> <span class="sb"><code>collect</code></span> <span class="n">are</span> <span class="n">put</span> <span class="n">into</span> <span class="n">the</span> <span class="n">array</span> <span class="n">list</span> <span class="n">named</span> <span class="sb"><code>ranks</code></span><span class="o">.</span> <span class="no">If</span> <span class="n">you</span> <span class="n">were</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">it</span> <span class="n">out</span><span class="p">,</span> <span class="n">this</span> <span class="n">would</span> <span class="n">look</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
MH,BC,NV,WY,DE,NS,QC,AS,OK,AK,PW,AR,SD,FM,NE,GU,HI,PR,MS,ID,ND,KS,ON,NM,MT,UT,IA,AL,MO,YK,AZ,CO,LA,WV,SC,WA,TN,IN,RI,TX,NH,WI,GA,IL,KY,CT,OR,NJ,MN,ME,CA,FL,MI,DC,MA,OH,MD,NC,VT,PA,VA,NY</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">list</span> <span class="n">start</span> <span class="n">with</span> <span class="no">MH</span> <span class="n">because</span> <span class="n">it</span> <span class="n">has</span> <span class="mi">1</span> <span class="n">registrant</span> <span class="ow">and</span> <span class="n">ends</span> <span class="n">with</span> <span class="no">NY</span> <span class="n">because</span> <span class="n">of</span> <span class="n">its</span> <span class="mi">503</span> <span class="n">registrants</span><span class="o">.</span> <span class="n">I</span> <span class="n">want</span> <span class="n">my</span> <span class="n">rankings</span> <span class="k">in</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">order</span> <span class="p">(</span><span class="n">where</span> <span class="n">the</span> <span class="n">first</span> <span class="n">position</span> <span class="n">is</span> <span class="n">the</span> <span class="n">highest</span> <span class="sb"><code>counter</code></span><span class="p">),</span> <span class="n">so</span> <span class="n">I</span> <span class="n">added</span> <span class="n">a</span> <span class="sb"><code>.reverse</code></span> <span class="n">to</span> <span class="n">flip</span> <span class="n">it</span> <span class="n">around</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span> <span class="n">the</span> <span class="n">second</span> <span class="n">change</span> <span class="n">is</span> <span class="n">this</span> <span class="n">line</span><span class="p">:</span> <span class="sb"><code>puts &amp;quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;counter&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ranks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;)&amp;quot;</code></span><span class="o">.</span> <span class="no">The</span> <span class="n">first</span> <span class="n">thing</span> <span class="n">I</span><span class="s1">&#39;ve changed is putting in <code>\t</code> which inserts a tab instead of a space so the output is more readable. The interesting part is <code>#{ranks.index(state) + 1}</code> which reads as &quot;look in the list <code>ranks</code> and find the <code>index</code> (or &quot;position&quot;) of whatever is in the variable named <code>state</code> then add <code>1</code> to that address.&quot;  The list is indexed starting with zero; we add one so that the state rankings start at &quot;1&quot; like you&#39;</span><span class="n">d</span> <span class="n">normally</span> <span class="n">rank</span> <span class="n">things</span><span class="o">.</span> <span class="no">RUN</span> <span class="n">this</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
AK: 2   (53)
AL: 26  (35)
AR: 3   (51)
&#8220;`</p>

<h1>And with that, you&#8217;re done!</h1>

  
    <footer>
      
      
        <div class="sharing">
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Jumpstart Lab -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


  

  

  

</body>
</html>
