
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>JSAttend - Jumpstart Lab Curriculum</title>
  <meta name="author" content="Jumpstart Lab">

  
  <meta name="description" content="            JSAttend          In this project you&#8217;ll work with the attendee data for a conference supplied in a CSV file.  This data comes fr...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yoursite.com/level_1/jsattend.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection, print" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="http://s3.amazonaws.com/ender-js/jeesh.min.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Jumpstart Lab Curriculum" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body  >
  <header role="banner"><hgroup>
  <h1><a href="/">Jumpstart Lab Curriculum</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yoursite.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Curriculum Index</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    
    <h1 class="entry-title">JSAttend</h1>
    
  </header>
  
  <p>In this project you&#8217;ll work with the attendee data for a conference supplied in a CSV file.  This data comes from an actual conference, though identifying information has been masked.  </p>

<p>The techniques practiced in this lab include:
* Basic file input and output
* Working with CSV (Comma Separated Value) files using the FasterCSV library
* String manipulation techniques
* Basic looping and branching instructions
* Accessing a web-based API</p>

<p>You&#8217;ll need a few data files that I&#8217;ll distribute in the chat.</p>

<h2>Bootstrap</h2>

<p>If you haven&#8217;t already setup Ruby, visit &quot;<a href="http://jumpstartlab.com/resources/general/environment/":http://jumpstartlab.com/resources/general/environment/">http://jumpstartlab.com/resources/general/environment/&quot;:http://jumpstartlab.com/resources/general/environment/</a> for instructions.</p>

<p>Go to your command line and enter:</p>

<ul>
<li>[OS X]: <code>gem install sunlight</code></li>
<li>[Win]: <code>gem install sunlight</code></li>
</ul>

<p>Next open RubyMine and&#8230;
* Click &quot;Create a New Project&quot;
** Project name: JSAttend
** Project type: Empty Project
** Click OK
* Right click on the project folder (in the left pane) and select NEW -&gt; RUBY CLASS
** Enter the class name: JSAttend</p>

<p>Start with this code framework:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;rubygems&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;fastercsv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:file</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:headers</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;JSAttend Initialized.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<p>In RubyMine, click the RUN menu at the top, then EDIT CONFIGURATIONS
* Click the [+] icon
** Click RUBY
** Set the NAME to JSAttend
* Click the [&#8230;] next to RUBY SCRIPT and select your <code>js_attend.rb</code> file
* Click the [&#8230;] next to WORKING DIRECTORY and select the folder where your <code>js_attend.rb</code> file is stored
* UN-check the checkbox for &quot;Display settings before launching&quot; (this checkbox is gone in RubyMine 2.0 Beta)
* Leave everything else alone and click OK
* Click the RUN menu then RUN or Command-F8 to execute the program</p>

<p>Go to the RUN menu and setup the config under RUN CONFIGURATION.  Once that&#8217;s setup, RUN the program.  Your output should look something like&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Process</span> <span class="n">finished</span> <span class="n">with</span> <span class="nb">exit</span> <span class="n">code</span> <span class="mi">0</span>
</span></code></pre></td></tr></table></div></figure>

<h2>Iteration 0: Basics of a CSV File</h2>

<p>CSV files are great for storing and transporting large data sets.  They&#8217;re most commonly created from Excel spreadsheets, but since a CSV is really just a plain text file, they&#8217;re pretty easy to interact with from ANY program.  First thing to do is to get an object created for the file.  Add this method to your class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">open_file</span>
</span><span class='line'>  <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;event_attendees.csv&quot;</span>
</span><span class='line'>  <span class="nb">puts</span> <span class="s2">&quot;Trying to open the file with FasterCSV&quot;</span>
</span><span class='line'>  <span class="vi">@file</span> <span class="o">=</span> <span class="no">FasterCSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">{</span><span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:return_headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:header_converters</span> <span class="o">=&gt;</span> <span class="ss">:symbol</span><span class="p">})</span>
</span><span class='line'>  <span class="vi">@headers</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then go into your <code>initialize</code> method and add <code>open_file</code> as the first line.  The whole file should now look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s2">&quot;rubygems&quot;</span>
</span><span class='line'><span class="nb">require</span> <span class="s2">&quot;fastercsv&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JSAttend</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:file</span>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:headers</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class='line'>    <span class="n">open_file</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;JSAttend Initialized.&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">open_file</span>
</span><span class='line'>    <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;event_attendees.csv&quot;</span>
</span><span class='line'>    <span class="nb">puts</span> <span class="s2">&quot;Trying to open the file with FasterCSV&quot;</span>
</span><span class='line'>    <span class="vi">@file</span> <span class="o">=</span> <span class="no">FasterCSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="p">{</span><span class="ss">:headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:return_headers</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:header_converters</span> <span class="o">=&gt;</span> <span class="ss">:symbol</span><span class="p">})</span>
</span><span class='line'>    <span class="vi">@headers</span> <span class="o">=</span> <span class="vi">@file</span><span class="o">.</span><span class="n">readline</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">jsa</span> <span class="o">=</span> <span class="no">JSAttend</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run the program and you should get an error that starts like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Trying</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">file</span> <span class="n">with</span> <span class="no">FasterCSV</span><span class="sr"></span>
</span><span class='line'><span class="sr">/Library/</span><span class="no">Ruby</span><span class="o">/</span><span class="no">Gems</span><span class="o">/</span><span class="mi">1</span><span class="o">.</span><span class="mi">8</span><span class="o">/</span><span class="n">gems</span><span class="o">/</span><span class="n">fastercsv</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="mi">5</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">faster_csv</span><span class="o">.</span><span class="n">rb</span><span class="p">:</span><span class="mi">1193</span><span class="ss">:in</span> <span class="sb">`initialize&#39;: No such file or directory - event_attendees.csv (Errno::ENOENT)</span>
</span></code></pre></td></tr></table></div></figure>

<p>This is what we call a <em>stack trace</em>.  When your program generates an error, the stack trace is the best way to figure out what went wrong.  Sometimes they&#8217;re hard to read, but this one is pretty easy.  When it says <code>No such file or directory - event_attendees.csv</code> you can tell that it can&#8217;t find the <code>event_attendees.csv</code> file that it&#8217;s trying to open.  You could write the entire filename path (like <code>C:\JumpstartLab\RubyJumpstart\Projects\JSAttend\event_attendees.csv</code>), but that&#8217;s junky for a few reasons.  It&#8217;s better to <em>copy</em> the file you want, <code>event_attendees.csv</code> into the same directory where you <code>js_attend.rb</code> file is.  Do that now, then re-run your program.  You should see something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Trying</span> <span class="n">to</span> <span class="nb">open</span> <span class="n">the</span> <span class="n">file</span> <span class="n">with</span> <span class="no">FasterCSV</span>
</span><span class='line'><span class="no">JSAttend</span> <span class="no">Initialized</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>

<p>Now that our file is getting loaded properly we have a name for that variable - <code>@file</code>.  We can now talk to that object named @file and ask it all kinds of information or tell it to do things.  Let&#8217;s create a method that will just go through the file and print out the first names of all the people:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_names</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">line</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Then to actually execute that instruction, you need to call it.  At the bottom of your project file add the line <code>jsa.print_names</code> underneath <code>jsa = JSAttend.new</code>.  Now RUN your program and you should see the first names from the CSV file fly by.</p>

<p>Once that&#8217;s working we can beef it up a little by printing out their first name AND last name.  Modify the <code>puts</code> line of your <code>print_names</code> method so it reads like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">puts</span> <span class="n">line</span><span class="o">[</span><span class="ss">:first_name</span><span class="o">]</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">[</span><span class="ss">:last_name</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>

<p>What you&#8217;re doing here is adding together three strings: the first name, a space, and the last name.  Once those are added together they go to the <code>puts</code> instruction to print out.  Run your program again and you should see the attendee first and last names scroll by.  Now, rewrite that <code>puts</code> line using string interpolation (HINT: remember using the <code>#{}</code>?).</p>

<h2>Iteration 1: Cleaning Up the Phone Numbers</h2>

<p>Open the CSV file as you normally would in a spreadsheet program like Excel or OpenOffice.  Look at the phone number column &#8211; see how they&#8217;re &quot;dirty&quot;?  Some have parentheses, some have hyphens, some periods.  It&#8217;s a mess; let&#8217;s clean it up.</p>

<h4>Step 0 - Print What&#8217;s There</h4>

<p>Create a method named <code>print_numbers</code> that does exactly the same thing as your existing <code>print_names</code> method, but get the phone number from <code>line[:homephone]</code> and print that out instead.  At the bottom of your program change the <code>jsa.print_names</code> line to <code>jsa.print_numbers</code>.  RUN your program and you should see the existing phone numbers scroll by.</p>

<h4>Step 1 - Removing Periods</h4>

<p>When you&#8217;re cleaning up data, the process goes something like this:
* Copy the original data
* Remove the junk
* Output the newly cleaned data</p>

<p>Simple, right?  Let&#8217;s first remove the periods that some people put in their phone numbers.  Change the meat of your <code>print_numbers</code> method to match this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>  <span class="n">original</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span>
</span><span class='line'>  <span class="n">clean</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">puts</span> <span class="n">clean</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>RUN your program and you should see the numbers scroll by again.  There&#8217;s still plenty of junk in there (parentheses, hyphens, etc), but there are no periods!</p>

<h4>Step 2 - Removing Parentheses, Hyphens, and Spaces</h4>

<p>Now we need to remove the other junk characters.  Try working with the <code>delete</code> and <code>delete!</code> method to clean up all right parentheses, left parentheses, hyphens, and blank spaces. RUN your program and you should see pretty good data coming out like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">6143300000</span>
</span><span class='line'><span class="mi">6176861000</span>
</span><span class='line'><span class="mi">503278000</span>
</span><span class='line'><span class="mi">7047989000</span>
</span><span class='line'><span class="mi">7579713000</span>
</span><span class='line'><span class="mi">9522007000</span>
</span><span class='line'><span class="mi">8146673000</span>
</span><span class='line'><span class="mi">19194755000</span>
</span><span class='line'><span class="mi">8045434000</span>
</span><span class='line'><span class="mi">8282844000</span>
</span><span class='line'><span class="n">bl000</span>
</span><span class='line'><span class="mi">6512603000</span>
</span></code></pre></td></tr></table></div></figure>

<p>Not perfect, but getting better.</p>

<h4>Step 3 - Checking Length</h4>

<p>We&#8217;ve removed extraneous characters, but there are still some problems.  Some of the numbers are &quot;long&quot; because they have a leading 1 on the front.  A few of them are too short.  A few others are just garbage &#8211; like a misplaced email address or just some letter/number junk.  Let&#8217;s fix these problems by looking at the number&#8217;s length.</p>

<p>The ideal length for our numbers is a three-digit area code plus a seven digit number giving us 10 total digits.  We could write what&#8217;s called &quot;pseudocode&quot; like this:
* If the number is NOT 10 digits long
** Is the number 11 digits instead?
*** If so, look at the first number.  If it&#8217;s a 1, just cut it off the front.  If it&#8217;s not a 1, well, this number is junk.
** Is the number something other than 10 or 11 digits?
*** If so, it&#8217;s junk.</p>

<p>Now we can translate that into real code using the <code>if</code>, <code>elsif</code>, <code>else</code>, and <code>!</code>(not) instructions like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">length</span> <span class="o">!=</span> <span class="mi">10</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">number</span><span class="o">.</span><span class="n">length</span> <span class="o">==</span> <span class="mi">11</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">number</span><span class="o">[</span><span class="mi">0</span><span class="o">.</span><span class="n">.</span><span class="mi">0</span><span class="o">]</span> <span class="o">==</span> <span class="s2">&quot;1&quot;</span>
</span><span class='line'>        <span class="n">number</span> <span class="o">=</span> <span class="n">number</span><span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">10</span><span class="o">]</span>
</span><span class='line'>      <span class="k">else</span>
</span><span class='line'>        <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;junk&quot;</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">number</span> <span class="o">=</span> <span class="s2">&quot;junk&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Insert that into your <code>print_numbers</code> method.  Keep in mind that I used the variable name <code>number</code> at the end of my delete lines (removing the hyphens, parentheses, etc).  If you used a different name at the end you could substitute that in or just write a line like <code>number = your_variable_name</code>.  RUN the resulting code and you should see nicely formatted numbers like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">3363171000</span>
</span><span class='line'><span class="mi">3363171000</span>
</span><span class='line'><span class="mi">2024818000</span>
</span><span class='line'><span class="mi">5034758000</span>
</span><span class='line'><span class="mi">8054481000</span>
</span><span class='line'><span class="mi">8145711000</span>
</span></code></pre></td></tr></table></div></figure>

<h4>Step 4 - Refactoring</h4>

<p><em>Refactoring</em> is the an important part of programming &#8211; it means taking working code and reorganizing it to make more sense, be more maintainable, and be more flexible for future situations.</p>

<p>We&#8217;ve created a good <code>print_numbers</code> method that prints out good-looking phone numbers, but we&#8217;re lying a little bit.  It&#8217;s not just <em>printing</em> numbers; it&#8217;s <em>cleaning</em> them then <em>printing</em> them.  If we&#8217;re doing two things they should be split up into two methods.</p>

<p>Create a method named <code>clean_number</code> that looks like this&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_number</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="c1"># Insert your &quot;cleaning&quot; code here</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">number</span>  <span class="c1"># Send the variable &#39;number&#39; back to the method that called this method</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Note that I&#8217;ve started using comments that start with a <code>#</code> symbol.  When you put a <code>#</code> the Ruby interpreter ignores everything after it on that line.  So if we put a <code>#</code> then we can follow it with notes explaining what&#8217;s going on with that code.  Comments are just for your information/understanding &#8211; you don&#8217;t need to copy mine unless you want to.</p>

<p>See where we have the <code>original</code> variable next to the name of the method?  That&#8217;s called a <em>parameter</em>.  A parameter is some input that you need to put into an instruction so it can do what it&#8217;s supposed to do.  For instance, if I told you to call my mother I&#8217;d have to give you the parameter of her phone number.  Without the parameter, the instruction doesn&#8217;t makes sense.  The same is true here.  In order to &quot;clean&quot; a number, we need to give it the number to clean.  Cut and paste your cleaning code from the old <code>print_numbers</code> method and put it into <code>clean_number</code>.  After removing that code from <code>print_number</code> make it look like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_numbers</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">number</span> <span class="o">=</span> <span class="n">clean_number</span><span class="p">(</span><span class="n">line</span><span class="o">[</span><span class="ss">:homephone</span><span class="o">]</span><span class="p">)</span> <span class="c1"># Call the method &#39;clean_number&#39;, send it the value in line[:homephone], and save the result into the variable &#39;number&#39;</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">number</span> <span class="c1"># Print out the &#39;number&#39; after it was cleaned</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Test your refactored code and make sure it still works properly.  The most common mistakes when refactoring have to do with variable names.  If you&#8217;re generating errors, check and make sure that the variables in your <code>clean_number</code> make a correct sequence.  You&#8217;re starting with the incoming number named <code>original</code> and should end with the cleaned number named <code>number</code>.</p>

<h2>Iteration 2: Cleaning up the Zip Codes</h2>

<p>When we got this data the zipcode data was a little surprising.  </p>

<h4>Step 0: Print out What&#8217;s There &amp; Diagnosis</h4>

<p>Why were so many of the zipcodes entered incorrectly?  Look at a few example addresses and zipcode&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="mi">1</span> <span class="no">Old</span> <span class="no">Ferry</span> <span class="no">Road</span><span class="p">,</span> <span class="no">Box</span> <span class="c1"># 6348 Bristol RI  2809</span>
</span><span class='line'><span class="mi">90</span> <span class="no">University</span> <span class="no">Heights</span> <span class="p">,</span> <span class="mi">401</span><span class="n">h1</span>   <span class="no">Burlington</span>  <span class="no">VT</span>  <span class="mi">5405</span>
</span><span class='line'><span class="mi">123</span> <span class="no">Garfield</span> <span class="no">Ave</span>  <span class="no">Blackwood</span>   <span class="no">NJ</span>  <span class="mi">8012</span>
</span><span class='line'><span class="mi">239</span> <span class="n">S</span> <span class="no">Prospect</span> <span class="no">St</span>  <span class="no">Burlington</span>  <span class="no">VT</span>  <span class="mi">5401</span>
</span><span class='line'><span class="mi">50</span> <span class="no">Ledgewood</span> <span class="no">Dr</span>   <span class="no">York</span>    <span class="no">ME</span>  <span class="mi">3909</span>
</span></code></pre></td></tr></table></div></figure>

<p>See the pattern?  All the short zipcodes are in New England.  Now that we know the problem, we can fix it.</p>

<p>Let&#8217;s write a method to print out the current zipcodes from the CSV.  We&#8217;ll call it <code>print_zipcodes</code> and model it after our <code>print_numbers</code> method:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">print_zipcodes</span>
</span><span class='line'>    <span class="vi">@file</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
</span><span class='line'>      <span class="n">zipcode</span> <span class="o">=</span> <span class="n">line</span><span class="o">[</span><span class="ss">:zipcode</span><span class="o">]</span>
</span><span class='line'>      <span class="nb">puts</span> <span class="n">zipcode</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>Run that and you should see the list of uncleaned zipcodes scroll by.</p>

<h4>Step 1: Zero-Padding Existing Zipcodes</h4>

<p>Let&#8217;s write a little pseudo-code:
* If the zipcode is less than 5 digits, I want to add zeros on to the front until it becomes five digits
* If the zipcode is more than 5 digits I don&#8217;t know what to do with it, so it&#8217;s junk.  Let&#8217;s put &quot;00000&quot; for junk here.
* If the zipcode is exactly 5 digits, I assume it&#8217;s ok</p>

<p>Turning that into code we should create a <code>clean_zipcode</code> method.  Model it after the structure of your <code>clean_number</code> method.  Name the parameter <code>original</code> like we did in <code>clean_number</code>.  Assuming you have that structure we can start to map out the method&#8217;s code&#8230;</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="k">def</span> <span class="nf">clean_zipcode</span><span class="p">(</span><span class="n">original</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">original</span><span class="o">.</span><span class="n">length</span> <span class="o">&lt;</span> <span class="mi">5</span>
</span><span class='line'>      <span class="c1"># Add zeros on the front</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">original</span> <span class="c1"># This is just TEMPORARY!</span>
</span><span class='line'>    <span class="k">elsif</span> <span class="n">original</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">5</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;00000&quot;</span>  <span class="c1"># If it is greater than 5 digits, it&#39;s junk</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">result</span> <span class="o">=</span> <span class="n">original</span> <span class="c1"># If it wasn&#39;t less than 5, and wasn&#39;t more than 5, it was 5</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

<p>So I&#8217;ve filled in the easy parts (for zips with length greater than or equal to 5).  Now that the method exists you can go into your <code>print_zipcodes</code> method and change the <code>zipcode = line[:zipcode]</code> to <code>zipcode = clean_zipcode(line[:zipcode])</code>.  Also change your instruction at the very bottom from <code>jsa.print_numbers</code> to <code>jsa.print_zipcodes</code>.  You can then RUN this code and see if it fixes the missing and too-long zipcodes.</p>

<p>Uh-oh.  Did you get an error?  I did.  The program got through a bunch of the zipcodes then spat this out:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="sb">`clean_zipcode&#39;: undefined method `</span><span class="n">length</span><span class="err">&#39;</span> <span class="k">for</span> <span class="kp">nil</span><span class="ss">:NilClass</span> <span class="p">(</span><span class="no">NoMethodError</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>

<p>What the heck is <code>nil:NilClass</code>?  Refer to the Ruby Tutorial if you&#8217;ve forgotten about <code>nil</code>.</p>

<p>In this case, FasterCSV is giving us a <code>nil</code> if the CSV file doesn&#8217;t have any information in the zipcode.  I was really expecting the empty string, &quot;&quot;, but I can see <code>nil</code> making sense.  Dealing with <code>nil</code> values in your code can be a huge pain in the neck.  The situation we have now is very typical: you write code that works great for most of the cases, then it hits one <code>nil</code> and blows up.  Most frequently these problems are generated by trying to call methods or access attributes of <code>nil</code>.  If I asked you &quot;What is the length of nothingness?&quot; you&#8217;d probably give me a confused look.  That&#8217;s what Ruby is saying in our error message here.  &quot;I don&#8217;t know how to find the <code>length</code> for <code>nil</code>&quot;.  The solution, then, is to check and see if our zipcode is <code>nil</code> before doing other things to it.</p>

<p>Check out how I&#8217;ve reworked the <code>if/elsif/else</code> instructions to check for a <code>nil</code> first:</p>

<p><pre class="brush:ruby">
  def clean_zipcode(original)
    if original.nil?
      result = &quot;00000&quot;  # If it is nil, it's junk<br>
    elsif length &lt; 5
      # Add zeros on the front
      result = original # This is just TEMPORARY!
    elsif original.length &gt; 5
      result = &quot;00000&quot;  # If it is greater than 5 digits, it's junk
    else
      result = original # If it wasn't less than 5, and wasn't more than 5, it was 5
    end</p>

<pre><code>return result
</code></pre>

<p>end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Now</span> <span class="n">the</span> <span class="n">trickier</span> <span class="n">part</span><span class="p">:</span> <span class="n">adding</span> <span class="n">on</span> <span class="n">the</span> <span class="n">zeros</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">The</span> <span class="n">zipcodes</span> <span class="n">that</span> <span class="n">are</span> <span class="n">missing</span> <span class="n">their</span> <span class="n">leading</span> <span class="n">zeros</span> <span class="n">are</span> <span class="n">mostly</span> <span class="n">four</span> <span class="n">digits</span> <span class="n">long</span><span class="p">,</span> <span class="n">so</span> <span class="n">just</span> <span class="n">adding</span> <span class="n">one</span> <span class="n">zero</span> <span class="n">to</span> <span class="n">the</span> <span class="n">front</span> <span class="n">would</span> <span class="n">probably</span> <span class="n">fix</span> <span class="n">it</span><span class="o">.</span>  <span class="no">But</span> <span class="mo">00601</span><span class="p">,</span> <span class="k">for</span> <span class="n">instance</span><span class="p">,</span> <span class="n">is</span> <span class="n">a</span> <span class="n">valid</span> <span class="n">zipcode</span><span class="o">.</span>  <span class="no">In</span> <span class="n">our</span> <span class="n">data</span> <span class="n">there</span> <span class="n">are</span> <span class="n">a</span> <span class="n">few</span> <span class="n">of</span> <span class="n">these</span> <span class="n">two</span><span class="o">-</span><span class="n">leading</span><span class="o">-</span><span class="n">zero</span> <span class="n">zipcodes</span><span class="o">.</span>  <span class="no">The</span> <span class="n">easiest</span> <span class="n">solution</span> <span class="n">here</span> <span class="n">is</span> <span class="n">to</span> <span class="n">use</span> <span class="n">a</span> <span class="sb"><code>while</code></span> <span class="kp">loop</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="n">A</span> <span class="sb"><code>while</code></span> <span class="kp">loop</span> <span class="n">repeats</span> <span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">instructions</span> <span class="n">as</span> <span class="n">long</span> <span class="n">as</span> <span class="n">a</span> <span class="n">condition</span> <span class="n">is</span> <span class="sb"><code>true</code></span><span class="o">.</span>  <span class="no">When</span> <span class="n">the</span> <span class="n">condition</span> <span class="n">becomes</span> <span class="sb"><code>false</code></span><span class="p">,</span> <span class="n">the</span> <span class="sb"><code>while</code></span> <span class="kp">loop</span> <span class="n">ends</span><span class="o">.</span>  <span class="no">Here</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">an</span> <span class="n">example</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
counter = 0
while counter &lt; 5
  puts counter
  counter = counter + 1
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">If</span> <span class="n">you</span> <span class="n">were</span> <span class="n">to</span> <span class="n">execute</span> <span class="n">this</span> <span class="n">code</span><span class="p">,</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">d</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
0
1
2
3
4</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Simple</span> <span class="n">enough?</span>  <span class="no">We</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">use</span> <span class="n">that</span> <span class="n">same</span> <span class="n">idea</span> <span class="n">to</span> <span class="n">implement</span> <span class="n">our</span> <span class="n">zero</span><span class="o">-</span><span class="n">padding</span><span class="o">.</span>  <span class="no">Go</span> <span class="n">to</span> <span class="n">your</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">take</span> <span class="n">out</span> <span class="n">the</span> <span class="n">line</span> <span class="n">that</span> <span class="n">says</span> <span class="sb"><code>result = original # This is just TEMPORARY!</code></span> <span class="ow">and</span> <span class="n">replace</span> <span class="n">it</span> <span class="n">with</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
      result = original
      while result.length &lt; 5
        result = &quot;0&quot; + result
      end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">If</span> <span class="n">you</span> <span class="n">were</span> <span class="n">to</span> <span class="n">read</span> <span class="n">that</span> <span class="n">outloud</span><span class="p">,</span> <span class="n">it</span> <span class="n">would</span> <span class="n">sound</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span> <span class="s2">&quot;While the length of <code>result</code> is less than five, keep putting a <code>&amp;quot;&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;</code> on the front of it and saving it back into <code>result</code>.&quot;</span>  <span class="no">Now</span> <span class="no">RUN</span> <span class="n">the</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">all</span> <span class="n">the</span> <span class="n">zipcodes</span> <span class="n">look</span> <span class="n">clean</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 2: Test &amp; Refactor</span>
</span><span class='line'>
</span><span class='line'><span class="no">This</span> <span class="n">time</span> <span class="n">our</span> <span class="n">code</span> <span class="n">is</span> <span class="n">pretty</span> <span class="n">clean</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">results</span> <span class="n">look</span> <span class="n">good</span><span class="o">.</span>  <span class="no">There</span><span class="s1">&#39;s only one thing that stands out for refactoring &#8211; duplication.  The Ruby community has a saying &quot;Keep it DRY&quot; where DRY = Don&#39;</span><span class="n">t</span> <span class="no">Repeat</span> <span class="no">Yourself</span><span class="o">.</span>  <span class="no">Whenever</span> <span class="n">you</span> <span class="k">do</span> <span class="n">the</span> <span class="n">same</span> <span class="n">thing</span> <span class="n">twice</span> <span class="n">you</span> <span class="n">introduce</span> <span class="n">the</span> <span class="n">possibility</span> <span class="k">for</span> <span class="n">mistakes</span> <span class="n">down</span> <span class="n">the</span> <span class="n">road</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Let</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">imagine</span> <span class="n">that</span><span class="p">,</span> <span class="n">tomorrow</span><span class="p">,</span> <span class="n">we</span> <span class="n">want</span> <span class="n">junk</span> <span class="n">zipcodes</span> <span class="n">to</span> <span class="n">be</span> <span class="n">marked</span> <span class="s2">&quot;99999&quot;</span> <span class="n">instead</span> <span class="n">of</span> <span class="s2">&quot;00000&quot;</span><span class="o">.</span>  <span class="no">How</span> <span class="n">many</span> <span class="n">places</span> <span class="n">would</span> <span class="n">we</span> <span class="n">have</span> <span class="n">to</span> <span class="n">change</span> <span class="n">the</span> <span class="n">code?</span>  <span class="no">Two</span> <span class="n">is</span> <span class="n">one</span> <span class="n">too</span> <span class="n">many</span> <span class="k">for</span> <span class="n">something</span> <span class="n">this</span> <span class="n">simple</span><span class="o">.</span>  <span class="no">We</span> <span class="n">can</span> <span class="n">compress</span> <span class="n">our</span> <span class="n">code</span> <span class="n">down</span> <span class="n">a</span> <span class="n">little</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">avoid</span> <span class="n">this</span> <span class="n">repetition</span> <span class="n">by</span> <span class="n">using</span> <span class="n">an</span> <span class="sb"><code>||</code></span><span class="p">(</span><span class="no">OR</span><span class="p">)</span> <span class="n">instructions</span> <span class="k">in</span> <span class="n">our</span> <span class="n">conditions</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def clean_zipcode(original)<br>
    if original.nil? || original.length &gt; 5
      result = &quot;00000&quot;  # If it is nil OR longer than 5 digits, it&#8217;s junk
    elsif original.length &lt; 5
      # Add zeros on the front (omitted)
    else
      result = original # If it wasn&#8217;t less than 5, and wasn&#8217;t more than 5, it was 5
    end</p>

<pre><code>return result
</code></pre>

<p>end
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">So</span> <span class="n">you</span> <span class="n">got</span> <span class="n">rid</span> <span class="n">of</span> <span class="n">one</span> <span class="sb"><code>elsif</code></span> <span class="n">statement</span> <span class="ow">and</span> <span class="n">removed</span> <span class="n">duplication</span> <span class="k">in</span> <span class="n">the</span> <span class="n">code</span><span class="o">.</span>  <span class="no">RUN</span> <span class="n">it</span> <span class="ow">and</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">there</span> <span class="n">are</span> <span class="n">no</span> <span class="n">errors</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">data</span> <span class="n">looks</span> <span class="n">good</span><span class="p">,</span> <span class="k">then</span> <span class="n">we</span><span class="s1">&#39;re ready for the next iteration!</span>
</span><span class='line'>
</span><span class='line'><span class="s1">## Iteration 3: Outputting Cleaned Data</span>
</span><span class='line'>
</span><span class='line'><span class="s1">We&#39;</span><span class="n">ve</span> <span class="n">done</span> <span class="n">good</span> <span class="n">work</span> <span class="n">cleaning</span> <span class="n">the</span> <span class="n">zipcodes</span> <span class="ow">and</span> <span class="n">phone</span> <span class="n">numbers</span><span class="p">,</span> <span class="n">but</span> <span class="n">we</span> <span class="n">haven</span><span class="s1">&#39;t done anything substantial with the information.  We should now output the data to a second CSV file so we can do more interesting things with it.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">#### Step 0: Print Out What&#39;</span><span class="n">s</span> <span class="no">There</span>
</span><span class='line'>
</span><span class='line'><span class="no">Let</span><span class="s1">&#39;s create a method that&#39;</span><span class="n">ll</span> <span class="n">handle</span> <span class="n">writing</span> <span class="n">out</span> <span class="n">the</span> <span class="n">file</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def output<em>data
    output = FasterCSV.open(&quot;event</em>attendees_clean.csv&quot;, &quot;w&quot;)
    output &lt;&lt; @headers  # Print out the headers
    @file.each do |line|
      output &lt;&lt; line
    end
  end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Then</span> <span class="n">change</span> <span class="n">the</span> <span class="n">line</span> <span class="n">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="n">of</span> <span class="n">your</span> <span class="n">program</span> <span class="n">from</span> <span class="sb"><code>jsa.print_zipcodes</code></span> <span class="n">to</span> <span class="sb"><code>jsa.output_data</code></span><span class="o">.</span>  <span class="no">RUN</span> <span class="n">the</span> <span class="n">program</span><span class="p">,</span> <span class="n">check</span> <span class="n">that</span> <span class="n">no</span> <span class="n">errors</span> <span class="n">were</span> <span class="n">generated</span><span class="p">,</span> <span class="k">then</span> <span class="n">look</span> <span class="k">in</span> <span class="n">your</span> <span class="n">project</span> <span class="n">folder</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">a</span> <span class="n">file</span> <span class="s2">&quot;event<em>attendees</em>clean.csv&quot;</span><span class="o">.</span>  <span class="no">Open</span> <span class="n">that</span> <span class="n">file</span> <span class="n">up</span> <span class="p">(</span><span class="n">with</span> <span class="no">Excel</span><span class="p">,</span> <span class="no">Numbers</span><span class="p">,</span> <span class="no">OpenOffice</span><span class="p">,</span> <span class="ow">or</span> <span class="n">a</span> <span class="n">text</span> <span class="n">editor</span><span class="p">)</span> <span class="ow">and</span> <span class="n">see</span> <span class="n">that</span> <span class="n">it</span> <span class="n">looks</span> <span class="n">just</span> <span class="n">like</span> <span class="n">the</span> <span class="n">original</span><span class="o">.</span>  <span class="no">Nothing</span> <span class="n">has</span> <span class="n">been</span> <span class="n">changed</span> <span class="n">yet</span> <span class="n">because</span> <span class="n">we</span><span class="s1">&#39;re just sending <code>line</code> right out to <code>output</code>.  Close the CSV file.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">#### Step 1: In-Place Phone Number and Zipcode Cleaning</span>
</span><span class='line'>
</span><span class='line'><span class="s1">When the FasterCSV library reads the CSV file it gives you the data one line at a time.  That line is broken up into chunks and put together in a collection.  Since we told FasterCSV that the file had a header row at the top, it gives each chunk a name corresponding to that column&#39;</span><span class="n">s</span> <span class="n">header</span><span class="o">.</span>  <span class="no">We</span> <span class="n">can</span> <span class="n">access</span> <span class="n">that</span> <span class="n">collection</span><span class="p">,</span> <span class="n">which</span> <span class="n">we</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">been</span> <span class="n">calling</span> <span class="sb"><code>line</code></span><span class="p">,</span> <span class="ow">and</span> <span class="n">replace</span> <span class="n">specific</span> <span class="n">values</span> <span class="n">within</span> <span class="n">it</span><span class="o">.</span>  <span class="no">For</span> <span class="n">example</span><span class="p">,</span> <span class="n">to</span> <span class="n">update</span> <span class="n">the</span> <span class="n">phone</span> <span class="n">number</span> <span class="n">chunk</span> <span class="n">with</span> <span class="n">its</span> <span class="n">cleaned</span> <span class="n">up</span> <span class="n">version</span> <span class="n">we</span> <span class="n">could</span> <span class="k">do</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
line[:homephone] = clean_number(line[:homephone])</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Reading</span> <span class="n">this</span> <span class="n">line</span> <span class="n">would</span> <span class="n">start</span> <span class="n">on</span> <span class="n">the</span> <span class="n">right</span> <span class="n">side</span> <span class="ow">and</span> <span class="n">sound</span> <span class="n">like</span> <span class="s2">&quot;Take the value of <code>line[:homephone]</code>, put it into the <code>clean_number</code> method, then take the return value that the method gives you back and store it into <code>line[:homephone]</code>.&quot;</span>  <span class="no">Looking</span> <span class="n">at</span> <span class="n">your</span> <span class="sb"><code>output_data</code></span> <span class="nb">method</span><span class="p">,</span> <span class="n">add</span> <span class="n">this</span> <span class="n">line</span> <span class="n">right</span> <span class="n">before</span> <span class="sb"><code>output &amp;lt;&amp;lt; line</code></span><span class="o">.</span>  <span class="no">Try</span> <span class="n">running</span> <span class="n">the</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">verify</span> <span class="n">that</span> <span class="n">the</span> <span class="n">phone</span> <span class="n">numbers</span> <span class="n">are</span> <span class="n">cleaned</span> <span class="n">up</span> <span class="k">in</span> <span class="n">the</span> <span class="n">outputted</span> <span class="n">file</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Next</span><span class="p">,</span> <span class="n">add</span> <span class="n">a</span> <span class="n">similar</span> <span class="n">instruction</span> <span class="n">that</span> <span class="n">sends</span> <span class="sb"><code>line[:zipcode]</code></span> <span class="n">into</span> <span class="n">the</span> <span class="sb"><code>clean_zipcode</code></span> <span class="nb">method</span> <span class="ow">and</span> <span class="n">stores</span> <span class="n">it</span> <span class="n">back</span> <span class="n">into</span> <span class="sb"><code>line[:zipcode]</code></span> <span class="n">before</span> <span class="n">sending</span> <span class="n">the</span> <span class="sb"><code>line</code></span> <span class="n">out</span> <span class="n">to</span> <span class="n">the</span> <span class="n">output</span> <span class="n">file</span><span class="o">.</span>  <span class="no">RUN</span> <span class="n">these</span> <span class="kp">new</span> <span class="n">instructions</span> <span class="ow">and</span> <span class="n">check</span> <span class="n">out</span> <span class="n">the</span> <span class="sb"><code>event_attendees_clean.csv</code></span> <span class="n">file</span> <span class="o">&#8211;</span> <span class="n">does</span> <span class="n">all</span> <span class="n">the</span> <span class="n">data</span> <span class="n">look</span> <span class="n">cleaned</span> <span class="n">up?</span>  <span class="no">It</span> <span class="n">should!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 2: Refactoring</span>
</span><span class='line'>
</span><span class='line'><span class="no">Now</span> <span class="n">that</span> <span class="n">we</span><span class="s1">&#39;ve created a second file we have a little problem.  Our program is going to keep accessing the &quot;dirty&quot; data file because that&#39;</span><span class="n">s</span> <span class="n">what</span><span class="s1">&#39;s specified in our <code>open_file</code> method.  But we want to be able to open either the dirty or clean data files, or really any new files too.  What should we do?  We need to parameterize our filename.</span>
</span><span class='line'>
</span><span class='line'><span class="s1"># Look at the <code>open_file</code> method.  See how it has the @filename<code>in the first line?  Cut that line to your clipboard, then add a parameter named @filename</code> next to the <code>open_file</code> method name.</span>
</span><span class='line'><span class="s1"># Where does the <code>open_file</code> method get called from?  It&#39;</span><span class="n">s</span> <span class="n">called</span> <span class="k">in</span> <span class="n">the</span> <span class="sb"><code>initialize</code></span> <span class="nb">method</span><span class="p">,</span> <span class="n">right?</span>  <span class="no">Now</span> <span class="n">that</span> <span class="sb"><code>open_file</code></span> <span class="n">takes</span> <span class="n">a</span> <span class="n">parameter</span> <span class="n">we</span><span class="s1">&#39;ll have to change that instruction inside <code>initialize</code>.  Change it from saying just <code>open_file</code> to <code>open_file(filename)</code></span>
</span><span class='line'><span class="s1"># Ok, we&#39;</span><span class="n">re</span> <span class="n">getting</span> <span class="n">close</span><span class="o">.</span>  <span class="no">But</span> <span class="n">the</span> <span class="sb"><code>initialize</code></span> <span class="nb">method</span> <span class="n">doesn</span><span class="s1">&#39;t know what @filename<code>is supposed to be.  Let&amp;#39;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;add&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;named&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@filename&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> to the <code>&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> method.</span>
</span><span class='line'><span class="sb"># Now, we can go to our instructions at the bottom of the file and change the line <code>&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Attend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> to read <code>&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsa&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Attend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;event_attendees.csv&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code>.</span>
</span><span class='line'><span class="sb"># Go to the working folder and delete the file &quot;event<em>attendees</em>clean.csv&quot;</span>
</span><span class='line'><span class="sb"># Run the program and see if the &quot;event<em>attendees</em>clean.csv&quot; is correctly regenerated</span>
</span><span class='line'><span class="sb"># If you run into errors, check that you&#39;re calling <code>&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> with the desired filename, that <code>&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> has the <code>&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> next to the method name, that <code>&lt;/span&gt;&lt;span class=&quot;kp&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> is calling <code>&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;open_file&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> with the @filename<code>&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;that&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;</code>open<em>file<code>&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;has&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;</code>(filename)<code>&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;its&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;span class='line'&gt;&lt;span class=&quot;c1&quot;&gt;# Lastly, let&amp;#39;s also parameterize the filename inside</code>output</em>data<code>.&lt;/span&gt;
&lt;/span&gt;&lt;span class='line'&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Add&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;a&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;</code>(filename)<code>&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;next&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;</code>output_data<code>&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;name&lt;/span&gt;
&lt;/span&gt;&lt;span class='line'&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Change&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;actual&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filename&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;</code>FasterCSV.open<code>&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;method&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;variable&lt;/span&gt; &lt;span class=&quot;vi&quot;&gt;@filename&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code></span>
</span><span class='line'><span class="sb">** Add the parameter so <code>&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsa&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_data&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> at the bottom of your file becomes <code>&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsa&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;output_data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;event_attendees_clean.csv&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code></span>
</span><span class='line'><span class="sb">** Delete the cleaned CSV file and RUN everything again to make sure it&#39;s working properly.</span>
</span><span class='line'>
</span><span class='line'><span class="sb">## Iteration 4: Congressional Lookup</span>
</span><span class='line'>
</span><span class='line'><span class="sb">This conference was about a political issue, and we wanted the participants to interact with their congresspeople.  Since we already have their zipcodes we can take advantage of an API from the Sunlight Foundation to lookup the appropriate congresspeople.</span>
</span><span class='line'>
</span><span class='line'><span class="sb">#### Step 0: Framework</span>
</span><span class='line'>
</span><span class='line'><span class="sb">We&#39;ll need an additional library to help us connect to and read the data from the API.  Add this line below the existing <code>&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;</code> lines at the beginning of your program file:</span>
</span></code></pre></td></tr></table></div></figure>ruby
require &#8216;sunlight&#8217;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Then</span> <span class="n">go</span> <span class="n">down</span> <span class="ow">and</span> <span class="n">create</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">that</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def rep_lookup
    20.times do
      line = @file.readline</p>

<pre><code>  representative = &quot;unknown&quot;
  # API Lookup Goes Here
  puts &quot;#{line[:last_name]}, #{line[:first_name]}, #{line[:zipcode]}, #{representative}&quot;
end
</code></pre>

<p>end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">a</span> <span class="n">little</span> <span class="n">different</span> <span class="n">than</span> <span class="n">the</span> <span class="n">other</span> <span class="nb">methods</span> <span class="n">we</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">started</span> <span class="n">with</span><span class="o">.</span>  <span class="no">The</span> <span class="n">first</span> <span class="n">part</span> <span class="n">that</span> <span class="n">will</span> <span class="n">stand</span> <span class="n">out</span> <span class="n">is</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
    20.times do
      line = @file.readline</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">When</span> <span class="n">we</span> <span class="n">use</span> <span class="n">the</span> <span class="no">FasterCSV</span> <span class="n">library</span> <span class="n">to</span> <span class="n">read</span> <span class="n">a</span> <span class="no">CSV</span> <span class="n">file</span><span class="p">,</span> <span class="n">it</span> <span class="n">reads</span> <span class="n">one</span> <span class="n">line</span> <span class="n">at</span> <span class="n">a</span> <span class="n">time</span><span class="o">.</span>  <span class="no">Now</span> <span class="n">that</span> <span class="n">I</span><span class="s1">&#39;m accessing a public API, it&#39;</span><span class="n">s</span> <span class="n">unkind</span> <span class="n">to</span> <span class="n">generate</span> <span class="n">the</span> <span class="n">traffic</span> <span class="n">of</span> <span class="n">looking</span> <span class="n">up</span> <span class="n">thousands</span> <span class="ow">and</span> <span class="n">thousands</span> <span class="n">of</span> <span class="n">attendees</span> <span class="n">each</span> <span class="n">time</span> <span class="n">I</span> <span class="n">run</span> <span class="n">my</span> <span class="n">program</span> <span class="o">--</span> <span class="ow">not</span> <span class="n">to</span> <span class="n">mention</span> <span class="n">that</span><span class="s1">&#39;ll take a long time.  FasterCSV doesn&#39;</span><span class="n">t</span> <span class="n">give</span> <span class="n">us</span> <span class="n">a</span> <span class="n">way</span> <span class="n">to</span> <span class="n">just</span> <span class="n">grab</span> <span class="n">a</span> <span class="n">certain</span> <span class="n">number</span> <span class="n">of</span> <span class="n">lines</span> <span class="n">from</span> <span class="n">the</span> <span class="no">CSV</span> <span class="n">file</span><span class="p">,</span> <span class="n">so</span> <span class="n">what</span> <span class="n">I</span><span class="s1">&#39;ve done here is used the <code>times</code> method on the integer <code>20</code>, creating a loop that will run twenty times.  Each time through the loop it&#39;</span><span class="n">ll</span> <span class="n">pull</span> <span class="n">one</span> <span class="n">line</span> <span class="n">from</span> <span class="n">the</span> <span class="no">CSV</span> <span class="n">file</span> <span class="n">using</span> <span class="n">the</span> <span class="sb"><code>readline</code></span> <span class="nb">method</span><span class="p">,</span> <span class="n">storing</span> <span class="n">it</span> <span class="n">into</span> <span class="sb"><code>line</code></span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">RUN</span> <span class="n">this</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
Nguyen, Allison, 20010, unknown
Hankins, SArah, 20009, unknown
Xx, Sarah, 33703, unknown
Cope, Jennifer, 37216, unknown</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Step 1: Experimenting with the Sunlight API</span>
</span><span class='line'>
</span><span class='line'><span class="no">Most</span> <span class="no">APIs</span> <span class="n">work</span> <span class="n">by</span> <span class="n">requesting</span> <span class="n">a</span> <span class="n">very</span> <span class="n">complicated</span> <span class="n">web</span> <span class="n">address</span><span class="o">.</span>  <span class="no">In</span> <span class="n">the</span> <span class="k">case</span> <span class="n">of</span> <span class="n">the</span> <span class="no">Sunlight</span> <span class="no">API</span><span class="p">,</span> <span class="n">the</span> <span class="no">API</span> <span class="n">we</span><span class="s1">&#39;ll be accessing can be found here:</span>
</span><span class='line'>
</span><span class='line'><span class="s1">&lt;a href=&quot;<a href="http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&amp;zip=22182&quot;&gt;http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&amp;zip=22182&lt;/a">http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&amp;amp;zip=22182&amp;quot;&amp;gt;http://services.sunlightlabs.com/api/legislators.allForZip.xml?apikey=e179a6973728c4dd3fb1204283aaccb5&amp;amp;zip=22182&amp;lt;/a</a>&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Take a close look at that address.  We&#39;</span><span class="n">re</span> <span class="n">accessing</span> <span class="n">the</span> <span class="sb"><code>legislators.allForZip</code></span> <span class="nb">method</span> <span class="n">of</span> <span class="n">their</span> <span class="no">API</span><span class="p">,</span> <span class="n">we</span> <span class="nb">send</span> <span class="k">in</span> <span class="n">an</span> <span class="sb"><code>apikey</code></span> <span class="n">which</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="n">that</span> <span class="n">identifies</span> <span class="no">JumpstartLab</span> <span class="n">as</span> <span class="n">the</span> <span class="n">accessor</span> <span class="n">of</span> <span class="n">the</span> <span class="no">API</span><span class="p">,</span> <span class="k">then</span> <span class="n">at</span> <span class="n">the</span> <span class="n">very</span> <span class="k">end</span> <span class="n">we</span> <span class="n">have</span> <span class="n">a</span> <span class="sb"><code>zip</code></span><span class="o">.</span>  <span class="no">Try</span> <span class="n">modifying</span> <span class="n">the</span> <span class="n">address</span> <span class="n">with</span> <span class="n">your</span> <span class="n">own</span> <span class="n">zipcode</span> <span class="ow">and</span> <span class="nb">load</span> <span class="n">the</span> <span class="n">page</span><span class="o">.</span>  <span class="no">Using</span> <span class="mi">22182</span> <span class="n">as</span> <span class="n">a</span> <span class="n">sample</span> <span class="n">I</span> <span class="n">see</span> <span class="n">this</span> <span class="n">mess</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
10RepP0-001-000016674-91VAN00002073R27120<a href="http://www.house.gov/wolf/202-225-0437400435FrankRudolphWolf241">http://www.house.gov/wolf/202-225-0437400435FrankRudolphWolf241</a> Cannon House Office Building202-225-5136<a href="http://www.house.gov/formwolf/contact_email/emailzip.shtmlhttp://www.youtube.com/RepFrankWolfW000672H6VA10050MfakeopenID429http://www.opencongress.org/wiki/Frank_Wolf">http://www.house.gov/formwolf/contact_email/emailzip.shtmlhttp://www.youtube.com/RepFrankWolfW000672H6VA10050MfakeopenID429http://www.opencongress.org/wiki/Frank_Wolf</a> 11Rep1VAN00029891D95078<a href="http://connolly.house.gov/202-225-3071412272GeraldE.Connolly327">http://connolly.house.gov/202-225-3071412272GeraldE.Connolly327</a> Cannon House Office Building202-0225-1492<a href="https://forms.house.gov/connolly/contact-form.shtmlGerryC001078Mhttp://www.opencongress.org/wiki/Gerald_Connolly">https://forms.house.gov/connolly/contact-form.shtmlGerryC001078Mhttp://www.opencongress.org/wiki/Gerald_Connolly</a> Senior SeatSenP0-001-000016754-41VAN00028058D60043<a href="http://webb.senate.gov/202-228-6363412249JamesH.Webb144">http://webb.senate.gov/202-228-6363412249JamesH.Webb144</a> Russell Senate Office Building202-224-4024<a href="http://webb.senate.gov/contact/http://www.youtube.com/SenatorWebbJimW000803S6VA00127MIJr.fakeopenID533http://www.opencongress.org/wiki/James_Webb">http://webb.senate.gov/contact/http://www.youtube.com/SenatorWebbJimW000803S6VA00127MIJr.fakeopenID533http://www.opencongress.org/wiki/James_Webb</a> Junior SeatSen1VAN00002097D535<a href="http://warner.senate.gov202-224-6295412321MarkR.WarnerB40c">http://warner.senate.gov202-224-6295412321MarkR.WarnerB40c</a> Dirksen Senate Office Building202-224-2023<a href="http://warner.senate.gov/public/?p=EmailSenatorWarnerW000805MIImarkwarnerhttp://www.opencongress.org/wiki/Mark_Warner">http://warner.senate.gov/public/?p=EmailSenatorWarnerW000805MIImarkwarnerhttp://www.opencongress.org/wiki/Mark_Warner</a> 8RepP0-001-000016517-51VAN00002083<a href="http://www.house.gov/apps/list/press/va08_moran/RSS.xmlD27118http://www.moran.house.gov202-225-0017400283JamesP.Moran2239">http://www.house.gov/apps/list/press/va08_moran/RSS.xmlD27118http://www.moran.house.gov202-225-0017400283JamesP.Moran2239</a> Rayburn House Office Building202-225-4376<a href="http://moran.house.gov/zipauth.shtmlJimM000933H0VA08040MJr.fakeopenID283http://www.opencongress.org/wiki/James_Moran">http://moran.house.gov/zipauth.shtmlJimM000933H0VA08040MJr.fakeopenID283http://www.opencongress.org/wiki/James_Moran</a></p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">data</span> <span class="n">is</span><span class="p">,</span> <span class="k">in</span> <span class="n">reality</span><span class="p">,</span> <span class="n">very</span> <span class="n">structured</span><span class="o">.</span>  <span class="no">My</span> <span class="n">browser</span> <span class="p">(</span><span class="no">Safari</span><span class="p">)</span> <span class="n">just</span> <span class="n">doesn</span><span class="s1">&#39;t interpret it very well -- Firefox does a much better job of displaying XML.  If you have it, open Firefox and load that address.  If you&#39;</span><span class="n">re</span> <span class="n">familiar</span> <span class="n">with</span> <span class="n">writing</span> <span class="no">HTML</span> <span class="k">then</span> <span class="n">this</span> <span class="no">XML</span> <span class="n">document</span> <span class="n">probably</span> <span class="n">makes</span> <span class="n">some</span> <span class="n">sense</span> <span class="n">to</span> <span class="n">you</span><span class="o">.</span>  <span class="no">You</span> <span class="n">can</span> <span class="n">see</span> <span class="n">there</span> <span class="n">is</span> <span class="n">a</span> <span class="sb"><code>response</code></span> <span class="n">object</span> <span class="n">that</span> <span class="n">has</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="sb"><code>legislators</code></span><span class="o">.</span>  <span class="no">That</span> <span class="n">list</span> <span class="n">contains</span> <span class="n">five</span> <span class="sb"><code>legislator</code></span> <span class="n">objects</span> <span class="n">which</span> <span class="n">each</span> <span class="n">contain</span> <span class="n">a</span> <span class="n">ton</span> <span class="n">of</span> <span class="n">data</span> <span class="n">about</span> <span class="n">each</span> <span class="n">legislator</span><span class="o">.</span>  <span class="no">Cool</span><span class="o">!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 2: Dealing with XML and JSON</span>
</span><span class='line'>
</span><span class='line'><span class="no">All</span> <span class="n">I</span> <span class="n">want</span> <span class="k">for</span> <span class="n">this</span> <span class="no">API</span> <span class="n">lookup</span> <span class="n">is</span> <span class="n">a</span> <span class="n">comma</span> <span class="n">separated</span> <span class="n">list</span> <span class="n">of</span> <span class="n">the</span> <span class="n">first</span> <span class="n">initial</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">last</span> <span class="nb">name</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span> <span class="n">F</span><span class="o">.</span><span class="n">Wolf</span><span class="p">,</span> <span class="n">G</span><span class="o">.</span><span class="n">Connolly</span><span class="p">,</span> <span class="n">J</span><span class="o">.</span><span class="n">Webb</span><span class="o">.</span>  <span class="no">We</span> <span class="n">could</span> <span class="n">use</span> <span class="n">the</span> <span class="no">XML</span> <span class="n">that</span> <span class="n">we</span> <span class="n">retrieved</span> <span class="n">via</span> <span class="n">the</span> <span class="n">url</span><span class="o">.</span>  <span class="no">In</span> <span class="no">Ruby</span><span class="p">,</span> <span class="n">we</span> <span class="n">could</span> <span class="n">make</span> <span class="n">use</span> <span class="n">of</span> <span class="n">the</span> <span class="sb"><code>open-uri</code></span> <span class="ow">and</span> <span class="sb"><code>hpricot</code></span> <span class="n">libraries</span> <span class="n">to</span> <span class="n">fetch</span> <span class="ow">and</span> <span class="n">parse</span> <span class="n">this</span> <span class="no">XML</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">But</span> <span class="n">the</span> <span class="s2">&quot;Sunlight Foundation&quot;</span><span class="ss">:http:/</span><span class="o">/</span><span class="n">sunlightfoundation</span><span class="o">.</span><span class="n">org</span> <span class="n">has</span> <span class="n">made</span> <span class="n">it</span> <span class="n">easy</span> <span class="n">on</span> <span class="n">us</span><span class="o">.</span>  <span class="no">Luigi</span> <span class="no">Montanez</span><span class="p">,</span> <span class="n">a</span> <span class="n">developer</span> <span class="n">at</span> <span class="no">Sunlight</span> <span class="no">Labs</span><span class="p">,</span> <span class="n">created</span> <span class="n">the</span> <span class="sb"><code>sunlight</code></span> <span class="n">gem</span><span class="o">.</span>  <span class="no">We</span> <span class="n">call</span> <span class="n">this</span> <span class="n">a</span> <span class="n">wrapper</span> <span class="n">library</span> <span class="n">because</span> <span class="n">its</span> <span class="n">job</span> <span class="n">is</span> <span class="n">to</span> <span class="n">hide</span> <span class="n">complexity</span> <span class="n">from</span> <span class="n">us</span><span class="o">.</span>  <span class="no">We</span> <span class="n">can</span> <span class="n">interact</span> <span class="n">with</span> <span class="n">it</span> <span class="n">as</span> <span class="n">a</span> <span class="n">simple</span> <span class="no">Ruby</span> <span class="n">object</span><span class="p">,</span> <span class="k">then</span> <span class="n">the</span> <span class="n">library</span> <span class="n">takes</span> <span class="n">care</span> <span class="n">of</span> <span class="n">fetching</span> <span class="ow">and</span> <span class="n">parsing</span> <span class="n">data</span> <span class="n">from</span> <span class="n">the</span> <span class="n">server</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Add</span> <span class="n">these</span> <span class="n">lines</span> <span class="n">to</span> <span class="n">your</span> <span class="sb"><code>rep_lookup</code></span> <span class="nb">method</span> <span class="n">right</span> <span class="n">under</span> <span class="n">the</span> <span class="n">line</span> <span class="n">that</span> <span class="n">says</span> <span class="sb"><code>#API Lookup Goes Here</code></span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
      results = []
      zipcode = clean<em>zipcode(line[:zipcode])
      Sunlight::Base.api</em>key = &quot;e179a6973728c4dd3fb1204283aaccb5&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">First</span><span class="p">,</span> <span class="n">we</span> <span class="n">create</span> <span class="n">an</span> <span class="n">empty</span> <span class="n">list</span> <span class="n">named</span> <span class="sb"><code>results</code></span><span class="o">.</span>  <span class="no">Each</span> <span class="n">zipcode</span> <span class="n">can</span> <span class="n">have</span> <span class="n">multiple</span> <span class="n">congresspeople</span> <span class="ow">and</span> <span class="n">senators</span><span class="p">,</span> <span class="n">so</span> <span class="n">we</span><span class="s1">&#39;ll store all the results in this list.  Second we grab the <code>zipcode</code> from the CSV file.  Then we tell the <code>Sunlight</code> library our <code>api_key</code> that I got from the Sunlight Foundation.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Now what can we actually DO with the <code>Sunlight</code> library?  Check out the readme on the project homepage: &quot;<a href="http://github.com/sunlightlabs/ruby-sunlightapi&quot;:http://github.com/sunlightlabs/ruby-sunlightapi">http://github.com/sunlightlabs/ruby-sunlightapi&amp;quot;:http://github.com/sunlightlabs/ruby-sunlightapi</a></span>
</span><span class='line'>
</span><span class='line'><span class="s1">We&#39;</span><span class="n">re</span> <span class="n">interested</span> <span class="k">in</span> <span class="n">the</span> <span class="sb"><code>Legislator</code></span> <span class="n">object</span><span class="o">.</span>  <span class="no">Looking</span> <span class="n">at</span> <span class="n">the</span> <span class="n">examples</span> <span class="k">in</span> <span class="n">the</span> <span class="no">ReadMe</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">see</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
congresspeople = Sunlight::Legislator.all_for(:address =&gt; &quot;123 Fifth Ave New York, NY 10003&quot;)</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">So</span> <span class="n">that</span><span class="s1">&#39;s how to fetch information for a specific address, but our task is to find them via Zipcode.  Look back at the URL we used to view the XML.  See how it has <code>legislators.allForZip</code>?  The wrapper library should have a similar method.  I don&#39;</span><span class="n">t</span> <span class="n">see</span> <span class="n">it</span> <span class="k">in</span> <span class="n">the</span> <span class="no">ReadMe</span><span class="p">,</span> <span class="n">so</span> <span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">going</span> <span class="n">to</span> <span class="n">look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">source</span> <span class="n">code</span><span class="o">.</span>  <span class="no">Near</span> <span class="n">the</span> <span class="n">top</span> <span class="n">of</span> <span class="n">the</span> <span class="n">project</span> <span class="n">page</span> <span class="n">I</span> <span class="n">click</span> <span class="sb"><code>lib</code></span><span class="p">,</span> <span class="k">then</span> <span class="n">the</span> <span class="sb"><code>sunlight</code></span> <span class="n">folder</span><span class="p">,</span> <span class="k">then</span> <span class="sb"><code>legislator.rb</code></span><span class="o">.</span>  <span class="n">I</span> <span class="n">search</span> <span class="n">the</span> <span class="n">page</span> <span class="k">for</span> <span class="sb"><code>zipcode</code></span> <span class="ow">and</span> <span class="n">find</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">that</span> <span class="n">starts</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
def self.all<em>in</em>zipcode(zipcode)</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Perfect</span><span class="o">!</span>  <span class="no">It</span> <span class="n">takes</span> <span class="k">in</span> <span class="n">a</span> <span class="n">zipcode</span> <span class="ow">and</span> <span class="n">returns</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">legislators</span><span class="o">.</span>  <span class="no">Let</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">try</span> <span class="n">it</span> <span class="k">in</span> <span class="n">our</span> <span class="n">program</span><span class="o">.</span>  <span class="no">Add</span> <span class="n">these</span> <span class="n">lines</span> <span class="n">below</span> <span class="n">the</span> <span class="sb"><code>api_key</code></span> <span class="n">line</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
legislators = Sunlight::Legislator.all<em>in</em>zipcode(zipcode)
puts legislators</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Run</span> <span class="n">your</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">check</span> <span class="n">out</span> <span class="n">the</span> <span class="n">results</span><span class="o">.</span>  <span class="no">Did</span> <span class="n">it</span> <span class="n">work?</span>  <span class="no">Kinda</span><span class="p">?</span>  <span class="no">Maybe</span><span class="p">?</span>  <span class="no">You</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">probably</span> <span class="n">seeing</span> <span class="n">lines</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby</p>

<h1><a href="Sunlight::Legislator:0x102525280">Sunlight::Legislator:0x102525280</a></h1>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">That</span><span class="s1">&#39;s ruby&#39;</span><span class="n">s</span> <span class="n">way</span> <span class="n">of</span> <span class="n">printing</span> <span class="n">out</span> <span class="n">a</span> <span class="no">Legislator</span> <span class="n">object</span><span class="o">.</span>  <span class="no">Not</span> <span class="n">very</span> <span class="n">informative</span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">shows</span> <span class="n">us</span> <span class="n">that</span> <span class="n">legislators</span> <span class="n">are</span> <span class="n">being</span> <span class="n">found</span> <span class="n">which</span> <span class="n">is</span> <span class="n">good!</span>  <span class="no">Next</span> <span class="n">we</span> <span class="n">should</span> <span class="n">access</span> <span class="n">the</span> <span class="nb">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">legislator</span> <span class="n">within</span> <span class="n">that</span> <span class="n">object</span> <span class="o">--</span> <span class="n">but</span> <span class="n">how</span> <span class="k">do</span> <span class="n">I</span> <span class="n">know</span> <span class="n">what</span> <span class="n">it</span><span class="s1">&#39;s called?  Return to the <code>Legislator</code> source code and, near the top of the page, you&#39;</span><span class="n">ll</span> <span class="n">see</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
attr<em>accessor :title, :firstname, :middlename, :lastname, 
  :name</em>suffix, :nickname,:party, :state, :district,
  :gender, :phone, :fax, :website, :webform, :email,
  :congress<em>office, :bioguide</em>id, :votesmart<em>id, :fec</em>id,
  :govtrack<em>id, :crp</em>id, :event<em>id, :congresspedia</em>url,
  :youtube<em>url, :twitter</em>id, :fuzzy<em>score, :in</em>office,
  :senate_class, :birthdate</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">a</span> <span class="n">list</span> <span class="n">of</span> <span class="n">all</span> <span class="n">the</span> <span class="n">attributes</span> <span class="p">(</span><span class="sb"><code>attr_accessor</code></span> <span class="n">means</span> <span class="s2">&quot;attribute accessor&quot;</span><span class="p">)</span> <span class="n">that</span> <span class="n">a</span> <span class="sb"><code>Legislator</code></span> <span class="n">has</span><span class="p">,</span> <span class="n">all</span> <span class="n">the</span> <span class="n">information</span> <span class="n">it</span> <span class="n">knows</span><span class="o">.</span>  <span class="no">If</span> <span class="n">we</span> <span class="n">want</span> <span class="n">their</span> <span class="n">url</span> <span class="n">we</span> <span class="n">ask</span> <span class="k">for</span> <span class="sb"><code>.website</code></span><span class="p">,</span> <span class="ow">or</span> <span class="n">fax</span> <span class="n">number</span> <span class="n">with</span> <span class="sb"><code>.fax</code></span><span class="o">.</span>  <span class="no">Here</span> <span class="n">we</span><span class="s1">&#39;re interested in their first and last name.  We&#39;</span><span class="n">ll</span> <span class="n">need</span> <span class="n">to</span> <span class="kp">loop</span> <span class="n">through</span> <span class="sb"><code>each</code></span> <span class="n">of</span> <span class="n">the</span> <span class="n">legislators</span> <span class="o">&#8211;</span> <span class="o"><em></span><span class="n">replace</span><span class="o"></em></span> <span class="n">the</span> <span class="sb"><code>puts legislators</code></span> <span class="n">line</span> <span class="n">with</span> <span class="n">this</span> <span class="n">code</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
legislators.each do |leg|
  puts leg.firstname
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Run</span> <span class="n">your</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">check</span> <span class="n">out</span> <span class="n">the</span> <span class="n">results</span><span class="o">.</span>  <span class="no">More</span> <span class="n">impressive</span><span class="p">,</span> <span class="n">right?</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 3: Pulling Names and Formatting the Output</span>
</span><span class='line'>
</span><span class='line'><span class="no">You</span> <span class="n">can</span> <span class="n">see</span> <span class="n">that</span> <span class="n">it</span><span class="s1">&#39;s finding one or more representatives and spewing their first names out.  But we&#39;</span><span class="n">re</span> <span class="n">looking</span> <span class="k">for</span> <span class="n">first</span> <span class="n">initial</span> <span class="ow">and</span> <span class="n">last</span> <span class="nb">name</span><span class="o">.</span>  <span class="no">Let</span><span class="s1">&#39;s take out that <code>puts leg.firstname</code> line.  In it&#39;</span><span class="n">s</span> <span class="n">same</span> <span class="n">spot</span> <span class="n">add</span> <span class="n">these</span> <span class="n">three</span> <span class="n">lines</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
lastname = leg.lastname
first<em>initial = leg.firstname[0..0]
results &lt;&lt; &quot;#{first</em>initial}.#{lastname}&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="n">first</span> <span class="n">instruction</span> <span class="n">says</span> <span class="s2">&quot;find the <code>lastname</code> attribute of <code>leg</code> and store it into a variable named <code>lastname</code>.&quot;</span>  <span class="no">Then</span> <span class="n">the</span> <span class="n">second</span> <span class="n">line</span> <span class="n">is</span> <span class="s2">&quot;find the <code>firstname</code> attribute of <code>leg</code>, grab all the letters from position <code>0</code> to position <code>0</code> (giving you only the first letter), and store it into the variable named <code>first_initial</code>.&quot;</span>  <span class="no">Next</span><span class="p">,</span> <span class="s2">&quot;make a string with the data in <code>first_initial</code>, a period, and the data inside <code>lastname</code> then add it into the list named <code>results</code>.&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Lastly</span><span class="p">,</span> <span class="n">change</span> <span class="n">the</span> <span class="n">final</span> <span class="sb"><code>puts</code></span> <span class="n">line</span> <span class="k">in</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">so</span> <span class="n">it</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
puts &quot;#{line[:last<em>name]}, #{line[:first</em>name]}, #{line[:zipcode]}, #{results.join(&quot;, &quot;)}&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="n">significant</span> <span class="n">change</span> <span class="n">being</span> <span class="n">the</span> <span class="n">last</span> <span class="n">part</span> <span class="n">that</span> <span class="n">says</span> <span class="sb"><code>results.join(&amp;quot;, &amp;quot;)</code></span> <span class="n">which</span> <span class="n">means</span> <span class="s2">&quot;take each thing in the list <code>results</code> and <code>join</code> them together with a comma and space between each one.&quot;</span>  <span class="no">Run</span> <span class="n">your</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
Nguyen, Allison, 20010, E.Norton
Hankins, SArah, 20009, E.Norton
Xx, Sarah, 33703, M.Martinez, B.Nelson, C.Young
Cope, Jennifer, 37216, J.Cooper, B.Corker, L.Alexander
Zimmerman, Douglas, 50309, T.Harkin, C.Grassley, L.Boswell</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Pretty</span> <span class="n">cool?</span>  <span class="no">If</span> <span class="n">you</span><span class="s1">&#39;d like, go back to the <code>Legislator</code> attribute list and see what other interesting data you could include.  What would it look like to have the names read like &quot;E.Norton (D)&quot; for their party?  Or how about &quot;Rep E.Norton (D)&quot;?</span>
</span><span class='line'>
</span><span class='line'><span class="s1">## Iteration 5: Form Letters</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Every organization has to generate form letters and somehow it seems to always be a pain in the neck.  Here&#39;</span><span class="n">s</span> <span class="n">one</span> <span class="n">way</span> <span class="n">we</span> <span class="n">could</span> <span class="k">do</span> <span class="n">it</span> <span class="n">with</span> <span class="no">Ruby</span> <span class="ow">and</span> <span class="no">HTML</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 0: Framework &amp; Goals</span>
</span><span class='line'>
</span><span class='line'><span class="no">First</span><span class="p">,</span> <span class="n">I</span> <span class="n">wrote</span> <span class="n">a</span> <span class="n">barebones</span> <span class="n">letter</span> <span class="n">using</span> <span class="no">HTML</span> <span class="ow">and</span> <span class="n">named</span> <span class="n">it</span> <span class="sb"><code>form_letter.html</code></span><span class="o">.</span>  <span class="no">Open</span> <span class="n">up</span> <span class="n">that</span> <span class="n">html</span> <span class="n">file</span> <span class="k">in</span> <span class="n">another</span> <span class="n">window</span> <span class="n">so</span> <span class="n">you</span><span class="s1">&#39;ll see what it should look like.  I also created a directory called <code>form_letters</code> inside my project&#39;</span><span class="n">s</span> <span class="n">directory</span><span class="o">.</span>  <span class="no">Next</span><span class="p">,</span> <span class="n">add</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">to</span> <span class="n">your</span> <span class="sb"><code>JSAttend</code></span> <span class="k">class</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def create<em>form</em>letters
    letter = File.open(&quot;form_letter.html&quot;, &quot;r&quot;).read
    20.times do
      line = @file.readline</p>

<pre><code>  # Do your string substitutions here
end  
</code></pre>

<p>end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">follows</span> <span class="n">our</span> <span class="n">previous</span> <span class="n">model</span> <span class="n">except</span> <span class="k">for</span> <span class="n">the</span> <span class="sb"><code>letter = File...</code></span> <span class="n">instruction</span><span class="o">.</span>  <span class="vi">@file</span><span class="o">.</span><span class="n">open</span><span class="sb"><code>tells Ruby to look for a file named</code></span><span class="n">form_letter</span><span class="o">.</span><span class="n">html</span><span class="sb"><code>and the</code></span><span class="s2">&quot;r&quot;</span><span class="sb"><code>tells it to open it read-only.  The</code></span><span class="o">.</span><span class="n">read</span><span class="sb"><code>method says &amp;quot;load the whole file&amp;quot; then we save it into the variable named</code></span><span class="n">letter</span><span class="sb">`.  This whole process is the equivalent of writing a line like this&#8230;</span>
</span></code></pre></td></tr></table></div></figure>ruby
letter = &quot;<html>\n<head>\n  <title>Thank You!</title>\n</head>&#8230;&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">By</span> <span class="n">putting</span> <span class="n">the</span> <span class="n">letter</span> <span class="k">in</span> <span class="n">an</span> <span class="n">external</span> <span class="n">file</span><span class="p">,</span> <span class="n">though</span><span class="p">,</span> <span class="n">we</span> <span class="n">keep</span> <span class="n">the</span> <span class="n">programming</span> <span class="k">in</span> <span class="n">the</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">letter</span> <span class="n">writing</span> <span class="k">in</span> <span class="n">the</span> <span class="n">letter</span><span class="o">.</span>  <span class="no">Got</span> <span class="n">it?</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 1: Loading the Data into Variables</span>
</span><span class='line'>
</span><span class='line'><span class="no">Now</span> <span class="n">that</span> <span class="sb"><code>letter</code></span> <span class="n">contains</span> <span class="n">our</span> <span class="n">whole</span> <span class="n">letter</span><span class="p">,</span> <span class="n">we</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">ready</span> <span class="n">to</span> <span class="n">start</span> <span class="n">generating</span> <span class="n">the</span> <span class="n">customized</span> <span class="n">versions</span><span class="o">.</span>  <span class="no">Within</span> <span class="n">the</span> <span class="sb"><code>@file.each</code></span> <span class="kp">loop</span><span class="p">,</span> <span class="n">pull</span> <span class="n">each</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">pieces</span> <span class="n">of</span> <span class="n">data</span> <span class="n">out</span> <span class="n">of</span> <span class="sb"><code>line</code></span><span class="p">:</span>
</span><span class='line'><span class="o"><em></span> <span class="n">create</span> <span class="n">a</span> <span class="n">variable</span> <span class="sb"><code>first_name</code></span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">first</span> <span class="nb">name</span>
</span><span class='line'><span class="o"></em></span> <span class="n">create</span> <span class="n">a</span> <span class="n">variable</span> <span class="sb"><code>last_name</code></span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">last</span> <span class="nb">name</span>
</span><span class='line'><span class="o"><em></span> <span class="n">create</span> <span class="n">a</span> <span class="n">variable</span> <span class="sb"><code>street</code></span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">street</span> <span class="n">address</span>
</span><span class='line'><span class="o"></em></span> <span class="n">create</span> <span class="n">a</span> <span class="n">variable</span> <span class="sb"><code>city</code></span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">city</span>
</span><span class='line'><span class="o"><em></span> <span class="n">create</span> <span class="n">a</span> <span class="n">variable</span> <span class="sb"><code>state</code></span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">state</span>
</span><span class='line'><span class="o"></em></span> <span class="n">create</span> <span class="n">a</span> <span class="n">variable</span> <span class="sb"><code>zipcode</code></span> <span class="n">that</span> <span class="n">holds</span> <span class="n">the</span> <span class="n">zipcode</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 2: Customizing the Text</span>
</span><span class='line'>
</span><span class='line'><span class="no">After</span> <span class="n">your</span> <span class="n">variables</span> <span class="n">are</span> <span class="n">established</span><span class="p">,</span> <span class="n">use</span> <span class="n">the</span> <span class="sb"><code>gsub</code></span> <span class="nb">method</span> <span class="n">to</span> <span class="n">plug</span> <span class="n">the</span> <span class="n">data</span> <span class="n">into</span> <span class="n">the</span> <span class="n">text</span><span class="o">.</span>  <span class="sb"><code>gsub</code></span> <span class="n">takes</span> <span class="n">two</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">the</span> <span class="n">first</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="n">to</span> <span class="n">search</span> <span class="k">for</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">second</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="n">to</span> <span class="n">replace</span> <span class="n">it</span> <span class="n">with</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>ruby
custom<em>letter = letter.gsub(&quot;#firstname&quot;,firstname)
custom</em>letter = custom_letter.gsub(&quot;#lastname&quot;,lastname)</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Continue</span> <span class="n">writing</span> <span class="sb"><code>gsub</code></span> <span class="n">lines</span> <span class="n">like</span> <span class="n">the</span> <span class="n">last</span> <span class="n">one</span> <span class="k">for</span> <span class="n">your</span> <span class="n">other</span> <span class="n">variables</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 3: Writing out the File</span>
</span><span class='line'>
</span><span class='line'><span class="no">Now</span> <span class="n">that</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">re</span> <span class="n">creating</span> <span class="n">the</span> <span class="n">customized</span> <span class="n">text</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">output</span> <span class="n">it</span> <span class="n">to</span> <span class="n">a</span> <span class="n">file</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
filename = &quot;form<em>letters/thanks</em>#{lastname}<em>#{firstname}.html&quot;
output = File.new(filename, &quot;w&quot;)
output.write(custom</em>letter)</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Then</span> <span class="n">change</span> <span class="n">the</span> <span class="n">line</span> <span class="n">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="n">of</span> <span class="n">your</span> <span class="n">program</span> <span class="n">to</span> <span class="sb"><code>jsa.create_form_letters</code></span> <span class="ow">and</span> <span class="no">RUN</span> <span class="n">your</span> <span class="n">program</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="o"><em></span><span class="no">NOTE</span><span class="o"></em></span><span class="p">:</span> <span class="k">if</span> <span class="n">you</span> <span class="n">get</span> <span class="n">an</span> <span class="n">error</span> <span class="n">like</span> <span class="sb"><code>No such file or directory</code></span><span class="p">,</span> <span class="n">make</span> <span class="n">sure</span> <span class="n">that</span> <span class="n">you</span> <span class="n">created</span> <span class="n">the</span> <span class="n">subdirectory</span> <span class="sb"><code>form_letters</code></span> <span class="n">inside</span> <span class="n">your</span> <span class="n">project</span> <span class="n">folder</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Open</span> <span class="n">up</span> <span class="n">some</span> <span class="n">of</span> <span class="n">the</span> <span class="n">form</span> <span class="n">letters</span> <span class="ow">and</span> <span class="n">see</span> <span class="n">how</span> <span class="n">they</span> <span class="n">came</span> <span class="n">out!</span>  <span class="no">If</span> <span class="n">that</span> <span class="n">was</span> <span class="n">too</span> <span class="n">easy</span><span class="p">,</span> <span class="n">experiment</span> <span class="n">with</span> <span class="n">trying</span> <span class="n">to</span> <span class="kp">include</span> <span class="n">information</span> <span class="n">from</span> <span class="n">our</span> <span class="n">other</span> <span class="nb">methods</span><span class="o">.</span>  <span class="no">What</span> <span class="n">would</span> <span class="n">it</span> <span class="n">take</span> <span class="n">to</span> <span class="kp">include</span> <span class="n">a</span> <span class="n">line</span> <span class="n">like</span> <span class="s2">&quot;It was great to see you and the other 481 people from CA!&quot;</span><span class="p">?</span>  <span class="no">What</span> <span class="n">about</span> <span class="n">information</span> <span class="n">about</span> <span class="n">their</span> <span class="n">congresspeople?</span>
</span><span class='line'>
</span><span class='line'><span class="c1">## Iteration 6: Time Targeting</span>
</span><span class='line'>
</span><span class='line'><span class="no">The</span> <span class="n">boss</span> <span class="n">is</span> <span class="n">already</span> <span class="n">thinking</span> <span class="n">about</span> <span class="n">the</span> <span class="k">next</span> <span class="n">conference</span><span class="p">:</span> <span class="s2">&quot;Next year I want to make better use of our Google and Facebook advertising.  Find out which hours of the day the most people registered so we can run more ads during those hours.&quot;</span>  <span class="no">Interesting</span><span class="o">!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 0: Framework</span>
</span><span class='line'>
</span><span class='line'><span class="no">This</span> <span class="nb">method</span> <span class="n">will</span> <span class="n">work</span> <span class="n">a</span> <span class="n">little</span> <span class="n">bit</span> <span class="n">like</span> <span class="n">our</span> <span class="sb"><code>state_stats</code></span> <span class="nb">method</span><span class="o">.</span>  <span class="no">We</span><span class="s1">&#39;ll create a list of 24 slots, one for each hour of the day.  Each slot will start with a count of zero.  We&#39;</span><span class="n">ll</span> <span class="n">go</span> <span class="n">through</span> <span class="n">the</span> <span class="n">registrant</span> <span class="n">list</span> <span class="ow">and</span><span class="p">,</span> <span class="k">for</span> <span class="n">each</span> <span class="n">one</span><span class="p">,</span> <span class="n">increase</span> <span class="n">the</span> <span class="n">hour</span> <span class="n">that</span> <span class="n">they</span> <span class="n">registered</span> <span class="n">by</span> <span class="n">one</span><span class="o">.</span>  <span class="no">Then</span> <span class="n">we</span><span class="err">&#39;</span><span class="n">ll</span> <span class="nb">print</span> <span class="n">out</span> <span class="n">the</span> <span class="n">list</span> <span class="n">of</span> <span class="n">hours</span> <span class="n">with</span> <span class="n">their</span> <span class="n">total</span> <span class="n">registration</span> <span class="n">counts</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def time<em>stats
    hours = Array.new(24){0}
    @file.each do |line|
      # Do the counting here
    end
    hours.each</em>with_index{|counter,hour| puts &quot;#{hour}\t#{counter}&quot;}<br>
  end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Change</span> <span class="n">the</span> <span class="n">instruction</span> <span class="n">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="n">of</span> <span class="n">your</span> <span class="n">program</span> <span class="n">to</span> <span class="sb"><code>jsa.rank_times</code></span> <span class="ow">and</span> <span class="no">RUN</span> <span class="n">it</span><span class="o">.</span>  <span class="no">You</span> <span class="n">should</span> <span class="n">see</span> <span class="n">a</span> <span class="n">column</span> <span class="n">of</span> <span class="n">hours</span> <span class="p">(</span><span class="mi">0</span> <span class="n">to</span> <span class="mi">23</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">column</span> <span class="n">of</span> <span class="n">totals</span> <span class="p">(</span><span class="n">all</span> <span class="n">zero</span><span class="p">)</span><span class="o">.</span>  <span class="no">The</span> <span class="n">only</span> <span class="n">thing</span> <span class="kp">new</span> <span class="n">here</span> <span class="n">is</span> <span class="n">the</span> <span class="nb">method</span> <span class="sb"><code>each_with_index</code></span><span class="o">.</span>  <span class="no">It</span> <span class="n">works</span> <span class="n">just</span> <span class="n">like</span> <span class="sb"><code>each</code></span><span class="p">,</span> <span class="n">but</span> <span class="n">it</span> <span class="n">includes</span> <span class="n">an</span> <span class="sb"><code>index</code></span> <span class="n">value</span> <span class="n">which</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">current</span> <span class="n">element</span><span class="s1">&#39;s position in the list.  So for the first item in the list, the <code>index</code> is <code>0</code>, for the second it is <code>1</code> and so on.  This is mostly useful when you&#39;</span><span class="n">re</span> <span class="n">sequentially</span> <span class="n">numbering</span> <span class="n">things</span> <span class="n">like</span> <span class="n">we</span> <span class="n">are</span> <span class="n">with</span> <span class="n">the</span> <span class="n">hours</span> <span class="n">here</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 1: Find the Hour &amp; Update the Counter</span>
</span><span class='line'>
</span><span class='line'><span class="no">If</span> <span class="n">you</span> <span class="n">look</span> <span class="n">at</span> <span class="n">the</span> <span class="n">spreadsheet</span> <span class="n">you</span><span class="s1">&#39;ll see that the <code>regdate</code> field data looks like this: <code>11/12/08 10:47</code>.  We need a way to pull out just the hour.  We&#39;</span><span class="n">ll</span> <span class="n">use</span> <span class="n">the</span> <span class="nb">method</span> <span class="sb"><code>.split</code></span> <span class="n">to</span> <span class="n">help</span> <span class="n">us</span> <span class="n">out</span><span class="o">.</span>  <span class="sb"><code>split</code></span> <span class="n">takes</span> <span class="n">one</span> <span class="n">parameter</span> <span class="n">which</span> <span class="n">is</span> <span class="n">the</span> <span class="n">string</span> <span class="p">(</span><span class="n">one</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">characters</span><span class="p">)</span> <span class="n">that</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="nb">split</span> <span class="n">on</span><span class="o">.</span>  <span class="no">So</span> <span class="k">if</span> <span class="n">my</span> <span class="n">string</span> <span class="n">were</span> <span class="sb"><code>&amp;quot;hello jumpstart lab&amp;quot;</code></span> <span class="ow">and</span> <span class="n">I</span> <span class="n">called</span> <span class="sb"><code>.split(&amp;quot; &amp;quot;)</code></span> <span class="n">on</span> <span class="n">it</span><span class="p">,</span> <span class="no">Ruby</span> <span class="n">would</span> <span class="nb">split</span> <span class="n">it</span> <span class="n">up</span> <span class="n">each</span> <span class="n">time</span> <span class="n">it</span> <span class="n">finds</span> <span class="n">a</span> <span class="n">space</span> <span class="ow">and</span> <span class="n">give</span> <span class="n">me</span> <span class="n">back</span> <span class="n">a</span> <span class="n">list</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span> <span class="sb"><code>[&amp;quot;hello&amp;quot;,&amp;quot;jumpstart&amp;quot;,&amp;quot;lab&amp;quot;]</code></span><span class="o">.</span>  <span class="no">Once</span> <span class="n">you</span> <span class="n">have</span> <span class="n">that</span> <span class="n">list</span> <span class="n">you</span> <span class="n">can</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">individual</span> <span class="n">parts</span> <span class="n">by</span> <span class="n">number</span><span class="o">.</span>  <span class="no">If</span> <span class="n">I</span> <span class="n">wanted</span> <span class="n">the</span> <span class="n">first</span> <span class="n">chunk</span> <span class="n">I</span> <span class="n">would</span> <span class="n">ask</span> <span class="k">for</span> <span class="sb"><code>[0]</code></span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">second</span> <span class="n">would</span> <span class="n">be</span> <span class="sb"><code>[1]</code></span><span class="p">,</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">third</span> <span class="sb"><code>[2]</code></span><span class="o">.</span>  <span class="no">Check</span> <span class="n">out</span> <span class="n">this</span> <span class="n">example</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
my<em>string = &quot;hello and welcome to jumpstart lab&quot;
parts = my</em>string.split(&quot; &quot;)
puts parts[0] # This would print out &quot;hello&quot;
puts parts[3] # This would print out &quot;to&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Go</span> <span class="n">into</span> <span class="n">an</span> <span class="no">IRB</span> <span class="n">terminal</span> <span class="ow">and</span> <span class="n">enter</span> <span class="sb"><code>timestamp = &amp;quot;11/12/08 10:47&amp;quot;</code></span><span class="o">.</span>  <span class="no">Then</span> <span class="n">experiment</span> <span class="n">with</span> <span class="n">using</span> <span class="sb"><code>split</code></span><span class="o">.</span>  <span class="no">How</span> <span class="n">can</span> <span class="n">you</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">just</span> <span class="n">the</span> <span class="sb"><code>10</code></span><span class="p">?</span>  <span class="no">HINT</span><span class="p">:</span> <span class="no">You</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">need</span> <span class="n">to</span> <span class="n">use</span> <span class="sb"><code>split</code></span> <span class="n">twice</span><span class="o">.</span>  <span class="no">Once</span> <span class="n">you</span> <span class="n">figure</span> <span class="n">it</span> <span class="n">out</span><span class="p">,</span> <span class="n">write</span> <span class="n">code</span> <span class="k">in</span> <span class="n">your</span> <span class="sb"><code>rank_times</code></span> <span class="nb">method</span> <span class="n">that</span> <span class="n">pulls</span> <span class="n">out</span> <span class="n">the</span> <span class="n">hour</span> <span class="ow">and</span> <span class="n">stores</span> <span class="n">it</span> <span class="n">into</span> <span class="n">the</span> <span class="n">variable</span> <span class="sb"><code>hour</code></span><span class="o">.</span>  <span class="no">Once</span> <span class="n">you</span> <span class="n">know</span> <span class="n">the</span> <span class="sb"><code>hour</code></span><span class="p">,</span> <span class="n">you</span> <span class="n">can</span> <span class="n">update</span> <span class="n">the</span> <span class="n">counter</span> <span class="n">by</span> <span class="n">doing</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
hours[hour] = hours[hour] + 1</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Once</span> <span class="n">you</span> <span class="n">think</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">got</span> <span class="n">it</span><span class="p">,</span> <span class="no">RUN</span> <span class="n">your</span> <span class="n">program</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">get</span> <span class="n">the</span> <span class="n">correct</span> <span class="n">output</span><span class="o">.</span>  <span class="no">My</span> <span class="n">first</span> <span class="n">few</span> <span class="n">lines</span> <span class="n">look</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
0   276
1   68
2   41
3   9</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Step 2: Requirements Always Change</span>
</span><span class='line'>
</span><span class='line'><span class="no">The</span> <span class="n">big</span> <span class="n">boss</span> <span class="nb">gets</span> <span class="n">excited</span> <span class="n">about</span> <span class="n">the</span> <span class="n">results</span> <span class="n">from</span> <span class="n">your</span> <span class="n">hourly</span> <span class="n">tabulations</span><span class="o">.</span>  <span class="no">It</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">there</span> <span class="n">are</span> <span class="n">some</span> <span class="n">hours</span> <span class="n">that</span> <span class="n">are</span> <span class="n">clearly</span> <span class="n">more</span> <span class="n">important</span> <span class="n">than</span> <span class="n">others</span><span class="o">.</span>  <span class="no">But</span> <span class="n">now</span><span class="p">,</span> <span class="n">tantalized</span><span class="p">,</span> <span class="n">she</span> <span class="n">wants</span> <span class="n">to</span> <span class="n">know</span> <span class="s2">&quot;What days of the week did most people register?&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="no">Given</span> <span class="n">that</span> <span class="n">you</span><span class="s1">&#39;re pretty much a genius programmer at this point, I&#39;</span><span class="n">ll</span> <span class="n">just</span> <span class="n">give</span> <span class="n">you</span> <span class="n">some</span> <span class="n">tips</span><span class="p">:</span>
</span><span class='line'><span class="o"><em></span> <span class="no">Just</span> <span class="n">change</span> <span class="n">the</span> <span class="nb">method</span> <span class="nb">name</span> <span class="n">to</span> <span class="n">something</span> <span class="n">that</span> <span class="n">describes</span> <span class="n">dates</span> <span class="ow">and</span> <span class="n">times</span> <span class="n">like</span> <span class="sb"><code>rank_dates_and_times</code></span>
</span><span class='line'><span class="o"></em></span> <span class="no">Create</span> <span class="n">a</span> <span class="n">second</span> <span class="n">array</span> <span class="n">list</span><span class="p">,</span> <span class="n">just</span> <span class="n">like</span> <span class="n">you</span> <span class="n">did</span> <span class="k">for</span> <span class="sb"><code>hours</code></span> <span class="n">but</span> <span class="n">call</span> <span class="n">it</span> <span class="sb"><code>days</code></span> <span class="ow">and</span> <span class="n">make</span> <span class="n">the</span> <span class="n">size</span> <span class="sb"><code>7</code></span> <span class="n">instead</span> <span class="n">of</span> <span class="sb"><code>24</code></span>
</span><span class='line'><span class="o"><em></span> <span class="no">Turn</span> <span class="n">a</span> <span class="n">string</span> <span class="n">like</span> <span class="sb"><code>11/12/08</code></span> <span class="n">into</span> <span class="n">a</span> <span class="no">Ruby</span> <span class="no">Date</span> <span class="n">with</span> <span class="n">this</span> <span class="n">parse</span> <span class="n">instruction</span> <span class="n">below</span><span class="o">.</span>  <span class="no">Note</span> <span class="n">that</span> <span class="n">the</span> <span class="sb"><code>true</code></span> <span class="n">just</span> <span class="n">tells</span> <span class="n">it</span> <span class="n">you</span><span class="s1">&#39;re using a two-digit year.</span>
</span><span class='line'><span class="s1">** <code>my_string_date = &amp;quot;11/12/08&amp;quot;</code></span>
</span><span class='line'><span class="s1">** <code>date = Date.parse(my_string_date, true)</code></span>
</span><span class='line'><span class="s1"></em> Once you have a <code>date</code> object, you can get the numeric day of the week by calling the <code>wday</code> method (like <code>date.wday</code>).  Note that Sunday is <code>0</code> and Saturday is <code>6</code></span>
</span><span class='line'><span class="s1">* Which two days have dominantly more registrations than the others?</span>
</span><span class='line'>
</span><span class='line'><span class="s1">## Iteration 7: State Stats</span>
</span><span class='line'>
</span><span class='line'><span class="s1">So you cleaned up the data, output the file, and sent it to your team.  &quot;Hey, that data looks great,&quot; they say, &quot;it makes me wonder about our stats.  Can you tell us more about our attendees?&quot;  Of course you can.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">#### Step 0: Goals &amp; Framework</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Let&#39;</span><span class="n">s</span> <span class="n">start</span> <span class="n">with</span> <span class="n">state</span><span class="o">-</span><span class="n">based</span> <span class="n">information</span><span class="o">.</span>  <span class="no">How</span> <span class="n">many</span> <span class="n">attendees</span> <span class="n">are</span> <span class="n">from</span> <span class="n">each</span> <span class="n">state?</span>  <span class="no">Let</span><span class="s1">&#39;s output a simple list in the format &quot;State: Attendee&quot; count, like &quot;MD: 26&quot;.  We&#39;</span><span class="n">ll</span> <span class="n">put</span> <span class="n">it</span> <span class="n">together</span> <span class="k">in</span> <span class="n">a</span> <span class="nb">method</span> <span class="n">called</span> <span class="sb"><code>state_stats</code></span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def state<em>stats
    state</em>data = {}
    @file.each do |line|</p>

<pre><code>end  
</code></pre>

<p>end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">In</span> <span class="n">the</span> <span class="n">second</span> <span class="n">line</span> <span class="n">there</span> <span class="n">we</span><span class="s1">&#39;ve created a <em>Hash</em> named <code>state_stats</code>.  Refer to the Ruby tutorial for a reminder about how a hash works.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">#### Step 1: Counting with a Hash</span>
</span><span class='line'>
</span><span class='line'><span class="s1">In this case, we&#39;</span><span class="n">ll</span> <span class="n">use</span> <span class="n">our</span> <span class="no">Hash</span> <span class="n">to</span> <span class="n">keep</span> <span class="n">track</span> <span class="n">of</span> <span class="n">how</span> <span class="n">many</span> <span class="n">attendees</span> <span class="n">are</span> <span class="n">from</span> <span class="n">each</span> <span class="n">state</span><span class="o">.</span>  <span class="no">Imagine</span> <span class="k">if</span> <span class="n">we</span> <span class="n">were</span> <span class="n">sorting</span> <span class="n">out</span> <span class="n">paper</span> <span class="n">attendee</span> <span class="n">registration</span> <span class="n">by</span> <span class="n">hand</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="no">For</span> <span class="n">each</span> <span class="n">attendee</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'><span class="o"><em></span> <span class="no">Figure</span> <span class="n">out</span> <span class="n">which</span> <span class="n">state</span> <span class="n">they</span><span class="s1">&#39;re from</span>
</span><span class='line'><span class="s1"></em> If a bucket does not exist for that state, create the bucket then put the paper in there</span>
</span><span class='line'><span class="s1">* If a bucket exists for that state, put the paper in there</span>
</span><span class='line'><span class="s1">* At the end, the number of papers in each bucket shows how many attendees are from that state</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Inside the @file.each` loop, let&#39;</span><span class="n">s</span> <span class="n">add</span> <span class="n">instructions</span> <span class="n">to</span> <span class="n">implement</span> <span class="n">this</span> <span class="n">logic</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
  def state<em>stats
    state</em>data = {}
    @file.each do |line|
      state = line[:state]  # Find the State
      if state<em>data[state].nil? # Does the state&#8217;s bucket exist in state</em>data?
        state<em>data[state] = 1 # If that bucket was nil then start it with this one person
      else
        state</em>data[state] = state_data[:state] + 1  # If the bucket exists, add one
      end
    end
  end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Change</span> <span class="n">you</span> <span class="n">instructions</span> <span class="n">at</span> <span class="n">the</span> <span class="n">bottom</span> <span class="n">of</span> <span class="n">the</span> <span class="n">program</span> <span class="n">to</span> <span class="n">look</span> <span class="n">like</span> <span class="n">these</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
jsa = JSAttend.new(&quot;event<em>attendees</em>clean.csv&quot;)
jsa.state_stats</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">RUN</span> <span class="n">that</span> <span class="n">program</span><span class="o">.</span>  <span class="no">Did</span> <span class="n">it</span> <span class="n">work?</span>  <span class="no">If</span> <span class="n">it</span> <span class="n">generated</span> <span class="n">an</span> <span class="n">error</span><span class="p">,</span> <span class="n">get</span> <span class="n">it</span> <span class="n">fixed</span><span class="o">.</span>  <span class="no">If</span> <span class="n">there</span> <span class="n">was</span> <span class="n">no</span> <span class="n">error</span><span class="p">,</span> <span class="n">though</span><span class="p">,</span> <span class="n">you</span> <span class="n">probably</span> <span class="n">have</span> <span class="n">no</span> <span class="n">idea</span> <span class="k">if</span> <span class="n">it</span> <span class="n">worked</span><span class="o">.</span>  <span class="no">We</span> <span class="n">didn</span><span class="s1">&#39;t print out anything.  Let&#39;</span><span class="n">s</span> <span class="n">add</span> <span class="n">that</span> <span class="k">in</span> <span class="n">now</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">We</span><span class="s1">&#39;re collecting all the state stats in a <em>hash</em>.  A hash is made up of &quot;key-value pairs&quot; -- the &quot;key&quot; is the address that helps us find what we&#39;</span><span class="n">re</span> <span class="n">looking</span> <span class="k">for</span><span class="o">.</span>  <span class="no">The</span> <span class="s2">&quot;value&quot;</span> <span class="n">is</span> <span class="n">the</span> <span class="n">data</span> <span class="n">that</span> <span class="n">the</span> <span class="n">address</span> <span class="n">is</span> <span class="n">pointing</span> <span class="n">to</span><span class="o">.</span>  <span class="no">Each</span> <span class="n">key</span> <span class="n">points</span> <span class="n">to</span> <span class="n">one</span> <span class="n">value</span><span class="o">.</span>  <span class="no">When</span> <span class="n">we</span> <span class="n">have</span> <span class="n">a</span> <span class="n">collection</span> <span class="n">of</span> <span class="n">these</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">pairs</span><span class="p">,</span> <span class="n">we</span> <span class="n">frequently</span> <span class="n">want</span> <span class="n">to</span> <span class="n">walk</span> <span class="n">through</span> <span class="n">the</span> <span class="n">list</span> <span class="ow">and</span> <span class="k">do</span> <span class="n">something</span> <span class="n">to</span> <span class="n">each</span> <span class="n">pair</span><span class="o">.</span>  <span class="no">This</span> <span class="n">state</span> <span class="n">data</span> <span class="n">is</span> <span class="n">a</span> <span class="n">perfect</span> <span class="n">example</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">What</span> <span class="n">I</span> <span class="n">really</span> <span class="n">want</span> <span class="n">is</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">out</span> <span class="n">lines</span> <span class="n">like</span> <span class="s2">&quot;CA: 206&quot;</span><span class="o">.</span>  <span class="s2">&quot;CA&quot;</span><span class="p">,</span> <span class="n">the</span> <span class="n">state</span> <span class="n">abbreviation</span><span class="p">,</span> <span class="n">is</span> <span class="n">the</span> <span class="n">key</span> <span class="n">of</span> <span class="n">the</span> <span class="n">key</span><span class="o">-</span><span class="n">value</span> <span class="n">pair</span> <span class="k">while</span> <span class="n">the</span> <span class="n">number</span> <span class="n">of</span> <span class="n">attendees</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="n">is</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">the</span> <span class="n">pair</span><span class="o">.</span>  <span class="no">Ruby</span> <span class="n">has</span> <span class="n">a</span> <span class="n">really</span> <span class="n">great</span> <span class="n">way</span> <span class="n">of</span> <span class="n">walking</span> <span class="n">through</span> <span class="n">collections</span> <span class="n">like</span> <span class="n">this</span> <span class="n">using</span> <span class="n">the</span> <span class="sb"><code>each</code></span> <span class="nb">method</span><span class="p">,</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state_data.each do |key,value|
  puts key
  puts value
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="sb"><code>each</code></span> <span class="nb">method</span> <span class="n">means</span> <span class="s2">&quot;take each pair in this hash and <code>do</code> what&#39;s inside this <code>do</code>/<code>end</code> block of code.  Right after the <code>do</code> is a part that trips up a lot of people.  We need to give the data bits names.  If we want to be able to call methods on them, print them out, or whatever, they need a name.  Inside these pipes we <em>declare</em> the names.  <code>|key,value|</code> basically translates to &quot;</span><span class="k">for</span> <span class="n">each</span> <span class="n">pair</span><span class="p">,</span> <span class="n">call</span> <span class="n">the</span> <span class="n">first</span> <span class="n">thing</span> <span class="sb"><code>key</code></span> <span class="ow">and</span> <span class="n">the</span> <span class="n">second</span> <span class="n">thing</span> <span class="sb"><code>value</code></span><span class="s2">&quot;.  There&#39;s nothing magical about these names, they can be whatever makes sense to you.  In this case, actually, we can be more explicit with our naming.  Go ahead and add the following code before the <code>end</code> statement of your <code>state_stats</code> method:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state_data.each do |state, counter|
  puts state
  puts counter
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Go</span> <span class="n">ahead</span> <span class="ow">and</span> <span class="no">RUN</span> <span class="n">this</span> <span class="n">code</span> <span class="n">to</span> <span class="n">see</span> <span class="n">what</span> <span class="n">you</span> <span class="n">get</span><span class="o">.</span>  <span class="no">Mine</span> <span class="n">looks</span> <span class="n">like</span> <span class="n">this</span><span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
ND
11
AL
26
VA
382
NY
503</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#### Step 2: Cleaning up the Output</span>
</span><span class='line'>
</span><span class='line'><span class="no">Getting</span> <span class="n">there</span><span class="p">,</span> <span class="n">but</span> <span class="ow">not</span> <span class="n">quite</span> <span class="n">right</span><span class="o">.</span>  <span class="n">I</span> <span class="n">want</span> <span class="n">it</span> <span class="n">to</span> <span class="n">look</span> <span class="n">like</span> <span class="sb"><code>ND: 11</code></span><span class="p">,</span> <span class="ow">not</span> <span class="n">have</span> <span class="sb"><code>ND</code></span> <span class="ow">and</span> <span class="sb"><code>11</code></span> <span class="n">on</span> <span class="n">different</span> <span class="n">lines</span><span class="o">.</span>  <span class="no">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="sb"><code>each</code></span> <span class="kp">loop</span> <span class="n">where</span> <span class="n">we</span> <span class="n">have</span> <span class="n">the</span> <span class="n">lines</span> <span class="sb"><code>puts state</code></span> <span class="ow">and</span> <span class="sb"><code>puts counter</code></span><span class="o">.</span>  <span class="no">Take</span> <span class="n">out</span> <span class="n">those</span> <span class="n">two</span> <span class="ow">and</span> <span class="n">replace</span> <span class="n">them</span> <span class="n">with</span> <span class="n">this</span> <span class="n">interpolated</span> <span class="n">string</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
puts &quot;#{state}: #{counter}&quot;</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">line</span> <span class="n">could</span> <span class="n">be</span> <span class="n">read</span> <span class="n">as</span> <span class="s2">&quot;printout whatever is in the variable named <code>state</code>, then a colon, then a space, then whatever is in the variable named <code>counter</code>.&quot;</span>  <span class="no">Once</span> <span class="n">you</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">put</span> <span class="k">in</span> <span class="n">this</span> <span class="n">improved</span> <span class="sb"><code>puts</code></span> <span class="n">line</span><span class="p">,</span> <span class="no">RUN</span> <span class="n">your</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
ND: 11
AL: 26
VA: 382</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Looking</span> <span class="n">good!</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 3: Sorting</span>
</span><span class='line'>
</span><span class='line'><span class="no">Look</span> <span class="n">at</span> <span class="n">the</span> <span class="n"><em>Ruby</span> <span class="k">in</span> <span class="mi">60</span> <span class="no">Minutes</em></span> <span class="n">guide</span><span class="s1">&#39;s example about a hash being like a classroom of students.  If I said to you &quot;sort out the students&quot;, how would you sort them?  There are so many possibilities, you might sort them by: firstname, lastname, height, gender, age, or any other characteristic.  A classroom doesn&#39;</span><span class="n">t</span> <span class="n">really</span> <span class="n">have</span> <span class="n">an</span> <span class="n">inherit</span> <span class="n">sorting</span> <span class="n">order</span><span class="o">.</span>  <span class="no">They</span><span class="s1">&#39;re just a group of kids.  In the same way, a hash is just a group of key-value pairs.  They don&#39;</span><span class="n">t</span> <span class="n">have</span> <span class="n">an</span> <span class="n">inherit</span> <span class="n">order</span> <span class="o">--</span> <span class="ow">and</span> <span class="n">this</span> <span class="n">really</span> <span class="n">frustrates</span> <span class="n">a</span> <span class="n">lot</span> <span class="n">of</span> <span class="n">people</span><span class="o">.</span>  <span class="n">I</span><span class="s1">&#39;m sure you noticed that your output came out in some arbitrary order.  It&#39;</span><span class="n">s</span> <span class="ow">not</span> <span class="n">alphabetical</span> <span class="n">by</span> <span class="n">state</span><span class="p">,</span> <span class="n">it</span><span class="s1">&#39;s not by region, it&#39;</span><span class="n">s</span> <span class="ow">not</span> <span class="n">by</span> <span class="n">ascending</span> <span class="ow">or</span> <span class="n">decending</span> <span class="n">totals</span><span class="o">.</span>  <span class="no">These</span> <span class="n">would</span> <span class="n">all</span> <span class="n">be</span> <span class="n">reasonable</span> <span class="n">ways</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">the</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">but</span> <span class="n">we</span> <span class="n">haven</span><span class="s1">&#39;t told Ruby which to use.</span>
</span><span class='line'>
</span><span class='line'><span class="s1">Thankfully hash has a method named <code>sort_by</code>.  Using <code>sort_by</code> we can get the hash sorted by any criteria we wish.  It uses a similar syntax to <code>each</code> that we used above.  Here&#39;</span><span class="n">s</span> <span class="n">how</span> <span class="n">you</span> <span class="n">could</span> <span class="n">sort</span> <span class="n">this</span> <span class="nb">hash</span> <span class="n">alphabetically</span> <span class="n">by</span> <span class="n">the</span> <span class="n">state</span> <span class="nb">name</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>ruby
state<em>data = state</em>data.sort_by{|state, counter| state unless state.nil?}</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Reading</span> <span class="n">this</span> <span class="n">would</span> <span class="n">sound</span> <span class="n">like</span> <span class="s2">&quot;take the <code>state_data</code> hash and sort it by looking at each pair, name the key <code>state</code> and name the value <code>counter</code>, then just compare the <code>state</code> of each pair and ignore the value of <code>counter</code>.  This will result in an ascending alphabetical sort, and save those results back into the name <code>state_data</code>.  Try it in your code by sorting the data before printing it like this&#8230;</span>
</span></code></pre></td></tr></table></div></figure>ruby
state<em>data = state</em>data.sort<em>by{|state, counter| state unless state.nil?}
state</em>data.each do |state, counter|
  puts &quot;#{state}: #{counter}&quot;
end</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">RUN</span> <span class="n">your</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
AK: 2
AL: 26
AR: 3</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Now</span><span class="p">,</span> <span class="n">try</span> <span class="n">modifying</span> <span class="n">the</span> <span class="sb"><code>sort_by</code></span> <span class="n">instruction</span> <span class="n">to</span> <span class="n">sort</span> <span class="n">by</span> <span class="sb"><code>counter</code></span> <span class="n">instead</span> <span class="n">of</span> <span class="n">state</span><span class="o">.</span>  <span class="no">See</span> <span class="n">how</span> <span class="n">that</span> <span class="n">affects</span> <span class="n">your</span> <span class="n">output</span><span class="o">.</span>  <span class="no">You</span> <span class="n">can</span> <span class="n">also</span> <span class="n">try</span> <span class="n">reversing</span> <span class="n">the</span> <span class="n">list</span> <span class="n">by</span> <span class="n">putting</span> <span class="sb"><code>.reverse</code></span> <span class="n">on</span> <span class="n">the</span> <span class="k">end</span> <span class="n">of</span> <span class="n">the</span> <span class="sb"><code>sort_by</code></span> <span class="nb">method</span> <span class="p">(</span><span class="n">right</span> <span class="n">after</span> <span class="n">the</span> <span class="sb"><code>}</code></span><span class="p">)</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#### Step 4: Alphabetical Order with Numbered Rank</span>
</span><span class='line'>
</span><span class='line'><span class="no">This</span> <span class="n">is</span> <span class="n">really</span> <span class="n">a</span> <span class="n">little</span> <span class="n">bit</span> <span class="n">advanced</span> <span class="k">for</span> <span class="n">this</span> <span class="n">point</span> <span class="n">of</span> <span class="n">your</span> <span class="n">development</span><span class="p">,</span> <span class="n">but</span> <span class="n">here</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">how</span> <span class="n">I</span> <span class="n">implemented</span> <span class="n">an</span> <span class="n">alphabetical</span> <span class="n">state</span> <span class="n">list</span> <span class="n">combined</span> <span class="n">with</span> <span class="n">an</span> <span class="n">attendance</span><span class="o">-</span><span class="n">count</span> <span class="n">ranking</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>ruby
    ranks = state<em>data.sort</em>by{|state, counter| counter}.collect{|state, counter| state}.reverse
    state<em>data = state</em>data.sort_by{|state, counter| state}</p>

<pre><code>state_data.each do |state, counter|
  puts &quot;#{state}:\t#{counter}\t(#{ranks.index(state) + 1})&quot; 
end
</code></pre>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">The</span> <span class="n">most</span> <span class="n">significant</span> <span class="n">change</span> <span class="n">is</span> <span class="n">the</span> <span class="n">first</span> <span class="n">line</span><span class="o">.</span>  <span class="no">The</span> <span class="sb"><code>state_data.sort_by{|state, counter| counter}</code></span> <span class="n">is</span> <span class="n">just</span> <span class="n">the</span> <span class="n">same</span> <span class="n">as</span> <span class="n">the</span> <span class="n">sorting</span> <span class="n">by</span> <span class="n">the</span> <span class="sb"><code>counter</code></span> <span class="n">that</span> <span class="n">you</span> <span class="n">did</span> <span class="n">before</span><span class="o">.</span>  <span class="no">Once</span> <span class="n">I</span> <span class="n">have</span> <span class="n">that</span> <span class="n">ordered</span> <span class="n">list</span><span class="p">,</span> <span class="n">I</span> <span class="n">don</span><span class="err">&#39;</span><span class="n">t</span> <span class="n">care</span> <span class="n">any</span> <span class="n">more</span> <span class="n">about</span> <span class="n">the</span> <span class="n">actual</span> <span class="n">counts</span> <span class="n">anymore</span><span class="p">,</span> <span class="n">I</span> <span class="n">only</span> <span class="n">care</span> <span class="n">about</span> <span class="n">the</span> <span class="n">order</span><span class="o">.</span>  <span class="n">I</span> <span class="k">then</span> <span class="n">use</span> <span class="n">the</span> <span class="sb"><code>collect</code></span> <span class="nb">method</span> <span class="n">to</span> <span class="n">pull</span> <span class="n">out</span> <span class="n">the</span> <span class="n">state</span> <span class="n">names</span><span class="o">.</span><span class="n">.</span><span class="o">.</span><span class="n">basically</span> <span class="s2">&quot;for each pair in the hash, name the key of the pair <code>state</code> and the value of the pair <code>counter</code>, then give me just the <code>state</code>.&quot;</span>  <span class="no">The</span> <span class="n">results</span> <span class="n">of</span> <span class="n">this</span> <span class="sb"><code>collect</code></span> <span class="n">are</span> <span class="n">put</span> <span class="n">into</span> <span class="n">the</span> <span class="n">array</span> <span class="n">list</span> <span class="n">named</span> <span class="sb"><code>ranks</code></span><span class="o">.</span>  <span class="no">If</span> <span class="n">you</span> <span class="n">were</span> <span class="n">to</span> <span class="nb">print</span> <span class="n">it</span> <span class="n">out</span><span class="p">,</span> <span class="n">this</span> <span class="n">would</span> <span class="n">look</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
MH,BC,NV,WY,DE,NS,QC,AS,OK,AK,PW,AR,SD,FM,NE,GU,HI,PR,MS,ID,ND,KS,ON,NM,MT,UT,IA,AL,MO,YK,AZ,CO,LA,WV,SC,WA,TN,IN,RI,TX,NH,WI,GA,IL,KY,CT,OR,NJ,MN,ME,CA,FL,MI,DC,MA,OH,MD,NC,VT,PA,VA,NY</p>

<p><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">This</span> <span class="n">list</span> <span class="n">start</span> <span class="n">with</span> <span class="no">MH</span> <span class="n">because</span> <span class="n">it</span> <span class="n">has</span> <span class="mi">1</span> <span class="n">registrant</span> <span class="ow">and</span> <span class="n">ends</span> <span class="n">with</span> <span class="no">NY</span> <span class="n">because</span> <span class="n">of</span> <span class="n">its</span> <span class="mi">503</span> <span class="n">registrants</span><span class="o">.</span>  <span class="n">I</span> <span class="n">want</span> <span class="n">my</span> <span class="n">rankings</span> <span class="k">in</span> <span class="n">the</span> <span class="n">opposite</span> <span class="n">order</span> <span class="p">(</span><span class="n">where</span> <span class="n">the</span> <span class="n">first</span> <span class="n">position</span> <span class="n">is</span> <span class="n">the</span> <span class="n">highest</span> <span class="sb"><code>counter</code></span><span class="p">),</span> <span class="n">so</span> <span class="n">I</span> <span class="n">added</span> <span class="n">a</span> <span class="sb"><code>.reverse</code></span> <span class="n">to</span> <span class="n">flip</span> <span class="n">it</span> <span class="n">around</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="no">Then</span> <span class="n">the</span> <span class="n">second</span> <span class="n">change</span> <span class="n">is</span> <span class="n">this</span> <span class="n">line</span><span class="p">:</span> <span class="sb"><code>puts &amp;quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;counter&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;#{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ranks&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;sb&quot;&gt;)&amp;quot;</code></span><span class="o">.</span>  <span class="no">The</span> <span class="n">first</span> <span class="n">thing</span> <span class="n">I</span><span class="s1">&#39;ve changed is putting in <code>\t</code> which inserts a tab instead of a space so the output is more readable.  The interesting part is <code>#{ranks.index(state) + 1}</code> which reads as &quot;look in the list <code>ranks</code> and find the <code>index</code> (or &quot;position&quot;) of whatever is in the variable named <code>state</code> then add <code>1</code> to that address.&quot;  The list is indexed starting with zero; we add one so that the state rankings start at &quot;1&quot; like you&#39;</span><span class="n">d</span> <span class="n">normally</span> <span class="n">rank</span> <span class="n">things</span><span class="o">.</span>  <span class="no">RUN</span> <span class="n">this</span> <span class="n">code</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">should</span> <span class="n">see</span> <span class="n">output</span> <span class="n">like</span> <span class="n">this</span><span class="p">:</span>
</span></code></pre></td></tr></table></div></figure>
JSAttend Initialized.
AK: 2   (53)
AL: 26  (35)
AR: 3   (51)
&#8220;`</p>

<h1>And with that, you&#8217;re done!</h1>

  
    <footer>
      
      
        <div class="sharing">
  
  
</div>

      
    </footer>
  
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Jumpstart Lab -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


  

  

  

</body>
</html>
